<!DOCTYPE HTML>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="format-detection" content="telephone=no" />
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
  <meta http-equiv="Expires" content="0">
  <link rel="Shortcut Icon" href="https://cdn.bihe0832.com/images/zixie_32.ico" />

  <title>AAF 更新配置生成工具</title>
  <meta name="author" content="子勰(bihe0832), code@bihe0832.com" />
  <meta name="keywords" content="子勰,bihe0832" />
  <meta name="description" content="AAF 更新配置生成工具" />
  <meta property="og:title" content="首页" />
  <meta property="og:locale" content="en_US" />
  <meta name="google-site-verification" content="3wzNgbjvFNHkH-8QpougMZ0s9Y4GEjG49kEb49QQqpw" />
  <meta property="og:description" content="" />
  <link rel="canonical" href="https://blog.bihe0832.com/" />
  <meta property="og:url" content="https://blog.bihe0832.com/" />
  <meta property="og:site_name" content="AAF 更新配置生成工具" />
  <meta property="og:type" content="article" />
  <script type="application/ld+json">
  {
      "@type":"BlogPosting",
      "url":"https://blog.bihe0832.com/",
      "headline":"首页",
      "dateModified":" 2021-01-06 17:28:45 +0800",
      "datePublished":" ",
      "author":{"@type":"Person","name":"子勰"},
      "description":"",
      "publisher":{
          "@type":"Organization",
          "name":"子勰",
          "logo": {
            "@type": "ImageObject",
            "url": "https://blog.bihe0832.com/public/img/head.jpg"
          }
        },
      "image": "https://blog.bihe0832.com/public/img/cv.png",
      "mainEntityOfPage":{"@type":"WebPage",
      "@id":"https://blog.bihe0832.com/"},
      "@context":"http://schema.org"
    }
  </script>
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "",
        "item": "https://blog.bihe0832.com/"
      },{
        "@type": "ListItem",
        "position": 2,
        "name": "首页",
        "item": "https://blog.bihe0832.com/"
      }]
    }
  </script>
  <link rel="stylesheet" type="text/css" href="https://cdn.bihe0832.com/css/global.css" />

  <style type="text/css">
    body {
      line-height: 1.25;
      font-family: Microsoft Yahei;
      color: #333;
      font-size: 1.8 em;
      width: 1200px;
      margin: auto auto;
    }

    .form-info {
      margin-top: 40px;
      flex-direction: column;
      display: flex;
    }

    .title {
      margin: auto auto;
      line-height: 1.75;
    }

    .container {
      display: flex;
      margin-top: 10px;
      justify-content: flex-start;
    }

    .left {
      flex: 7;
      padding: 16px;
    }

    .right {
      flex: 4;
      max-width: 440px;
      padding: 16px;
    }

    form {
      display: flex;
      flex-direction: column;
    }

    form input {
      margin-bottom: 10px;
      margin-top: 4px;
      padding-left: 4px;
      height: 2em;
    }

    form label {
      color: #333;
      font-weight: bolder;
    }

    .special {
      color: red;
    }

    .button {
      color: red;
      line-height: 1.75;
      font-weight: bolder;
      padding: 10px 10px 10px 10px;
    }

    #json-output {
      background-color: #eee;
      margin-top: 20px;
      padding: 10px;
    }

  </style>
</head>

<body>

  <div class="form-info">
    <h2 class="title">AAF 更新配置生成工具</h2>
    <h4 class="title">版本号：最新版本号 > 红点版本号 > 弹框版本号 > 强更版本号</h4>
    <div class="container">
      <div class="left">
        <form>
          <label>最新版本版本名「newVersionName」:</label>
          <input type="text" id="newVersionName" name="newVersionName" />

          <label class="special">最新版本版本号「newVersionCode」:</label>
          <input type="text" id="newVersionCode" name="newVersionCode" />

          <label class="special">最新版本下载地址「newVersionURL」:</label>
          <input type="text" id="newVersionURL" name="newVersionURL" />

          <label class="special">最新版本文件MD5「newVersionMD5」:</label>
          <input type="text" id="newVersionMD5" name="newVersionMD5" />

          <label>最新版本版本介绍「newVersionInfo」:</label>
          <input type="text" id="newVersionInfo" name="newVersionInfo" />

          <label>红点版本号（当前及以下版本显示红点，可选、强更必有红点）「showRedMaxVersionCode」:</label>
          <input type="text" id="showRedMaxVersionCode" name="showRedMaxVersionCode" />

          <label>可选更新最高版本（当前及以下版本弹框）「needUpdateMinVersionCode」:</label>
          <input type="text" id="needUpdateMinVersionCode" name="needUpdateMinVersionCode" />

          <label>强制更新最高版本号（当前及以下版本强更）「forceUpdateMinVersionCode」:</label>
          <input type="text" id="forceUpdateMinVersionCode" name="forceUpdateMinVersionCode" />

          <label>弹框更新特殊版本列表（该版本必弹框，多个空格分割）「needUpdateList」:</label>
          <input type="text" id="needUpdateList" name="needUpdateList" />

          <label>强制更新特殊版本列表（该版本必强更，多个空格分割）「forceUpdateList」:</label>
          <input type="text" id="forceUpdateList" name="forceUpdateList" />

        </form>
      </div>
      <div class="right">
        <div id="copy-button" class="button"></div>
        <div id="json-output"></div>
        <div id="update-result" class="button"></div>
      </div>
    </div>
  </div>



</body>
<script>

  const form = document.querySelector('form');
  const copyButton = document.getElementById('copy-button');
  const output = document.getElementById('json-output')

  // Retrieve form data from localStorage
  const storedFormData = JSON.parse(localStorage.getItem('aaf_update_form_data'));
  if (storedFormData != null) {
    // Iterate over stored form data and set values
    for (const key in storedFormData) {
      if (storedFormData.hasOwnProperty(key)) {

        document.querySelector('input[name="' + `${key}` + '"]').value = `${storedFormData[key]}`;
      }
    }
  }

  updateAndSaveJson()
  form.addEventListener('input', (e) => {
    e.preventDefault();
    updateAndSaveJson()
  });

  function updateAndSaveJson() {
    const formData = new FormData(form);
    // Store form data in localStorage
    const data = {};
    formData.forEach((value, key) => {
      data[key] = value;
    });
    localStorage.setItem('aaf_update_form_data', JSON.stringify(data));
    const json = JSON.stringify(data, null, "<BR>&nbsp;&nbsp;&nbsp;&nbsp;").replace(/}$/, '<BR>}');;
    output.innerHTML = json;
    copyButton.innerHTML = "在左侧窗格输入配置，右侧即可生成工具Json；点击此处一键复制到剪切板"

    var result = "当前更新效果为：<BR>" 
    if (parseInt(document.getElementById('showRedMaxVersionCode').value) > 0) {
      result = result + document.getElementById('showRedMaxVersionCode').value + " 以上版本仅展示红点<BR>" 
    }

    if (parseInt(document.getElementById('needUpdateMinVersionCode').value) > 0) {
      result = result + document.getElementById('needUpdateMinVersionCode').value + " 以上版本弹框引导更新，弹框可以取消<BR>" 
    }

    if (parseInt(document.getElementById('forceUpdateMinVersionCode').value) > 0) {
      result = result + document.getElementById('forceUpdateMinVersionCode').value  + " 以上版本弹框不可取消，取消自动退出应用<BR>" 
    }

    document.getElementById('update-result').innerHTML = result

  }

  copyButton.addEventListener('click', (e) => {
    const textArea = document.createElement('textarea');
    const formData = new FormData(form);
    const data = {};
    formData.forEach((value, key) => {
      data[key] = value;
    });
    const json = JSON.stringify(data, null, "");
    textArea.value = json;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    copyButton.innerHTML = "内容已复制到剪切板"
  });
</script>

<script>

  function checkValue() {
    if (parseInt(document.getElementById('newVersionCode').value) <= parseInt(document.getElementById('showRedMaxVersionCode').value)) {
      document.getElementById('showRedMaxVersionCode').value = parseInt(document.getElementById('newVersionCode').value) - 1;
    }

    if (parseInt(document.getElementById('showRedMaxVersionCode').value) < parseInt(document.getElementById('needUpdateMinVersionCode').value)) {
      document.getElementById('needUpdateMinVersionCode').value = parseInt(document.getElementById('showRedMaxVersionCode').value);
    }

    if (parseInt(document.getElementById('needUpdateMinVersionCode').value) < parseInt(document.getElementById('forceUpdateMinVersionCode').value)) {
      document.getElementById('forceUpdateMinVersionCode').value = parseInt(document.getElementById('needUpdateMinVersionCode').value);
    }
  }

  document.getElementById('newVersionCode').addEventListener('input', (event) => {
    // Set the value of the second input to the value of the first input
    event.target.value = event.target.value.replace(/[^0-9]/g, '');
  });

  document.getElementById('newVersionCode').addEventListener('blur', (event) => {
    checkValue()
  });

  document.getElementById('newVersionMD5').addEventListener('change', (event) => {
    // Set the value of the second input to the value of the first input
    if (event.target.value.length != 32) {
      event.target.value = ""
    }
  });

  document.getElementById('showRedMaxVersionCode').addEventListener('input', (event) => {
    // Set the value of the second input to the value of the first input
    event.target.value = event.target.value.replace(/[^0-9]/g, '');
  });

  document.getElementById('showRedMaxVersionCode').addEventListener('blur', (event) => {
    // Set the value of the second input to the value of the first input
    checkValue()
  });

  document.getElementById('needUpdateMinVersionCode').addEventListener('input', (event) => {
    // Set the value of the second input to the value of the first input
    event.target.value = event.target.value.replace(/[^0-9]/g, '');
  });

  document.getElementById('needUpdateMinVersionCode').addEventListener('blur', (event) => {
    // Set the value of the second input to the value of the first input
    checkValue()
  });

  document.getElementById('forceUpdateMinVersionCode').addEventListener('input', (event) => {
    // Set the value of the second input to the value of the first input
    event.target.value = event.target.value.replace(/[^0-9]/g, '');
  });

  document.getElementById('forceUpdateMinVersionCode').addEventListener('blur', (event) => {
    // Set the value of the second input to the value of the first input
    checkValue()
  });

  document.getElementById('forceUpdateList').addEventListener('input', (event) => {
    // Set the value of the second input to the value of the first input
    event.target.value = event.target.value.replace(/[^0-9\s]/g, '');
  });

  document.getElementById('needUpdateList').addEventListener('input', (event) => {
    // Set the value of the second input to the value of the first input
    event.target.value = event.target.value.replace(/[^0-9\s]/g, '');
  });

</script>
</html>

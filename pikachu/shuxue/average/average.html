<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />    
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="Expires" content="0">
    <link rel="Shortcut Icon" href="https://cdn.bihe0832.com/images/zixie_32.ico" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="author" CONTENT="å­å‹°(bihe0832), code@bihe0832.com" />
    <meta name="keywords" content="å­å‹°,bihe0832,å¹³å‡æ•°é—®é¢˜" />
    <meta name="description" content="çš®å¡ä¸˜å­¦æ•°å­¦ä¹‹å¹³å‡æ•°é—®é¢˜åˆ†æ­¥è§£ç­”" />
    <meta property="og:title" content="çš®å¡ä¸˜å­¦æ•°å­¦ä¹‹å¹³å‡æ•°é—®é¢˜åˆ†æ­¥è§£ç­”" />
    <meta property="og:locale" content="en_US" />
    <title>çš®å¡ä¸˜å­¦æ•°å­¦ - å¹³å‡æ•°é—®é¢˜</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #1abc9c, #16a085);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 1400px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            margin: 20px 0;
            padding: 20px;
        }
        header {
            background: linear-gradient(90deg, #1abc9c, #16a085);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        header h2 {
            font-size: 2rem;
            margin: 10px 0;
            text-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }
        header p {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.6;
        }
        
        .main-content {
            display: flex;
            gap: 20px;
            height: 660px;
            overflow: hidden;
        }
        
        .left-panel {
            width: 320px;
            flex-shrink: 0;
            background: #f0fff8;
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .panel-title {
            font-size: 1rem;
            color: #16a085;
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 3px solid #1abc9c;
            display: flex;
            align-items: center;
        }
        .panel-title i {
            margin-right: 8px;
            font-size: 1.1rem;
            color: #1abc9c;
        }
        
        .input-group {
            margin-bottom: 10px;
        }
        .input-item {
            margin-bottom: 10px;
        }
        .input-label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #16a085;
            font-size: 0.9rem;
        }
        input, select {
            padding: 10px 12px;
            width: 100%;
            border: 2px solid #1abc9c;
            border-radius: 10px;
            font-size: 1rem;
            text-align: center;
            transition: all 0.3s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #16a085;
            box-shadow: 0 0 10px rgba(26, 188, 156, 0.3);
        }
        
        .problem-types {
            margin-bottom: 10px;
        }
        .problem-type-btn {
            display: block;
            width: 100%;
            padding: 8px 10px;
            margin-bottom: 6px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        .problem-type-btn:hover {
            border-color: #1abc9c;
            background: #f0fff8;
        }
        .problem-type-btn.active {
            border-color: #1abc9c;
            background: linear-gradient(135deg, #1abc9c, #16a085);
            color: white;
        }
        .problem-type-btn .type-title {
            font-weight: bold;
            font-size: 0.9rem;
        }
        .problem-type-btn .type-desc {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-top: 2px;
        }
        
        .start-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
            margin-top: auto;
        }
        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }
        
        .show-all-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.3);
        }
        .show-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(155, 89, 182, 0.4);
        }
        
        .formula-card {
            padding: 0 12px 12px 12px;
            margin-bottom: 15px;
        }
        .formula-card .formula {
            font-size: 0.9rem;
            color: #16a085;
            margin: 8px 0;
        }
        
        /* ä¸­é—´å¯è§†åŒ–åŒºåŸŸ */
        .center-panel {
            flex: 1;
            min-width: 400px;
            background: #f5fffa;
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }
        
        .problem-display {
            background: linear-gradient(135deg, #1abc9c, #16a085);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            font-size: 1rem;
            line-height: 1.6;
        }
        .problem-display .highlight {
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        /* æŸ±çŠ¶å›¾å¯è§†åŒ– */
        .bar-visualization {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 20px;
            min-height: 0;
            overflow-y: auto;
        }
        
        .bar-chart {
            display: flex;
            align-items: flex-end;
            gap: 20px;
            height: 200px;
            padding: 20px;
            background: rgba(26, 188, 156, 0.1);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .bar-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .bar {
            width: 50px;
            background: linear-gradient(180deg, #1abc9c, #16a085);
            border-radius: 5px 5px 0 0;
            transition: height 0.5s ease;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 5px;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        
        .bar-label {
            font-size: 12px;
            color: #666;
            font-weight: bold;
        }
        
        .average-line {
            position: relative;
            width: 100%;
            height: 2px;
            background: #e74c3c;
            margin: 10px 0;
        }
        
        .average-line::after {
            content: attr(data-value);
            position: absolute;
            right: 0;
            top: -20px;
            color: #e74c3c;
            font-weight: bold;
            font-size: 14px;
        }
        
        .answer-cards {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .answer-card {
            background: white;
            border-radius: 12px;
            padding: 12px 15px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border: 3px solid #1abc9c;
            min-width: 80px;
        }
        
        .answer-card .answer-icon {
            font-size: 1.3rem;
            margin-bottom: 3px;
        }
        
        .answer-card .answer-label {
            color: #666;
            font-size: 0.75rem;
            margin-bottom: 3px;
        }
        
        .answer-card .answer-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1abc9c;
        }
        
        /* å³ä¾§æ­¥éª¤é¢æ¿ */
        .right-panel {
            width: 380px;
            flex-shrink: 0;
            background: #f0fff8;
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .steps-container {
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .steps-container::-webkit-scrollbar {
            width: 6px;
        }
        .steps-container::-webkit-scrollbar-track {
            background: #d0fff0;
            border-radius: 3px;
        }
        .steps-container::-webkit-scrollbar-thumb {
            background: #1abc9c;
            border-radius: 3px;
        }
        
        .step-item {
            background: white;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #ddd;
            display: none;
            transition: all 0.3s;
        }
        
        .step-item.visible {
            display: flex;
            align-items: center;
            border-left-color: #1abc9c;
            animation: fadeInStep 0.4s ease;
        }
        
        .step-item.active {
            background: linear-gradient(135deg, #f0fff8, #d0fff0);
            border-left-color: #27ae60;
            box-shadow: 0 4px 15px rgba(26, 188, 156, 0.2);
            animation: breatheTeal 1.5s ease-in-out infinite;
        }
        
        @keyframes fadeInStep {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes breatheTeal {
            0%, 100% { background-color: rgba(26, 188, 156, 0.1); }
            50% { background-color: rgba(26, 188, 156, 0.25); }
        }
        
        .result-box {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 15px 20px;
            display: none;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 1.1rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }
        
        .result-box.visible {
            display: block;
            animation: fadeInStep 0.4s ease;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
            color: white;
        }
        
        .nav-btn.prev {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }
        
        .nav-btn.next {
            background: linear-gradient(45deg, #1abc9c, #16a085);
        }
        
        .nav-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .step-number {
            display: inline-block;
            width: 26px;
            height: 26px;
            background: #1abc9c;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 26px;
            font-weight: bold;
            margin-right: 10px;
            font-size: 0.85rem;
            flex-shrink: 0;
        }
        
        .step-content {
            display: inline;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
                height: auto;
            }
            .left-panel, .right-panel {
                width: 100%;
            }
            .center-panel {
                min-width: auto;
                min-height: 350px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h2>ğŸ“Š çš®å¡ä¸˜å­¦æ•°å­¦ - å¹³å‡æ•°é—®é¢˜</h2>
            <p>å¹³å‡æ•° = æ€»æ•° Ã· ä¸ªæ•° | æŒæ¡ç§»å¤šè¡¥å°‘çš„æ€æƒ³ï¼Œè½»æ¾è§£å†³å¹³å‡æ•°é—®é¢˜ï¼</p>
        </header>
        
        <div class="main-content">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="left-panel">
                <div class="panel-title">
                    <i class="fas fa-cog"></i> é¢˜ç›®è®¾ç½®
                </div>
                
                <div class="problem-types">
                    <button class="problem-type-btn active" data-type="basic" onclick="selectProblemType('basic')">
                        <div class="type-title">ğŸ“Š åŸºç¡€å¹³å‡æ•°</div>
                        <div class="type-desc">å·²çŸ¥å„æ•°ï¼Œæ±‚å¹³å‡æ•°</div>
                    </button>
                    <button class="problem-type-btn" data-type="total" onclick="selectProblemType('total')">
                        <div class="type-title">ğŸ“¦ æ±‚æ€»æ•°</div>
                        <div class="type-desc">å·²çŸ¥å¹³å‡æ•°å’Œä¸ªæ•°ï¼Œæ±‚æ€»æ•°</div>
                    </button>
                    <button class="problem-type-btn" data-type="combined" onclick="selectProblemType('combined')">
                        <div class="type-title">ğŸ”— åˆå¹¶å¹³å‡æ•°</div>
                        <div class="type-desc">ä¸¤ç»„æ•°æ®åˆå¹¶åçš„å¹³å‡æ•°</div>
                    </button>
                    <button class="problem-type-btn" data-type="change" onclick="selectProblemType('change')">
                        <div class="type-title">ğŸ“ˆ å˜åŒ–å¹³å‡æ•°</div>
                        <div class="type-desc">å¢åŠ /å‡å°‘æ•°æ®åçš„å¹³å‡æ•°</div>
                    </button>
                </div>
                
                <div class="input-group" id="basicInputs">
                    <div class="input-item">
                        <label class="input-label">ğŸ“ è¾“å…¥æ•°æ®ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                        <input type="text" id="dataInput" value="5,8,6,9,7" placeholder="å¦‚ï¼š5,8,6,9,7">
                    </div>
                </div>
                
                <div class="input-group" id="totalInputs" style="display:none;">
                    <div class="input-item">
                        <label class="input-label">ğŸ“Š å¹³å‡æ•°</label>
                        <input type="number" id="avgInput" value="6" min="0" max="10" placeholder="å¹³å‡æ•°">
                    </div>
                    <div class="input-item">
                        <label class="input-label">ğŸ”¢ ä¸ªæ•°</label>
                        <input type="number" id="countInput" value="5" min="1" max="10" placeholder="ä¸ªæ•°">
                    </div>
                </div>
                
                <div class="input-group" id="combinedInputs" style="display:none;">
                    <div class="input-item">
                        <label class="input-label">ğŸ“Š ç¬¬ä¸€ç»„å¹³å‡æ•°</label>
                        <input type="number" id="avg1Input" value="6" min="0" max="10">
                    </div>
                    <div class="input-item">
                        <label class="input-label">ğŸ”¢ ç¬¬ä¸€ç»„äººæ•°</label>
                        <input type="number" id="count1Input" value="3" min="1" max="10">
                    </div>
                    <div class="input-item">
                        <label class="input-label">ğŸ“Š ç¬¬äºŒç»„å¹³å‡æ•°</label>
                        <input type="number" id="avg2Input" value="8" min="0" max="10">
                    </div>
                    <div class="input-item">
                        <label class="input-label">ğŸ”¢ ç¬¬äºŒç»„äººæ•°</label>
                        <input type="number" id="count2Input" value="2" min="1" max="10">
                    </div>
                </div>
                
                <div class="input-group" id="changeInputs" style="display:none;">
                    <div class="input-item">
                        <label class="input-label">ğŸ“Š åŸå¹³å‡æ•°</label>
                        <input type="number" id="origAvgInput" value="6" min="0" max="10">
                    </div>
                    <div class="input-item">
                        <label class="input-label">ğŸ”¢ åŸä¸ªæ•°</label>
                        <input type="number" id="origCountInput" value="4" min="1" max="10">
                    </div>
                    <div class="input-item">
                        <label class="input-label">â• æ–°å¢æ•°æ®</label>
                        <input type="number" id="newDataInput" value="9" min="0" max="10">
                    </div>
                </div>
                
                <button class="show-all-btn" onclick="showAllSteps()" style="margin-top: 10px;">
                    <i class="fas fa-eye"></i> ä¸€é”®æŸ¥çœ‹
                </button>
                
                <div class="nav-buttons" style="margin-top: 15px;">
                    <button class="nav-btn prev" onclick="prevStep()" id="prevBtn" disabled>
                        <i class="fas fa-arrow-left"></i> ä¸Šä¸€æ­¥
                    </button>
                    <button class="nav-btn next" onclick="nextStep()" id="nextBtn">
                        ä¸‹ä¸€æ­¥ <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- ä¸­é—´å¯è§†åŒ–åŒºåŸŸ -->
            <div class="center-panel">
                <div class="panel-title">
                    <i class="fas fa-question-circle"></i> é¢˜ç›®
                </div>
                <div class="problem-display" id="problemDisplay">
                    å°æ˜5æ¬¡è€ƒè¯•æˆç»©åˆ†åˆ«æ˜¯ <span class="highlight">5, 8, 6, 9, 7</span> åˆ†ï¼Œ<br>
                    æ±‚è¿™5æ¬¡è€ƒè¯•çš„å¹³å‡åˆ†æ˜¯å¤šå°‘ï¼Ÿ
                </div>
                
                <div class="panel-title">
                    <i class="fas fa-eye"></i> å¯è§†åŒ–æ¼”ç¤º
                </div>
                
                <div class="bar-visualization">
                    <div class="bar-chart" id="barChart">
                        <!-- æŸ±çŠ¶å›¾ -->
                    </div>
                    <div class="average-line" id="averageLine" data-value="å¹³å‡: ?"></div>
                </div>
                
                <div class="answer-cards" id="answerCards">
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“</div>
                        <div class="answer-label">æ•°æ®ä¸ªæ•°</div>
                        <div class="answer-value" id="answerCount">5</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“¦</div>
                        <div class="answer-label">æ€»å’Œ</div>
                        <div class="answer-value" id="answerSum">?</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“Š</div>
                        <div class="answer-label">å¹³å‡æ•°</div>
                        <div class="answer-value" id="answerResult">?</div>
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§æ­¥éª¤é¢æ¿ -->
            <div class="right-panel">
                <div class="panel-title">
                    <i class="fas fa-calculator"></i> æ ¸å¿ƒå…¬å¼
                </div>
                <div class="formula-card">
                    <div class="formula">â€¢ å¹³å‡æ•° = æ€»æ•° Ã· ä¸ªæ•°</div>
                    <div class="formula">â€¢ æ€»æ•° = å¹³å‡æ•° Ã— ä¸ªæ•°</div>
                    <div class="formula">â€¢ åˆå¹¶å¹³å‡ = æ€»å’Œ Ã· æ€»äººæ•°</div>
                </div>
                
                <div class="panel-title">
                    <i class="fas fa-shoe-prints"></i> è§£é¢˜æ­¥éª¤
                </div>
                
                <div class="steps-container" id="stepsContainer">
                    <p style="color: #999; text-align: center; padding: 30px;">
                        ğŸ‘† ğŸ‘† ç‚¹å‡»ä¸‹ä¸€æ­¥å¼€å§‹è§£ç­”
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentType = 'basic';
        let stepsData = [];
        let currentStep = 0;
        let maxReachedStep = 0;
        let finalResult = null;
        let finalSum = null;
        
        // é‡ç½®æ­¥éª¤å’ŒåŠ¨ç”»
        function resetSteps() {
            stepsData = [];
            currentStep = 0;
            maxReachedStep = 0;
            finalResult = null;
            finalSum = null;
            const container = document.getElementById('stepsContainer');
            container.innerHTML = '<p style="color: #999; text-align: center; padding: 30px;">ğŸ‘† ğŸ‘† ç‚¹å‡»ä¸‹ä¸€æ­¥å¼€å§‹è§£ç­”</p>';
            document.getElementById('prevBtn').disabled = true;
            document.getElementById('nextBtn').disabled = false;
        }
        
        // é€‰æ‹©é¢˜ç›®ç±»å‹
        function selectProblemType(type) {
            currentType = type;
            document.querySelectorAll('.problem-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('active');
            
            // æ˜¾ç¤º/éšè—ç›¸åº”çš„è¾“å…¥æ¡†
            document.getElementById('basicInputs').style.display = type === 'basic' ? 'block' : 'none';
            document.getElementById('totalInputs').style.display = type === 'total' ? 'block' : 'none';
            document.getElementById('combinedInputs').style.display = type === 'combined' ? 'block' : 'none';
            document.getElementById('changeInputs').style.display = type === 'change' ? 'block' : 'none';
            
            updateProblemDisplay();
            resetSteps();
        }
        
        // æ›´æ–°é¢˜ç›®æ˜¾ç¤º
        function updateProblemDisplay() {
            let problemText = '';
            let answerCardsHtml = '';
            
            if (currentType === 'basic') {
                const dataStr = document.getElementById('dataInput').value;
                const data = dataStr.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
                problemText = `å°æ˜${data.length}æ¬¡è€ƒè¯•æˆç»©åˆ†åˆ«æ˜¯ <span class="highlight">${data.join(', ')}</span> åˆ†ï¼Œ<br>æ±‚è¿™${data.length}æ¬¡è€ƒè¯•çš„å¹³å‡åˆ†æ˜¯å¤šå°‘ï¼Ÿ`;
                answerCardsHtml = `
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“</div>
                        <div class="answer-label">æ•°æ®ä¸ªæ•°</div>
                        <div class="answer-value">${data.length}</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“¦</div>
                        <div class="answer-label">æ€»å’Œ</div>
                        <div class="answer-value" id="answerSum">?</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“Š</div>
                        <div class="answer-label">å¹³å‡æ•°</div>
                        <div class="answer-value" id="answerResult">?</div>
                    </div>
                `;
                updateBarChart(data);
            } else if (currentType === 'total') {
                const avg = parseFloat(document.getElementById('avgInput').value) || 6;
                const count = parseInt(document.getElementById('countInput').value) || 5;
                problemText = `ä¸€ç»„æ•°æ®å…± <span class="highlight">${count}</span> ä¸ªï¼Œå¹³å‡æ•°æ˜¯ <span class="highlight">${avg}</span>ï¼Œ<br>æ±‚è¿™ç»„æ•°æ®çš„æ€»å’Œæ˜¯å¤šå°‘ï¼Ÿ`;
                answerCardsHtml = `
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“Š</div>
                        <div class="answer-label">å¹³å‡æ•°</div>
                        <div class="answer-value">${avg}</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ”¢</div>
                        <div class="answer-label">ä¸ªæ•°</div>
                        <div class="answer-value">${count}</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“¦</div>
                        <div class="answer-label">æ€»å’Œ</div>
                        <div class="answer-value" id="answerResult">?</div>
                    </div>
                `;
                // ç”Ÿæˆç¤ºæ„æ•°æ®
                const demoData = Array(count).fill(avg);
                updateBarChart(demoData);
            } else if (currentType === 'combined') {
                const avg1 = parseFloat(document.getElementById('avg1Input').value) || 6;
                const count1 = parseInt(document.getElementById('count1Input').value) || 3;
                const avg2 = parseFloat(document.getElementById('avg2Input').value) || 8;
                const count2 = parseInt(document.getElementById('count2Input').value) || 2;
                problemText = `ç¬¬ä¸€ç»„ <span class="highlight">${count1}</span> äººå¹³å‡åˆ† <span class="highlight">${avg1}</span>ï¼Œç¬¬äºŒç»„ <span class="highlight">${count2}</span> äººå¹³å‡åˆ† <span class="highlight">${avg2}</span>ï¼Œ<br>ä¸¤ç»„åˆå¹¶åçš„å¹³å‡åˆ†æ˜¯å¤šå°‘ï¼Ÿ`;
                answerCardsHtml = `
                    <div class="answer-card">
                        <div class="answer-icon">1ï¸âƒ£</div>
                        <div class="answer-label">ç¬¬ä¸€ç»„</div>
                        <div class="answer-value">${count1}äººÃ—${avg1}</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">2ï¸âƒ£</div>
                        <div class="answer-label">ç¬¬äºŒç»„</div>
                        <div class="answer-value">${count2}äººÃ—${avg2}</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“Š</div>
                        <div class="answer-label">åˆå¹¶å¹³å‡</div>
                        <div class="answer-value" id="answerResult">?</div>
                    </div>
                `;
                updateBarChart([avg1, avg2], ['ç¬¬ä¸€ç»„', 'ç¬¬äºŒç»„']);
            } else if (currentType === 'change') {
                const origAvg = parseFloat(document.getElementById('origAvgInput').value) || 6;
                const origCount = parseInt(document.getElementById('origCountInput').value) || 4;
                const newData = parseFloat(document.getElementById('newDataInput').value) || 9;
                problemText = `åŸæ¥ <span class="highlight">${origCount}</span> ä¸ªæ•°çš„å¹³å‡æ•°æ˜¯ <span class="highlight">${origAvg}</span>ï¼Œ<br>å¢åŠ ä¸€ä¸ªæ•° <span class="highlight">${newData}</span> åï¼Œæ–°çš„å¹³å‡æ•°æ˜¯å¤šå°‘ï¼Ÿ`;
                answerCardsHtml = `
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“Š</div>
                        <div class="answer-label">åŸå¹³å‡</div>
                        <div class="answer-value">${origAvg}</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">â•</div>
                        <div class="answer-label">æ–°å¢</div>
                        <div class="answer-value">${newData}</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“Š</div>
                        <div class="answer-label">æ–°å¹³å‡</div>
                        <div class="answer-value" id="answerResult">?</div>
                    </div>
                `;
                const demoData = Array(origCount).fill(origAvg);
                demoData.push(newData);
                updateBarChart(demoData);
            }
            
            document.getElementById('problemDisplay').innerHTML = problemText;
            document.getElementById('answerCards').innerHTML = answerCardsHtml;
        }
        
        // æ›´æ–°æŸ±çŠ¶å›¾
        function updateBarChart(data, labels = null) {
            const chart = document.getElementById('barChart');
            const maxVal = Math.max(...data) * 1.2;
            
            chart.innerHTML = '';
            data.forEach((val, i) => {
                const item = document.createElement('div');
                item.className = 'bar-item';
                const height = (val / maxVal) * 150;
                item.innerHTML = `
                    <div class="bar" style="height: ${height}px">${val}</div>
                    <div class="bar-label">${labels ? labels[i] : 'ç¬¬' + (i + 1) + 'ä¸ª'}</div>
                `;
                chart.appendChild(item);
            });
            
            document.getElementById('averageLine').setAttribute('data-value', 'å¹³å‡: ?');
        }
        
        // å¼€å§‹è®¡ç®—
        function startCalculation() {
            if (currentType === 'basic') {
                calculateBasic();
            } else if (currentType === 'total') {
                calculateTotal();
            } else if (currentType === 'combined') {
                calculateCombined();
            } else if (currentType === 'change') {
                calculateChange();
            }
        }
        
        // è®¡ç®—åŸºç¡€å¹³å‡æ•°
        function calculateBasic() {
            const dataStr = document.getElementById('dataInput').value;
            const data = dataStr.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
            const sum = data.reduce((a, b) => a + b, 0);
            const avg = sum / data.length;
            
            const steps = [
                { text: `<strong>é¢˜ç›®åˆ†æ</strong>ï¼šæ±‚${data.length}ä¸ªæ•°çš„å¹³å‡æ•°` },
                { text: `å·²çŸ¥æ•°æ®ï¼š<strong>${data.join(', ')}</strong>` },
                { text: `<strong>å…¬å¼</strong>ï¼šå¹³å‡æ•° = æ€»å’Œ Ã· ä¸ªæ•°` },
                { text: `<strong>ç¬¬ä¸€æ­¥</strong>ï¼šæ±‚æ€»å’Œ` },
                { text: `æ€»å’Œ = ${data.join(' + ')} = <strong>${sum}</strong>` },
                { text: `<strong>ç¬¬äºŒæ­¥</strong>ï¼šæ±‚å¹³å‡æ•°` },
                { text: `å¹³å‡æ•° = ${sum} Ã· ${data.length} = <strong>${avg.toFixed(2)}</strong>` }
            ];
            
            displaySteps(steps, avg % 1 === 0 ? avg : avg.toFixed(2), `å¹³å‡æ•°æ˜¯ ${avg % 1 === 0 ? avg : avg.toFixed(2)}`, sum);
            document.getElementById('averageLine').setAttribute('data-value', `å¹³å‡: ${avg.toFixed(1)}`);
        }
        
        // è®¡ç®—æ€»æ•°
        function calculateTotal() {
            const avg = parseFloat(document.getElementById('avgInput').value) || 6;
            const count = parseInt(document.getElementById('countInput').value) || 5;
            const total = avg * count;
            
            const steps = [
                { text: `<strong>é¢˜ç›®åˆ†æ</strong>ï¼šå·²çŸ¥å¹³å‡æ•°å’Œä¸ªæ•°ï¼Œæ±‚æ€»å’Œ` },
                { text: `å·²çŸ¥ï¼šå¹³å‡æ•° = <strong>${avg}</strong>ï¼Œä¸ªæ•° = <strong>${count}</strong>` },
                { text: `<strong>å…¬å¼å˜å½¢</strong>ï¼šæ€»å’Œ = å¹³å‡æ•° Ã— ä¸ªæ•°` },
                { text: `<strong>ä»£å…¥è®¡ç®—</strong>ï¼šæ€»å’Œ = ${avg} Ã— ${count}` },
                { text: `<strong>è®¡ç®—</strong>ï¼šæ€»å’Œ = <strong>${total}</strong>` }
            ];
            
            displaySteps(steps, total, `æ€»å’Œæ˜¯ ${total}`);
        }
        
        // è®¡ç®—åˆå¹¶å¹³å‡æ•°
        function calculateCombined() {
            const avg1 = parseFloat(document.getElementById('avg1Input').value) || 6;
            const count1 = parseInt(document.getElementById('count1Input').value) || 3;
            const avg2 = parseFloat(document.getElementById('avg2Input').value) || 8;
            const count2 = parseInt(document.getElementById('count2Input').value) || 2;
            
            const total1 = avg1 * count1;
            const total2 = avg2 * count2;
            const totalSum = total1 + total2;
            const totalCount = count1 + count2;
            const result = totalSum / totalCount;
            
            const steps = [
                { text: `<strong>é¢˜ç›®åˆ†æ</strong>ï¼šä¸¤ç»„æ•°æ®åˆå¹¶åæ±‚å¹³å‡æ•°` },
                { text: `å·²çŸ¥ï¼šç¬¬ä¸€ç»„ ${count1} äººå¹³å‡ ${avg1}ï¼Œç¬¬äºŒç»„ ${count2} äººå¹³å‡ ${avg2}` },
                { text: `<strong>âš ï¸ æ³¨æ„</strong>ï¼šä¸èƒ½ç›´æ¥ (${avg1} + ${avg2}) Ã· 2 = ${(avg1 + avg2) / 2}ï¼Œå› ä¸ºäººæ•°ä¸åŒï¼` },
                { text: `<strong>æ­£ç¡®æ–¹æ³•</strong>ï¼šå…ˆæ±‚å„ç»„æ€»åˆ†ï¼Œå†æ±‚æ•´ä½“å¹³å‡` },
                { text: `ç¬¬ä¸€ç»„æ€»åˆ† = ${avg1} Ã— ${count1} = <strong>${total1}</strong>` },
                { text: `ç¬¬äºŒç»„æ€»åˆ† = ${avg2} Ã— ${count2} = <strong>${total2}</strong>` },
                { text: `æ€»åˆ† = ${total1} + ${total2} = <strong>${totalSum}</strong>` },
                { text: `æ€»äººæ•° = ${count1} + ${count2} = <strong>${totalCount}</strong>` },
                { text: `åˆå¹¶å¹³å‡ = ${totalSum} Ã· ${totalCount} = <strong>${result.toFixed(2)}</strong>` }
            ];
            
            displaySteps(steps, result % 1 === 0 ? result : result.toFixed(2), `åˆå¹¶åå¹³å‡æ•°æ˜¯ ${result % 1 === 0 ? result : result.toFixed(2)}`);
        }
        
        // è®¡ç®—å˜åŒ–åå¹³å‡æ•°
        function calculateChange() {
            const origAvg = parseFloat(document.getElementById('origAvgInput').value) || 6;
            const origCount = parseInt(document.getElementById('origCountInput').value) || 4;
            const newData = parseFloat(document.getElementById('newDataInput').value) || 9;
            
            const origTotal = origAvg * origCount;
            const newTotal = origTotal + newData;
            const newCount = origCount + 1;
            const result = newTotal / newCount;
            
            const steps = [
                { text: `<strong>é¢˜ç›®åˆ†æ</strong>ï¼šå¢åŠ ä¸€ä¸ªæ•°åï¼Œæ±‚æ–°çš„å¹³å‡æ•°` },
                { text: `å·²çŸ¥ï¼šåŸæ¥ ${origCount} ä¸ªæ•°å¹³å‡ ${origAvg}ï¼Œæ–°å¢ ${newData}` },
                { text: `<strong>ç¬¬ä¸€æ­¥</strong>ï¼šæ±‚åŸæ¥çš„æ€»å’Œ` },
                { text: `åŸæ€»å’Œ = ${origAvg} Ã— ${origCount} = <strong>${origTotal}</strong>` },
                { text: `<strong>ç¬¬äºŒæ­¥</strong>ï¼šæ±‚æ–°çš„æ€»å’Œ` },
                { text: `æ–°æ€»å’Œ = ${origTotal} + ${newData} = <strong>${newTotal}</strong>` },
                { text: `<strong>ç¬¬ä¸‰æ­¥</strong>ï¼šæ±‚æ–°çš„å¹³å‡æ•°` },
                { text: `æ–°ä¸ªæ•° = ${origCount} + 1 = <strong>${newCount}</strong>` },
                { text: `æ–°å¹³å‡ = ${newTotal} Ã· ${newCount} = <strong>${result.toFixed(2)}</strong>` }
            ];
            
            displaySteps(steps, result % 1 === 0 ? result : result.toFixed(2), `æ–°å¹³å‡æ•°æ˜¯ ${result % 1 === 0 ? result : result.toFixed(2)}`);
            document.getElementById('averageLine').setAttribute('data-value', `æ–°å¹³å‡: ${result.toFixed(1)}`);
        }
        
        // æ˜¾ç¤ºæ­¥éª¤
        function displaySteps(steps, result, resultText, sum = null) {
            const container = document.getElementById('stepsContainer');
            container.innerHTML = '';
            stepsData = [];
            finalResult = result;
            finalSum = sum;
            
            steps.forEach((step, index) => {
                const stepEl = document.createElement('div');
                stepEl.className = 'step-item';
                stepEl.innerHTML = `
                    <span class="step-number">${index + 1}</span>
                    <span class="step-content">${step.text}</span>
                `;
                container.appendChild(stepEl);
                stepsData.push(stepEl);
            });
            
            // æ·»åŠ ç»“æœæ¡†
            const resultBox = document.createElement('div');
            resultBox.className = 'result-box';
            resultBox.innerHTML = `ğŸ¯ ç­”æ¡ˆï¼š${resultText}`;
            container.appendChild(resultBox);
            
            currentStep = 0;
            maxReachedStep = 0;
            updateStepVisibility();
            updateButtons();
        }
        
        // æ›´æ–°æ­¥éª¤å¯è§æ€§
        function updateStepVisibility() {
            stepsData.forEach((step, index) => {
                step.classList.toggle('visible', index <= maxReachedStep);
                step.classList.toggle('active', index === currentStep);
            });
            
            // æ§åˆ¶ç»“æœæ¡†æ˜¾ç¤º
            const resultBox = document.querySelector('.result-box');
            if (resultBox) {
                if (stepsData.length > 0 && maxReachedStep >= stepsData.length - 1) {
                    resultBox.classList.add('visible');
                    // æ›´æ–°ç­”æ¡ˆå¡ç‰‡
                    const resultEl = document.getElementById('answerResult');
                    const sumEl = document.getElementById('answerSum');
                    if (resultEl && finalResult !== null) {
                        resultEl.textContent = finalResult;
                    }
                    if (sumEl && finalSum !== null) {
                        sumEl.textContent = finalSum;
                    }
                } else {
                    resultBox.classList.remove('visible');
                }
            }
            
            if (stepsData[currentStep]) {
                stepsData[currentStep].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtons() {
            document.getElementById('prevBtn').disabled = currentStep === 0;
            document.getElementById('nextBtn').disabled = currentStep >= stepsData.length - 1;
        }
        
        // ä¸Šä¸€æ­¥
        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateStepVisibility();
                updateButtons();
            }
        }
        
        // ä¸‹ä¸€æ­¥
        function nextStep() {
            // å¦‚æœè¿˜æ²¡æœ‰ç”Ÿæˆæ­¥éª¤ï¼Œå…ˆç”Ÿæˆ
            if (stepsData.length === 0) {
                startCalculation();
                return;
            }
            if (currentStep < stepsData.length - 1) {
                currentStep++;
                if (currentStep > maxReachedStep) {
                    maxReachedStep = currentStep;
                }
                updateStepVisibility();
                updateButtons();
            }
        }
        
        // ä¸€é”®æŸ¥çœ‹æ‰€æœ‰æ­¥éª¤
        function showAllSteps() {
            if (stepsData.length === 0) {
                startCalculation();
            }
            if (stepsData.length > 0) {
                maxReachedStep = stepsData.length - 1;
                currentStep = stepsData.length - 1;
                updateStepVisibility();
                updateButtons();
            }
        }
        
        // ç›‘å¬è¾“å…¥å˜åŒ– - é‡ç½®æ­¥éª¤
        function onInputChange() {
            updateProblemDisplay();
            resetSteps();
        }
        
        document.getElementById('dataInput').addEventListener('input', onInputChange);
        document.getElementById('avgInput').addEventListener('input', onInputChange);
        document.getElementById('countInput').addEventListener('input', onInputChange);
        document.getElementById('avg1Input').addEventListener('input', onInputChange);
        document.getElementById('count1Input').addEventListener('input', onInputChange);
        document.getElementById('avg2Input').addEventListener('input', onInputChange);
        document.getElementById('count2Input').addEventListener('input', onInputChange);
        document.getElementById('origAvgInput').addEventListener('input', onInputChange);
        document.getElementById('origCountInput').addEventListener('input', onInputChange);
        document.getElementById('newDataInput').addEventListener('input', onInputChange);
        
        // åˆå§‹åŒ–
        updateProblemDisplay();
    </script>
    <a href="../../index.html" style="display:block;text-align:center;margin:30px auto;color:#fff;text-decoration:none;font-size:14px;">â† è¿”å›çš®å¡ä¸˜å­¦ä¹ èµ„æº</a>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />    
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="Expires" content="0">
    <link rel="Shortcut Icon" href="https://cdn.bihe0832.com/images/zixie_32.ico" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="author" content="å­å‹°(bihe0832), code@bihe0832.com" />
    <meta name="keywords" content="å­å‹°,bihe0832,çš®å¡ä¸˜,æ•°å­¦,å’Œå·®å€é—®é¢˜" />
    <meta name="description" content="çš®å¡ä¸˜å­¦æ•°å­¦ä¹‹å’Œå·®å€é—®é¢˜åˆ†æ­¥è§£ç­”" />
    <meta property="og:title" content="çš®å¡ä¸˜å­¦æ•°å­¦ - å’Œå·®å€é—®é¢˜" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:description" content="çš®å¡ä¸˜å­¦æ•°å­¦ä¹‹å’Œå·®å€é—®é¢˜åˆ†æ­¥è§£ç­”" />
    <link rel="canonical" href="https://demo.bihe0832.com/pikachu/shuxue/sum_diff/sum_diff.html" />
    <meta property="og:url" content="https://demo.bihe0832.com/pikachu/shuxue/sum_diff/sum_diff.html" />
    <meta property="og:site_name" content="çš®å¡ä¸˜å­¦ä¹ èµ„æº" />
    <meta property="og:type" content="article" />
    <meta name="google-site-verification" content="3wzNgbjvFNHkH-8QpougMZ0s9Y4GEjG49kEb49QQqpw" />
    <title>çš®å¡ä¸˜å­¦æ•°å­¦ - å’Œå·®å€é—®é¢˜</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #3498db, #9b59b6);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 1400px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            margin: 20px 0;
            padding: 20px;
        }
        header {
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        header h2 {
            font-size: 2rem;
            margin: 10px 0;
            text-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }
        header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            gap: 20px;
            height: 660px;
            overflow: hidden;
        }
        
        .left-panel {
            width: 320px;
            flex-shrink: 0;
            background: #f0f8ff;
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .panel-title {
            font-size: 1.1rem;
            color: #2980b9;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 3px solid #3498db;
            display: flex;
            align-items: center;
        }
        .panel-title i {
            margin-right: 10px;
            font-size: 1.2rem;
            color: #3498db;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        .input-item {
            margin-bottom: 12px;
        }
        .input-label {
            display: block;
            font-weight: bold;
            margin-bottom: 6px;
            color: #2980b9;
            font-size: 0.9rem;
        }
        input, select {
            padding: 10px 12px;
            width: 100%;
            border: 2px solid #3498db;
            border-radius: 10px;
            font-size: 1rem;
            text-align: center;
            transition: all 0.3s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #2980b9;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }
        
        .problem-type-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .type-btn {
            flex: 1;
            min-width: 80px;
            padding: 10px 5px;
            border: 2px solid #3498db;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }
        
        .type-btn.active {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }
        
        .type-btn:hover {
            transform: translateY(-2px);
        }
        
        .start-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
            margin-top: 20px;
        }
        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }
        
        /* ä¸­é—´å¯è§†åŒ–åŒºåŸŸ */
        .center-panel {
            flex: 1;
            min-width: 400px;
            background: #f5faff;
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .problem-display {
            text-align: left;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .problem-display .highlight {
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        /* çº¿æ®µå›¾å¯è§†åŒ– */
        .visualization {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .bar-diagram {
            width: 100%;
            max-width: 500px;
        }
        
        .bar-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            position: relative;
        }
        
        .bar-label {
            width: 60px;
            font-weight: bold;
            color: #2980b9;
            font-size: 0.9rem;
        }
        
        .bar-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 0;
        }
        
        .bar-segment {
            height: 40px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.5s;
        }
        
        .bar-segment.large {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .bar-segment.small {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .bar-segment.small-red {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .bar-segment.diff {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            border-radius: 0 5px 5px 0;
            border-left: 2px dashed white;
        }
        
        .bar-segment.base {
            border-radius: 5px 0 0 5px;
        }
        
        .bar-segment.mul-unit {
            border-right: 2px dashed rgba(255,255,255,0.5);
        }
        
        .bar-segment.mul-unit:last-child {
            border-right: none;
            border-radius: 0 5px 5px 0;
        }
        
        .bar-segment.mul-unit:first-child {
            border-radius: 5px 0 0 5px;
        }
        
        .diff-bracket {
            position: absolute;
            right: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .diff-label {
            background: #f39c12;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .sum-bracket {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
            padding: 8px 15px;
            background: rgba(39, 174, 96, 0.1);
            border: 2px solid #27ae60;
            border-radius: 10px;
        }
        
        .sum-label {
            color: #27ae60;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .formula-box {
            background: linear-gradient(135deg, #fff3cd, #ffeeba);
            border: 2px solid #f39c12;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
        }
        
        .formula-box .formula {
            font-size: 1.1rem;
            font-weight: bold;
            color: #856404;
            margin-bottom: 5px;
        }
        
        .formula-box .formula-note {
            font-size: 0.85rem;
            color: #856404;
        }
        
        .answer-cards {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .answer-card {
            background: white;
            border-radius: 15px;
            padding: 15px 25px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border: 3px solid #3498db;
        }
        
        .answer-card .answer-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }
        
        .answer-card .answer-label {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }
        
        .answer-card .answer-value {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
        }
        
        .answer-card .answer-value.small-num {
            color: #e74c3c;
        }
        
        /* å³ä¾§æ­¥éª¤é¢æ¿ */
        .right-panel {
            width: 380px;
            flex-shrink: 0;
            background: #f0f8ff;
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            max-height: 600px;
        }
        
        .steps-container {
            flex: 1;
            overflow-y: auto;
            max-height: 480px;
            padding: 15px;
            background: linear-gradient(to right, #e3f2fd, #bbdefb);
            border-radius: 12px;
        }
        
        .steps-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .steps-container::-webkit-scrollbar-track {
            background: #d6eaf8;
            border-radius: 3px;
        }
        
        .steps-container::-webkit-scrollbar-thumb {
            background: #3498db;
            border-radius: 3px;
        }
        
        .step-item {
            padding: 10px 0;
            margin-bottom: 0;
            border-left: none;
            border-bottom: 1px dashed rgba(52, 152, 219, 0.3);
            opacity: 0.5;
            transform: translateX(20px);
            transition: all 0.3s;
            background: transparent;
            border-radius: 0;
        }
        
        .step-item:last-child {
            border-bottom: none;
        }
        
        .step-item.visible {
            opacity: 1;
            transform: translateX(0);
        }
        
        .step-item.active {
            animation: breatheBlue 1.5s ease-in-out infinite;
        }
        
        @keyframes breatheBlue {
            0%, 100% { background-color: rgba(52, 152, 219, 0.1); }
            50% { background-color: rgba(52, 152, 219, 0.25); }
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 12px;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .step-title {
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .highlight {
            color: #e74c3c;
            font-weight: bold;
            background-color: #ffecb3;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .nav-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .nav-btn.prev {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            color: white;
        }
        
        .nav-btn.next {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            .left-panel, .right-panel {
                width: 100%;
            }
            .center-panel {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h2>âš¡ çš®å¡ä¸˜å­¦æ•°å­¦ - å’Œå·®å€é—®é¢˜ ğŸ“Š</h2>
            <p>å’Œå·®é—®é¢˜ï¼šå¤§æ•°=(å’Œ+å·®)Ã·2 | å’Œå€é—®é¢˜ï¼šå°æ•°=å’ŒÃ·(å€æ•°+1) | å·®å€é—®é¢˜ï¼šå°æ•°=å·®Ã·(å€æ•°-1)</p>
        </header>
        
        <div class="main-content">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="left-panel">
                <div class="panel-title">
                    <i class="fas fa-cog"></i> é¢˜ç›®ç±»å‹
                </div>
                
                <div class="problem-type-selector">
                    <button class="type-btn active" onclick="selectType('sum_diff')" id="typeSumDiff">å’Œå·®é—®é¢˜</button>
                    <button class="type-btn" onclick="selectType('sum_mul')" id="typeSumMul">å’Œå€é—®é¢˜</button>
                    <button class="type-btn" onclick="selectType('diff_mul')" id="typeDiffMul">å·®å€é—®é¢˜</button>
                </div>
                
                <div class="input-group" id="inputGroup">
                    <!-- å’Œå·®é—®é¢˜è¾“å…¥ -->
                    <div id="sumDiffInputs">
                        <div class="input-item">
                            <label class="input-label">â• ä¸¤æ•°ä¹‹å’Œ</label>
                            <input type="number" id="sumValue" value="50" placeholder="å’Œ">
                        </div>
                        <div class="input-item">
                            <label class="input-label">â– ä¸¤æ•°ä¹‹å·®</label>
                            <input type="number" id="diffValue" value="10" placeholder="å·®">
                        </div>
                    </div>
                    
                    <!-- å’Œå€é—®é¢˜è¾“å…¥ -->
                    <div id="sumMulInputs" style="display:none;">
                        <div class="input-item">
                            <label class="input-label">â• ä¸¤æ•°ä¹‹å’Œ</label>
                            <input type="number" id="sumValue2" value="48" placeholder="å’Œ">
                        </div>
                        <div class="input-item">
                            <label class="input-label">âœ–ï¸ å¤§æ•°æ˜¯å°æ•°çš„å‡ å€</label>
                            <input type="number" id="mulValue" value="3" min="1" placeholder="å€æ•°">
                        </div>
                    </div>
                    
                    <!-- å·®å€é—®é¢˜è¾“å…¥ -->
                    <div id="diffMulInputs" style="display:none;">
                        <div class="input-item">
                            <label class="input-label">â– ä¸¤æ•°ä¹‹å·®</label>
                            <input type="number" id="diffValue2" value="20" placeholder="å·®">
                        </div>
                        <div class="input-item">
                            <label class="input-label">âœ–ï¸ å¤§æ•°æ˜¯å°æ•°çš„å‡ å€</label>
                            <input type="number" id="mulValue2" value="3" min="2" placeholder="å€æ•°">
                        </div>
                    </div>
                </div>
                
                <div class="formula-box">
                    <div class="formula" id="formulaDisplay">
                        å¤§æ•° = (å’Œ+å·®) Ã· 2<br>
                        å°æ•° = (å’Œ-å·®) Ã· 2
                    </div>
                </div>
                
                <div class="nav-buttons">
                    <button class="nav-btn prev" onclick="prevStep()" id="prevBtn" disabled>
                        <i class="fas fa-arrow-left"></i> ä¸Šä¸€æ­¥
                    </button>
                    <button class="nav-btn next" onclick="nextStep()" id="nextBtn">
                        ä¸‹ä¸€æ­¥ <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                
                <button class="show-all-btn" onclick="showAllSteps()">
                    <i class="fas fa-eye"></i> ä¸€é”®æŸ¥çœ‹
                </button>
            </div>
            
            <!-- ä¸­é—´å¯è§†åŒ–åŒºåŸŸ -->
            <div class="center-panel">
                <div class="panel-title">
                    <i class="fas fa-question-circle"></i> é¢˜ç›®
                </div>
                <div class="problem-display" id="problemDisplay">
                    ä¸¤ä¸ªæ•°çš„å’Œæ˜¯ <span class="highlight">50</span>ï¼Œå·®æ˜¯ <span class="highlight">10</span>ï¼Œ<br>
                    æ±‚è¿™ä¸¤ä¸ªæ•°åˆ†åˆ«æ˜¯å¤šå°‘ï¼Ÿ
                </div>
                
                <div class="panel-title">
                    <i class="fas fa-chart-bar"></i> çº¿æ®µå›¾
                </div>
                
                <div class="visualization">
                    <div class="bar-diagram" id="barDiagram">
                        <!-- åŠ¨æ€ç”Ÿæˆçš„çº¿æ®µå›¾ -->
                    </div>
                </div>
                
                <div class="answer-cards">
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“ˆ</div>
                        <div class="answer-label">å¤§æ•°</div>
                        <div class="answer-value" id="answerLarge">?</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“‰</div>
                        <div class="answer-label">å°æ•°</div>
                        <div class="answer-value small-num" id="answerSmall">?</div>
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§æ­¥éª¤é¢æ¿ -->
            <div class="right-panel">
                <div class="panel-title">
                    <i class="fas fa-shoe-prints"></i> è§£é¢˜æ­¥éª¤
                </div>
                
                <div class="steps-container" id="stepsContainer">
                    <div class="step-item">
                        <span class="step-number">1</span>
                        <span class="step-content">ğŸ‘† ç‚¹å‡»"ä¸‹ä¸€æ­¥"å¼€å§‹è§£ç­”</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let problemType = 'sum_diff';
        let stepsData = [];
        let currentStep = 0;
        let maxReachedStep = 0;
        
        // é€‰æ‹©é¢˜ç›®ç±»å‹
        function selectType(type) {
            problemType = type;
            
            document.getElementById('typeSumDiff').classList.toggle('active', type === 'sum_diff');
            document.getElementById('typeSumMul').classList.toggle('active', type === 'sum_mul');
            document.getElementById('typeDiffMul').classList.toggle('active', type === 'diff_mul');
            
            document.getElementById('sumDiffInputs').style.display = type === 'sum_diff' ? 'block' : 'none';
            document.getElementById('sumMulInputs').style.display = type === 'sum_mul' ? 'block' : 'none';
            document.getElementById('diffMulInputs').style.display = type === 'diff_mul' ? 'block' : 'none';
            
            if (type === 'sum_diff') {
                document.getElementById('formulaDisplay').innerHTML = 'å¤§æ•° = (å’Œ+å·®) Ã· 2<br>å°æ•° = (å’Œ-å·®) Ã· 2';
            } else if (type === 'sum_mul') {
                document.getElementById('formulaDisplay').innerHTML = 'å°æ•° = å’Œ Ã· (å€æ•°+1)<br>å¤§æ•° = å°æ•° Ã— å€æ•°';
            } else {
                document.getElementById('formulaDisplay').innerHTML = 'å°æ•° = å·® Ã· (å€æ•°-1)<br>å¤§æ•° = å°æ•° Ã— å€æ•°';
            }
            
            updateProblemText();
            resetDemo();
        }
        
        // æ›´æ–°é¢˜ç›®æ–‡æœ¬
        function updateProblemText() {
            let text = '';
            
            if (problemType === 'sum_diff') {
                const sum = document.getElementById('sumValue').value || '?';
                const diff = document.getElementById('diffValue').value || '?';
                text = `ä¸¤ä¸ªæ•°çš„å’Œæ˜¯ <span class="highlight">${sum}</span>ï¼Œå·®æ˜¯ <span class="highlight">${diff}</span>ï¼Œ<br>æ±‚è¿™ä¸¤ä¸ªæ•°åˆ†åˆ«æ˜¯å¤šå°‘ï¼Ÿ`;
            } else if (problemType === 'sum_mul') {
                const sum = document.getElementById('sumValue2').value || '?';
                const mul = document.getElementById('mulValue').value || '?';
                text = `ä¸¤ä¸ªæ•°çš„å’Œæ˜¯ <span class="highlight">${sum}</span>ï¼Œå¤§æ•°æ˜¯å°æ•°çš„ <span class="highlight">${mul}</span> å€ï¼Œ<br>æ±‚è¿™ä¸¤ä¸ªæ•°åˆ†åˆ«æ˜¯å¤šå°‘ï¼Ÿ`;
            } else {
                const diff = document.getElementById('diffValue2').value || '?';
                const mul = document.getElementById('mulValue2').value || '?';
                text = `ä¸¤ä¸ªæ•°çš„å·®æ˜¯ <span class="highlight">${diff}</span>ï¼Œå¤§æ•°æ˜¯å°æ•°çš„ <span class="highlight">${mul}</span> å€ï¼Œ<br>æ±‚è¿™ä¸¤ä¸ªæ•°åˆ†åˆ«æ˜¯å¤šå°‘ï¼Ÿ`;
            }
            
            document.getElementById('problemDisplay').innerHTML = text;
        }
        
        // æ›´æ–°çº¿æ®µå›¾ - å’Œå·®é—®é¢˜
        function updateBarDiagramSumDiff(large, small, diff, showDiff = false, showValues = false) {
            const maxWidth = 350;
            const maxVal = Math.max(large, 1);
            
            const largeWidth = (large / maxVal) * maxWidth;
            const smallWidth = (small / maxVal) * maxWidth;
            const diffWidth = ((large - small) / maxVal) * maxWidth;
            
            const diagram = document.getElementById('barDiagram');
            
            let html = '';
            
            // å¤§æ•°è¡Œ
            html += '<div class="bar-row">';
            html += '<span class="bar-label">å¤§æ•°ï¼š</span>';
            html += '<div class="bar-container">';
            if (showDiff) {
                html += `<div class="bar-segment large base" style="width: ${smallWidth}px;">${showValues ? small : ''}</div>`;
                html += `<div class="bar-segment diff" style="width: ${diffWidth}px;">å·®=${diff}</div>`;
            } else {
                html += `<div class="bar-segment large" style="width: ${largeWidth}px;">${showValues ? large : '?'}</div>`;
            }
            html += '</div>';
            html += '</div>';
            
            // å°æ•°è¡Œ
            html += '<div class="bar-row">';
            html += '<span class="bar-label">å°æ•°ï¼š</span>';
            html += '<div class="bar-container">';
            html += `<div class="bar-segment small-red" style="width: ${smallWidth}px;">${showValues ? small : '?'}</div>`;
            html += '</div>';
            html += '</div>';
            
            diagram.innerHTML = html;
        }
        
        // æ›´æ–°çº¿æ®µå›¾ - å’Œå€/å·®å€é—®é¢˜
        function updateBarDiagramMul(large, small, mul, showMul = false, showValues = false) {
            const maxWidth = 350;
            const maxVal = Math.max(large, 1);
            
            const unitWidth = (small / maxVal) * maxWidth;
            
            const diagram = document.getElementById('barDiagram');
            
            let html = '';
            
            // å¤§æ•°è¡Œï¼ˆmulä»½ï¼‰
            html += '<div class="bar-row">';
            html += '<span class="bar-label">å¤§æ•°ï¼š</span>';
            html += '<div class="bar-container">';
            if (showMul) {
                for (let i = 0; i < mul; i++) {
                    const isLast = i === mul - 1;
                    const isFirst = i === 0;
                    let classes = 'bar-segment large mul-unit';
                    if (isFirst) classes += ' first';
                    html += `<div class="${classes}" style="width: ${unitWidth}px;">${i === 0 ? '1ä»½' : ''}</div>`;
                }
            } else {
                html += `<div class="bar-segment large" style="width: ${unitWidth * mul}px;">${showValues ? fmt(large) : '?'}</div>`;
            }
            html += '</div>';
            if (showMul) {
                html += `<span style="margin-left:10px;color:#666;font-size:0.85rem;">${mul}ä»½</span>`;
            }
            html += '</div>';
            
            // å°æ•°è¡Œï¼ˆ1ä»½ï¼‰
            html += '<div class="bar-row">';
            html += '<span class="bar-label">å°æ•°ï¼š</span>';
            html += '<div class="bar-container">';
            html += `<div class="bar-segment small-red" style="width: ${unitWidth}px;">${showMul ? '1ä»½' : (showValues ? fmt(small) : '?')}</div>`;
            html += '</div>';
            if (showMul) {
                html += `<span style="margin-left:10px;color:#666;font-size:0.85rem;">1ä»½</span>`;
            }
            html += '</div>';
            
            diagram.innerHTML = html;
        }
        
        // ç®€å•æ›´æ–°çº¿æ®µå›¾ï¼ˆåˆå§‹çŠ¶æ€ï¼‰
        function updateBarDiagram(large, small, showValues = false) {
            const maxWidth = 350;
            const maxVal = Math.max(large, small, 1);
            
            const largeWidth = (large / maxVal) * maxWidth;
            const smallWidth = (small / maxVal) * maxWidth;
            
            const diagram = document.getElementById('barDiagram');
            
            let html = '';
            html += '<div class="bar-row">';
            html += '<span class="bar-label">å¤§æ•°ï¼š</span>';
            html += '<div class="bar-container">';
            html += `<div class="bar-segment large" style="width: ${largeWidth}px;">${showValues ? fmt(large) : '?'}</div>`;
            html += '</div></div>';
            
            html += '<div class="bar-row">';
            html += '<span class="bar-label">å°æ•°ï¼š</span>';
            html += '<div class="bar-container">';
            html += `<div class="bar-segment small-red" style="width: ${smallWidth}px;">${showValues ? fmt(small) : '?'}</div>`;
            html += '</div></div>';
            
            diagram.innerHTML = html;
        }
        
        // å¼€å§‹è®¡ç®—
        function startCalculation() {
            if (problemType === 'sum_diff') {
                calculateSumDiff();
            } else if (problemType === 'sum_mul') {
                calculateSumMul();
            } else {
                calculateDiffMul();
            }
        }
        
        // å’Œå·®é—®é¢˜
        function calculateSumDiff() {
            const sum = parseFloat(document.getElementById('sumValue').value);
            const diff = parseFloat(document.getElementById('diffValue').value);
            
            if (isNaN(sum) || isNaN(diff)) {
                alert('è¯·è¾“å…¥æ­£ç¡®çš„æ•°å€¼');
                return;
            }
            
            if (diff > sum) {
                alert('å·®ä¸èƒ½å¤§äºå’Œ');
                return;
            }
            
            if ((sum + diff) % 2 !== 0 || (sum - diff) % 2 !== 0) {
                alert('å’Œä¸å·®çš„å¥‡å¶æ€§ä¸åŒï¼Œæ— æ•´æ•°è§£');
                return;
            }
            
            const large = (sum + diff) / 2;
            const small = (sum - diff) / 2;
            
            updateBarDiagram(large, small, false);
            
            const steps = [];
            
            steps.push({
                text: `å’Œå·®é—®é¢˜ï¼šå·²çŸ¥ä¸¤æ•°çš„å’Œä¸å·®ï¼Œæ±‚è¿™ä¸¤ä¸ªæ•°`,
                action: null
            });
            
            steps.push({
                text: `å·²çŸ¥ï¼šå’Œ = <span class="highlight">${sum}</span>ï¼Œå·® = <span class="highlight">${diff}</span>`,
                action: 'init_bars'
            });
            
            steps.push({
                text: `ç”»çº¿æ®µå›¾ç†è§£ï¼šå¤§æ•°æ¯”å°æ•°å¤šå‡º"å·®"è¿™ä¸€æ®µ`,
                action: 'show_diff'
            });
            
            steps.push({
                text: `å…³é”®æ€è·¯ï¼šå¦‚æœæŠŠå¤§æ•°"å¤šå‡ºçš„éƒ¨åˆ†"è¡¥åˆ°å°æ•°ä¸Šï¼Œä¸¤æ•°å°±ç›¸ç­‰äº†`,
                action: null
            });
            
            steps.push({
                text: `æ±‚å¤§æ•°ï¼šæŠŠå·®åŠ åˆ°å’Œä¸Šï¼Œç›¸å½“äºä¸¤ä¸ªå¤§æ•°<br>(${sum} + ${diff}) Ã· 2 = ${sum + diff} Ã· 2 = <span class="highlight">${large}</span>`,
                action: null
            });
            
            steps.push({
                text: `æ±‚å°æ•°ï¼šä»å’Œä¸­å‡å»å·®ï¼Œç›¸å½“äºä¸¤ä¸ªå°æ•°<br>(${sum} - ${diff}) Ã· 2 = ${sum - diff} Ã· 2 = <span class="highlight">${small}</span>`,
                action: null
            });
            
            steps.push({
                text: `âœ“ ç­”æ¡ˆï¼šå¤§æ•°æ˜¯ <span class="highlight">${large}</span>ï¼Œå°æ•°æ˜¯ <span class="highlight">${small}</span>`,
                action: 'show_result'
            });
            
            steps.push({
                text: `éªŒè¯ï¼š${large} + ${small} = ${large + small}ï¼ˆå’Œï¼‰âœ“<br>${large} - ${small} = ${large - small}ï¼ˆå·®ï¼‰âœ“`,
                action: null
            });
            
            displaySteps(steps, large, small, { type: 'sum_diff', diff: diff });
        }
        
        // å’Œå€é—®é¢˜
        function calculateSumMul() {
            const sum = parseFloat(document.getElementById('sumValue2').value);
            const mul = parseFloat(document.getElementById('mulValue').value);
            
            if (isNaN(sum) || isNaN(mul)) {
                alert('è¯·è¾“å…¥æ­£ç¡®çš„æ•°å€¼');
                return;
            }
            
            if (mul < 1) {
                alert('å€æ•°å¿…é¡»å¤§äºç­‰äº1');
                return;
            }
            
            const small = sum / (mul + 1);
            const large = small * mul;
            
            if (!Number.isInteger(small)) {
                // å…è®¸å°æ•°ç»“æœ
            }
            
            updateBarDiagram(large, small, false);
            
            const steps = [];
            
            steps.push({
                text: `å’Œå€é—®é¢˜ï¼šå·²çŸ¥ä¸¤æ•°çš„å’Œä¸å€æ•°å…³ç³»ï¼Œæ±‚è¿™ä¸¤ä¸ªæ•°`,
                action: null
            });
            
            steps.push({
                text: `å·²çŸ¥ï¼šå’Œ = <span class="highlight">${sum}</span>ï¼Œå¤§æ•°æ˜¯å°æ•°çš„ <span class="highlight">${mul}</span> å€`,
                action: 'init_bars'
            });
            
            steps.push({
                text: `ç”»çº¿æ®µå›¾ç†è§£ï¼šæŠŠå°æ•°çœ‹ä½œ 1 ä»½ï¼Œå¤§æ•°å°±æ˜¯ <span class="highlight">${mul}</span> ä»½`,
                action: 'show_mul'
            });
            
            steps.push({
                text: `å…³é”®æ€è·¯ï¼šå’Œ = å°æ•° + å¤§æ•° = 1ä»½ + ${mul}ä»½ = <span class="highlight">${mul + 1}ä»½</span>`,
                action: null
            });
            
            steps.push({
                text: `æ±‚å°æ•°ï¼ˆ1ä»½ï¼‰ï¼š${sum} Ã· ${mul + 1} = <span class="highlight">${fmt(small)}</span>`,
                action: null
            });
            
            steps.push({
                text: `æ±‚å¤§æ•°ï¼ˆ${mul}ä»½ï¼‰ï¼š${fmt(small)} Ã— ${mul} = <span class="highlight">${fmt(large)}</span>`,
                action: null
            });
            
            steps.push({
                text: `âœ“ ç­”æ¡ˆï¼šå¤§æ•°æ˜¯ <span class="highlight">${fmt(large)}</span>ï¼Œå°æ•°æ˜¯ <span class="highlight">${fmt(small)}</span>`,
                action: 'show_result'
            });
            
            steps.push({
                text: `éªŒè¯ï¼š${fmt(small)} + ${fmt(large)} = ${fmt(small + large)}ï¼ˆå’Œï¼‰âœ“<br>${fmt(large)} Ã· ${fmt(small)} = ${mul}ï¼ˆå€æ•°ï¼‰âœ“`,
                action: null
            });
            
            displaySteps(steps, large, small, { type: 'sum_mul', mul: mul });
        }
        
        // å·®å€é—®é¢˜
        function calculateDiffMul() {
            const diff = parseFloat(document.getElementById('diffValue2').value);
            const mul = parseFloat(document.getElementById('mulValue2').value);
            
            if (isNaN(diff) || isNaN(mul)) {
                alert('è¯·è¾“å…¥æ­£ç¡®çš„æ•°å€¼');
                return;
            }
            
            if (mul <= 1) {
                alert('å€æ•°å¿…é¡»å¤§äº1');
                return;
            }
            
            const small = diff / (mul - 1);
            const large = small * mul;
            
            updateBarDiagram(large, small, false);
            
            const steps = [];
            
            steps.push({
                text: `å·®å€é—®é¢˜ï¼šå·²çŸ¥ä¸¤æ•°çš„å·®ä¸å€æ•°å…³ç³»ï¼Œæ±‚è¿™ä¸¤ä¸ªæ•°`,
                action: null
            });
            
            steps.push({
                text: `å·²çŸ¥ï¼šå·® = <span class="highlight">${diff}</span>ï¼Œå¤§æ•°æ˜¯å°æ•°çš„ <span class="highlight">${mul}</span> å€`,
                action: 'init_bars'
            });
            
            steps.push({
                text: `ç”»çº¿æ®µå›¾ç†è§£ï¼šæŠŠå°æ•°çœ‹ä½œ 1 ä»½ï¼Œå¤§æ•°å°±æ˜¯ <span class="highlight">${mul}</span> ä»½`,
                action: 'show_mul'
            });
            
            steps.push({
                text: `å…³é”®æ€è·¯ï¼šå·® = å¤§æ•° - å°æ•° = ${mul}ä»½ - 1ä»½ = <span class="highlight">${mul - 1}ä»½</span>`,
                action: null
            });
            
            steps.push({
                text: `æ±‚å°æ•°ï¼ˆ1ä»½ï¼‰ï¼š${diff} Ã· ${mul - 1} = <span class="highlight">${fmt(small)}</span>`,
                action: null
            });
            
            steps.push({
                text: `æ±‚å¤§æ•°ï¼ˆ${mul}ä»½ï¼‰ï¼š${fmt(small)} Ã— ${mul} = <span class="highlight">${fmt(large)}</span>`,
                action: null
            });
            
            steps.push({
                text: `âœ“ ç­”æ¡ˆï¼šå¤§æ•°æ˜¯ <span class="highlight">${fmt(large)}</span>ï¼Œå°æ•°æ˜¯ <span class="highlight">${fmt(small)}</span>`,
                action: null
            });
            
            steps.push({
                text: `éªŒè¯ï¼š${fmt(large)} - ${fmt(small)} = ${fmt(large - small)}ï¼ˆå·®ï¼‰âœ“<br>${fmt(large)} Ã· ${fmt(small)} = ${mul}ï¼ˆå€æ•°ï¼‰âœ“`,
                action: 'show_result'
            });
            
            displaySteps(steps, large, small, { type: 'diff_mul', mul: mul, diff: diff });
        }
        
        // æ ¼å¼åŒ–æ•°å­—
        function fmt(num) {
            if (Number.isInteger(num)) return num;
            return parseFloat(num.toFixed(2));
        }
        
        // å½“å‰é—®é¢˜çš„é¢å¤–å‚æ•°
        let currentExtra = {};
        
        // æ˜¾ç¤ºæ­¥éª¤
        function displaySteps(steps, large, small, extra = {}) {
            currentExtra = extra;
            const container = document.getElementById('stepsContainer');
            container.innerHTML = '';
            stepsData = [];
            
            steps.forEach((step, index) => {
                const stepEl = document.createElement('div');
                stepEl.className = 'step-item';
                stepEl.innerHTML = `
                    <div class="step-header">
                        <span class="step-number">${index + 1}</span>
                        <span class="step-title">${step.text}</span>
                    </div>
                `;
                stepEl.dataset.action = step.action || '';
                stepEl.dataset.large = large;
                stepEl.dataset.small = small;
                container.appendChild(stepEl);
                stepsData.push(stepEl);
            });
            
            currentStep = 0;
            maxReachedStep = 0;
            document.getElementById('answerLarge').textContent = '?';
            document.getElementById('answerSmall').textContent = '?';
            updateStepVisibility();
            updateButtons();
        }
        
        // æ‰§è¡ŒåŠ¨ç”»
        function executeAction(action, large, small) {
            const extra = currentExtra;
            
            if (action === 'init_bars') {
                updateBarDiagram(large, small, false);
            }
            
            if (action === 'show_diff' && extra.type === 'sum_diff') {
                // å’Œå·®é—®é¢˜ï¼šæ˜¾ç¤ºå·®çš„éƒ¨åˆ†
                updateBarDiagramSumDiff(large, small, extra.diff, true, false);
            }
            
            if (action === 'show_mul' && (extra.type === 'sum_mul' || extra.type === 'diff_mul')) {
                // å’Œå€/å·®å€é—®é¢˜ï¼šæ˜¾ç¤ºä»½æ•°
                updateBarDiagramMul(large, small, extra.mul, true, false);
            }
            
            if (action === 'show_result') {
                updateBarDiagram(large, small, true);
                document.getElementById('answerLarge').textContent = fmt(large);
                document.getElementById('answerSmall').textContent = fmt(small);
            }
        }
        
        // æ›´æ–°æ­¥éª¤å¯è§æ€§
        function updateStepVisibility() {
            stepsData.forEach((step, index) => {
                step.classList.toggle('visible', index <= maxReachedStep);
                step.classList.toggle('active', index === currentStep);
            });
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°å½“å‰æ­¥éª¤
            if (stepsData[currentStep]) {
                stepsData[currentStep].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            const currentStepEl = stepsData[currentStep];
            if (currentStepEl) {
                const action = currentStepEl.dataset.action;
                const large = parseFloat(currentStepEl.dataset.large);
                const small = parseFloat(currentStepEl.dataset.small);
                if (action) {
                    executeAction(action, large, small);
                }
            }
        }
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtons() {
            document.getElementById('prevBtn').disabled = currentStep === 0;
            document.getElementById('nextBtn').disabled = currentStep >= stepsData.length - 1;
        }
        
        // ä¸Šä¸€æ­¥
        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateStepVisibility();
                updateButtons();
            }
        }
        
        // ä¸‹ä¸€æ­¥
        function nextStep() {
            // å¦‚æœè¿˜æ²¡æœ‰ç”Ÿæˆæ­¥éª¤ï¼Œå…ˆç”Ÿæˆ
            if (stepsData.length === 0) {
                startCalculation();
                return;
            }
            if (currentStep < stepsData.length - 1) {
                currentStep++;
                if (currentStep > maxReachedStep) {
                    maxReachedStep = currentStep;
                }
                updateStepVisibility();
                updateButtons();
            }
        }
        
        // ä¸€é”®æŸ¥çœ‹æ‰€æœ‰æ­¥éª¤
        function showAllSteps() {
            if (stepsData.length === 0) {
                startCalculation();
            }
            if (stepsData.length > 0) {
                maxReachedStep = stepsData.length - 1;
                currentStep = stepsData.length - 1;
                updateStepVisibility();
                updateButtons();
            }
        }
        
        // é‡ç½®æ¼”ç¤ºçŠ¶æ€
        function resetDemo() {
            // æ¸…é™¤æ‰€æœ‰æ­¥éª¤å…ƒç´ çš„åŠ¨ç”»çŠ¶æ€
            stepsData.forEach(step => {
                step.classList.remove('visible', 'active');
            });
            
            // é‡ç½®æ­¥éª¤
            stepsData = [];
            currentStep = 0;
            maxReachedStep = 0;
            currentExtra = {};
            
            // é‡ç½®æ­¥éª¤å®¹å™¨
            const container = document.getElementById('stepsContainer');
            container.innerHTML = `
                <div class="step-item">
                    <span class="step-number">1</span>
                    <span class="step-content">ğŸ‘† ç‚¹å‡»"ä¸‹ä¸€æ­¥"å¼€å§‹è§£ç­”</span>
                </div>
            `;
            
            // é‡ç½®ç­”æ¡ˆ
            document.getElementById('answerLarge').textContent = '?';
            document.getElementById('answerSmall').textContent = '?';
            
            // é‡ç½®æŒ‰é’®
            document.getElementById('prevBtn').disabled = true;
            document.getElementById('nextBtn').disabled = false;
            
            // é‡ç½®çº¿æ®µå›¾ä¸ºåˆå§‹çŠ¶æ€
            const diagram = document.getElementById('barDiagram');
            diagram.innerHTML = `
                <div class="bar-row">
                    <span class="bar-label">å¤§æ•°ï¼š</span>
                    <div class="bar-container">
                        <div class="bar-segment large" style="width: 250px;">?</div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-label">å°æ•°ï¼š</span>
                    <div class="bar-container">
                        <div class="bar-segment small-red" style="width: 150px;">?</div>
                    </div>
                </div>
            `;
            
            // æ»šåŠ¨æ­¥éª¤å®¹å™¨åˆ°é¡¶éƒ¨
            container.scrollTop = 0;
        }
        
        // ç›‘å¬è¾“å…¥å˜åŒ–
        document.getElementById('sumValue').addEventListener('input', function() {
            updateProblemText();
            resetDemo();
        });
        document.getElementById('diffValue').addEventListener('input', function() {
            updateProblemText();
            resetDemo();
        });
        document.getElementById('sumValue2').addEventListener('input', function() {
            updateProblemText();
            resetDemo();
        });
        document.getElementById('mulValue').addEventListener('input', function() {
            updateProblemText();
            resetDemo();
        });
        document.getElementById('diffValue2').addEventListener('input', function() {
            updateProblemText();
            resetDemo();
        });
        document.getElementById('mulValue2').addEventListener('input', function() {
            updateProblemText();
            resetDemo();
        });
        
        // åˆå§‹åŒ–
        updateProblemText();
    </script>
    <a href="../../index.html" style="display:block;text-align:center;margin:30px auto;color:#fff;text-decoration:none;font-size:14px;">â† è¿”å›çš®å¡ä¸˜å­¦ä¹ èµ„æº</a>
</body>
</html>

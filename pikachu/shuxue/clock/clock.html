<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />    
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="Expires" content="0">
    <link rel="Shortcut Icon" href="https://cdn.bihe0832.com/images/zixie_32.ico" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="author" CONTENT="å­å‹°(bihe0832), code@bihe0832.com" />
    <meta name="keywords" content="å­å‹°,bihe0832,æ—¶é’Ÿé—®é¢˜" />
    <meta name="description" content="çš®å¡ä¸˜å­¦æ•°å­¦ä¹‹æ—¶é’Ÿé—®é¢˜åˆ†æ­¥è§£ç­”" />
    <meta property="og:title" content="çš®å¡ä¸˜å­¦æ•°å­¦ä¹‹æ—¶é’Ÿé—®é¢˜åˆ†æ­¥è§£ç­”" />
    <meta property="og:locale" content="en_US" />
    <title>çš®å¡ä¸˜å­¦æ•°å­¦ - æ—¶é’Ÿé—®é¢˜</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 1400px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            margin: 20px 0;
            padding: 20px;
        }
        header {
            background: linear-gradient(90deg, #2c3e50, #34495e);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        header h2 {
            font-size: 2rem;
            margin: 10px 0;
            text-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }
        header p {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.6;
        }
        
        .main-content {
            display: flex;
            gap: 20px;
            min-height: 500px;
        }
        
        .left-panel {
            width: 320px;
            flex-shrink: 0;
            background: #f0f4f8;
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .panel-title {
            font-size: 1.1rem;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 3px solid #3498db;
            display: flex;
            align-items: center;
        }
        .panel-title i {
            margin-right: 10px;
            font-size: 1.2rem;
            color: #3498db;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
            font-size: 0.9rem;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.3);
        }
        
        .time-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .time-inputs input {
            width: 70px;
            text-align: center;
        }
        .time-inputs span {
            font-weight: bold;
            color: #666;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        .btn:disabled {
            background: linear-gradient(135deg, #bdc3c7, #95a5a6);
            cursor: not-allowed;
            opacity: 0.6;
        }
        .btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        .problem-types {
            margin-bottom: 15px;
        }
        .problem-type-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        .problem-type-btn:hover {
            border-color: #3498db;
            background: #f0f8ff;
        }
        .problem-type-btn.active {
            border-color: #3498db;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        .problem-type-btn .type-title {
            font-weight: bold;
            font-size: 0.95rem;
        }
        .problem-type-btn .type-desc {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-top: 3px;
        }
        
        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .clock-area {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .clock-container {
            position: relative;
            width: 300px;
            height: 300px;
        }
        
        .clock-face {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(145deg, #ffffff, #e6e6e6);
            box-shadow: 
                0 0 0 8px #2c3e50,
                0 0 0 12px #34495e,
                inset 0 5px 15px rgba(0,0,0,0.1),
                0 10px 30px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .clock-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 16px;
            height: 16px;
            background: linear-gradient(145deg, #2c3e50, #1a252f);
            border-radius: 50%;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .clock-number {
            position: absolute;
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            width: 30px;
            height: 30px;
            line-height: 30px;
        }
        
        .clock-tick {
            position: absolute;
            background: #666;
            transform-origin: center bottom;
        }
        .clock-tick.major {
            width: 3px;
            height: 12px;
            background: #2c3e50;
        }
        .clock-tick.minor {
            width: 1px;
            height: 8px;
            background: #999;
        }
        
        .clock-hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            border-radius: 4px;
            cursor: grab;
        }
        .clock-hand:active {
            cursor: grabbing;
        }
        .clock-hand.dragging {
            cursor: grabbing;
            filter: brightness(1.2);
        }
        .hour-hand {
            width: 6px;
            height: 70px;
            background: linear-gradient(to top, #2c3e50, #34495e);
            margin-left: -3px;
            z-index: 3;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }
        .minute-hand {
            width: 4px;
            height: 100px;
            background: linear-gradient(to top, #3498db, #2980b9);
            margin-left: -2px;
            z-index: 4;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }
        
        .angle-arc {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
        
        .angle-display {
            margin-top: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .angle-value {
            color: #e74c3c;
            font-size: 2rem;
        }
        
        .solution-area {
            background: #f0f4f8;
            border-radius: 15px;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }
        
        .solution-title {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
            display: flex;
            align-items: center;
        }
        .solution-title i {
            margin-right: 10px;
            color: #3498db;
        }
        
        .steps-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .solution-step {
            background: white;
            border-radius: 10px;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: none;
            transition: all 0.3s;
        }
        .solution-step.visible {
            display: flex;
            align-items: center;
            animation: fadeInStep 0.4s ease;
        }
        .solution-step.active {
            animation: breatheBlue 1.5s ease-in-out infinite;
        }
        @keyframes fadeInStep {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes breatheBlue {
            0%, 100% { background-color: rgba(52, 152, 219, 0.1); }
            50% { background-color: rgba(52, 152, 219, 0.25); }
        }
        .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 12px;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        .step-title {
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        .step-content {
            margin-top: 10px;
            padding-left: 38px;
            color: #555;
            line-height: 1.8;
        }
        .formula {
            background: #fff3cd;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin: 8px 0;
            display: inline-block;
            border: 1px solid #ffc107;
        }
        .highlight {
            color: #e74c3c;
            font-weight: bold;
        }
        .result-box {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 15px 20px;
            display: none;
        }
        .result-box.visible {
            display: block;
            animation: fadeInStep 0.4s ease;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 1.1rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }
        
        .knowledge-card {
            background: linear-gradient(135deg, #fff9e6, #fff3cd);
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }
        .knowledge-card h4 {
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .knowledge-card h4 i {
            margin-right: 8px;
        }
        .knowledge-card ul {
            margin-left: 20px;
            color: #856404;
        }
        .knowledge-card li {
            margin: 5px 0;
            line-height: 1.6;
        }
        
        .animation-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        .anim-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .anim-btn.play {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }
        .anim-btn.pause {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        .anim-btn.reset {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }
        .anim-btn:hover {
            transform: scale(1.05);
        }
        
        .problem-display {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        .problem-text {
            color: white;
            font-size: 1.2rem;
            line-height: 1.8;
            text-align: center;
        }
        .problem-text .highlight {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        @media (max-width: 900px) {
            .main-content {
                flex-direction: column;
            }
            .left-panel {
                width: 100%;
            }
            .clock-container {
                width: 250px;
                height: 250px;
            }
            .hour-hand { height: 55px; }
            .minute-hand { height: 80px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h2>ğŸ• çš®å¡ä¸˜å­¦æ•°å­¦ - æ—¶é’Ÿé—®é¢˜</h2>
            <p>æ—¶é’ˆæ¯å°æ—¶èµ° 30Â°ï¼ˆæ¯åˆ†é’Ÿ 0.5Â°ï¼‰ï¼Œåˆ†é’ˆæ¯åˆ†é’Ÿèµ° 6Â°<br>æŒæ¡æ—¶é’ˆåˆ†é’ˆçš„è¿åŠ¨è§„å¾‹ï¼Œè½»æ¾è§£å†³å„ç±»æ—¶é’Ÿé—®é¢˜ï¼</p>
        </header>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="panel-title">
                    <i class="fas fa-cog"></i>
                    <span>é¢˜ç›®è®¾ç½®</span>
                </div>
                
                <div class="problem-types">
                    <button class="problem-type-btn active" data-type="overlap" onclick="selectProblemType('overlap')">
                        <div class="type-title">ğŸ”„ é‡åˆé—®é¢˜</div>
                        <div class="type-desc">æ±‚æ—¶é’ˆåˆ†é’ˆé‡åˆçš„æ—¶é—´</div>
                    </button>
                    <button class="problem-type-btn" data-type="right_angle" onclick="selectProblemType('right_angle')">
                        <div class="type-title">ğŸ“ ç›´è§’é—®é¢˜</div>
                        <div class="type-desc">æ±‚æ—¶é’ˆåˆ†é’ˆæˆç›´è§’çš„æ—¶é—´</div>
                    </button>
                    <button class="problem-type-btn" data-type="opposite" onclick="selectProblemType('opposite')">
                        <div class="type-title">â†”ï¸ æˆä¸€ç›´çº¿</div>
                        <div class="type-desc">æ±‚æ—¶é’ˆåˆ†é’ˆåœ¨ä¸€æ¡ç›´çº¿ä¸Šçš„æ—¶é—´</div>
                    </button>
                    <button class="problem-type-btn" data-type="angle" onclick="selectProblemType('angle')">
                        <div class="type-title">ğŸ“ æ±‚è§’åº¦</div>
                        <div class="type-desc">ç»™å®šæ—¶é—´ï¼Œæ±‚æ—¶é’ˆåˆ†é’ˆå¤¹è§’</div>
                    </button>
                </div>
                
                <div id="chase-inputs">
                    <div class="input-group">
                        <label>â° èµ·å§‹æ—¶é—´</label>
                        <div class="time-inputs">
                            <input type="number" id="start-hour" min="0" max="23" value="12" placeholder="æ—¶">
                            <span>:</span>
                            <input type="number" id="start-minute" min="0" max="59" value="0" placeholder="åˆ†">
                        </div>
                    </div>
                    <div class="input-group" id="which-time-group" style="display: none;">
                        <label>ğŸ”¢ ç¬¬å‡ æ¬¡</label>
                        <select id="which-time">
                            <option value="1" selected>ç¬¬1æ¬¡</option>
                            <option value="2">ç¬¬2æ¬¡</option>
                        </select>
                    </div>
                </div>
                
                <div id="angle-inputs" style="display: none;">
                    <div class="input-group">
                        <label>â° è¾“å…¥æ—¶é—´</label>
                        <div class="time-inputs">
                            <input type="number" id="hour" min="0" max="23" value="12" placeholder="æ—¶">
                            <span>:</span>
                            <input type="number" id="minute" min="0" max="59" value="0" placeholder="åˆ†">
                        </div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="startCalculation()">
                        <i class="fas fa-calculator"></i> å¼€å§‹è®¡ç®—
                    </button>
                    <button class="btn btn-secondary" onclick="showAllSteps()">
                        <i class="fas fa-eye"></i> ä¸€é”®æŸ¥çœ‹
                    </button>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" id="prevBtn" onclick="prevStep()" disabled>
                        <i class="fas fa-arrow-left"></i> ä¸Šä¸€æ­¥
                    </button>
                    <button class="btn btn-secondary" id="nextBtn" onclick="nextStep()" disabled>
                        ä¸‹ä¸€æ­¥ <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                
                <div class="knowledge-card">
                    <h4><i class="fas fa-lightbulb"></i> æ ¸å¿ƒå…¬å¼</h4>
                    <ul>
                        <li><b>æ—¶é’ˆé€Ÿåº¦</b>ï¼š0.5Â°/åˆ†é’Ÿ</li>
                        <li><b>åˆ†é’ˆé€Ÿåº¦</b>ï¼š6Â°/åˆ†é’Ÿ</li>
                        <li><b>é€Ÿåº¦å·®</b>ï¼š5.5Â°/åˆ†é’Ÿ</li>
                        <li><b>è¿½åŠæ—¶é—´</b>ï¼šè§’åº¦å·® Ã· 5.5</li>
                    </ul>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="problem-display" id="problem-display">
                    <div class="problem-text" id="problem-text">
                        ğŸ“ è¯·åœ¨å·¦ä¾§è®¾ç½®é¢˜ç›®å‚æ•°ï¼Œç‚¹å‡»"å¼€å§‹è®¡ç®—"ç”Ÿæˆé¢˜ç›®
                    </div>
                </div>
                
                <div class="clock-area">
                    <div class="clock-container">
                        <div class="clock-face" id="clock-face">
                            <div class="clock-center"></div>
                            <div class="hour-hand clock-hand" id="hour-hand"></div>
                            <div class="minute-hand clock-hand" id="minute-hand"></div>
                            <svg class="angle-arc" id="angle-arc" width="300" height="300"></svg>
                        </div>
                    </div>
                    <div class="angle-display">
                        <span>å¤¹è§’ï¼š</span>
                        <span class="angle-value" id="angle-value">0Â°</span>
                    </div>
                    <div class="animation-controls">
                        <button class="anim-btn play" id="play-btn" onclick="toggleAnimation()">
                            <i class="fas fa-play"></i> è‡ªåŠ¨è¿è¡Œ
                        </button>
                        <button class="anim-btn reset" onclick="resetClock()">
                            <i class="fas fa-undo"></i> å¤ä½
                        </button>
                    </div>
                </div>
                
                <div class="solution-area" id="solution-area">
                    <div class="solution-title">
                        <i class="fas fa-list-ol"></i>
                        <span>è§£é¢˜æ­¥éª¤</span>
                        <span style="margin-left: auto; font-size: 0.9rem; color: #7f8c8d;">
                            æ­¥éª¤: <span id="step-counter">0</span>/<span id="step-total">0</span>
                        </span>
                    </div>
                    <div id="solution-steps" class="steps-container">
                        <p style="color: #999; text-align: center; padding: 30px;">
                            ğŸ‘† è®¾ç½®é¢˜ç›®å‚æ•°åç‚¹å‡»"å¼€å§‹è®¡ç®—"æŒ‰é’®æŸ¥çœ‹è¯¦ç»†è§£ç­”
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentType = 'overlap';
        let isAnimating = false;
        let animationId = null;
        let isDragging = false;
        let draggingHand = null;
        let stepsData = [];
        let currentStep = 0;
        let maxReachedStep = 0;
        
        // ä¿å­˜èµ·å§‹å’Œç»“æœæ—¶é—´ï¼Œç”¨äºæ­¥éª¤åŠ¨ç”»
        let startTime = { hour: 12, minute: 0 };
        let resultTime = { hour: 12, minute: 0 };
        
        // åˆå§‹åŒ–æ—¶é’Ÿ
        function initClock() {
            const clockFace = document.getElementById('clock-face');
            
            // æ·»åŠ åˆ»åº¦
            for (let i = 0; i < 60; i++) {
                const tick = document.createElement('div');
                tick.className = 'clock-tick ' + (i % 5 === 0 ? 'major' : 'minor');
                const angle = i * 6;
                const radius = 140;
                const tickHeight = i % 5 === 0 ? 12 : 8;
                tick.style.left = `calc(50% - ${i % 5 === 0 ? 1.5 : 0.5}px)`;
                tick.style.top = `${10}px`;
                tick.style.transform = `rotate(${angle}deg) translateY(0)`;
                tick.style.transformOrigin = `center ${radius}px`;
                clockFace.appendChild(tick);
            }
            
            // æ·»åŠ æ•°å­—
            const numbers = [12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];
            numbers.forEach((num, index) => {
                const numEl = document.createElement('div');
                numEl.className = 'clock-number';
                numEl.textContent = num;
                const angle = (index * 30 - 90) * Math.PI / 180;
                const radius = 115;
                const x = 150 + radius * Math.cos(angle) - 15;
                const y = 150 + radius * Math.sin(angle) - 15;
                numEl.style.left = x + 'px';
                numEl.style.top = y + 'px';
                clockFace.appendChild(numEl);
            });
            
            updateClock(12, 0);
            
            // åˆå§‹åŒ–æ‹–åŠ¨åŠŸèƒ½
            initDragHandlers();
        }
        
        // åˆå§‹åŒ–æ‹–åŠ¨å¤„ç†
        function initDragHandlers() {
            const hourHand = document.getElementById('hour-hand');
            const minuteHand = document.getElementById('minute-hand');
            const clockFace = document.getElementById('clock-face');
            
            // è·å–æ—¶é’Ÿä¸­å¿ƒåæ ‡
            function getClockCenter() {
                const rect = clockFace.getBoundingClientRect();
                return {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };
            }
            
            // è®¡ç®—è§’åº¦ï¼ˆä»12ç‚¹æ–¹å‘é¡ºæ—¶é’ˆï¼‰
            function calculateAngle(clientX, clientY) {
                const center = getClockCenter();
                const dx = clientX - center.x;
                const dy = clientY - center.y;
                let angle = Math.atan2(dx, -dy) * 180 / Math.PI;
                if (angle < 0) angle += 360;
                return angle;
            }
            
            // ä»è§’åº¦è®¡ç®—æ—¶é—´
            function angleToTime(hourAngle, minuteAngle) {
                // åˆ†é’ˆè§’åº¦è½¬åˆ†é’Ÿï¼šæ¯6åº¦1åˆ†é’Ÿ
                let minute = Math.round(minuteAngle / 6) % 60;
                if (minute < 0) minute += 60;
                
                // æ—¶é’ˆè§’åº¦è½¬å°æ—¶ï¼šæ¯30åº¦1å°æ—¶
                let hour = Math.floor(hourAngle / 30) % 12;
                if (hour === 0) hour = 12;
                
                return { hour, minute };
            }
            
            // é¼ æ ‡/è§¦æ‘¸æŒ‰ä¸‹
            function startDrag(e, hand) {
                if (isAnimating) return;
                e.preventDefault();
                isDragging = true;
                draggingHand = hand;
                hand.classList.add('dragging');
            }
            
            // é¼ æ ‡/è§¦æ‘¸ç§»åŠ¨
            function onDrag(e) {
                if (!isDragging || !draggingHand) return;
                
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                const angle = calculateAngle(clientX, clientY);
                
                // è·å–å½“å‰æ—¶é’ˆå’Œåˆ†é’ˆè§’åº¦
                const hourHand = document.getElementById('hour-hand');
                const minuteHand = document.getElementById('minute-hand');
                
                let currentHourAngle = parseFloat(hourHand.style.transform.replace('rotate(', '').replace('deg)', '')) || 0;
                let currentMinuteAngle = parseFloat(minuteHand.style.transform.replace('rotate(', '').replace('deg)', '')) || 0;
                
                if (draggingHand === minuteHand) {
                    // æ‹–åŠ¨åˆ†é’ˆï¼šåˆ†é’ˆè§’åº¦ç›´æ¥è®¾ç½®
                    const newMinute = Math.round((angle / 6) % 60);
                    const oldMinute = parseInt(document.getElementById('minute').value) || 0;
                    let hour = parseInt(document.getElementById('hour').value) || 0;
                    
                    // æ£€æµ‹æ˜¯å¦è·¨è¶Šäº†0åˆ†ï¼ˆå³ä»59åˆ†åˆ°0åˆ†ï¼Œæˆ–ä»0åˆ†åˆ°59åˆ†ï¼‰
                    if (oldMinute > 45 && newMinute < 15) {
                        // ä»59åˆ†è½¬åˆ°0åˆ†ï¼Œå°æ—¶+1
                        hour = (hour + 1) % 24;
                    } else if (oldMinute < 15 && newMinute > 45) {
                        // ä»0åˆ†è½¬åˆ°59åˆ†ï¼Œå°æ—¶-1
                        hour = (hour - 1 + 24) % 24;
                    }
                    
                    document.getElementById('hour').value = hour;
                    document.getElementById('minute').value = newMinute;
                    // åŒæ­¥æ›´æ–°è¿½åŠé—®é¢˜çš„èµ·å§‹æ—¶é—´
                    document.getElementById('start-hour').value = hour;
                    document.getElementById('start-minute').value = newMinute;
                    updateClock(hour, newMinute);
                } else if (draggingHand === hourHand) {
                    // æ‹–åŠ¨æ—¶é’ˆï¼šæ ¹æ®è§’åº¦å˜åŒ–è®¡ç®—æ—¶é—´
                    const totalMinutes = (angle / 0.5);
                    const newHourIn12 = Math.floor(totalMinutes / 60) % 12;
                    const newMinute = Math.round(totalMinutes % 60);
                    
                    // è·å–å½“å‰å°æ—¶ï¼Œåˆ¤æ–­æ˜¯ä¸Šåˆè¿˜æ˜¯ä¸‹åˆ
                    let currentHour = parseInt(document.getElementById('hour').value) || 0;
                    const isPM = currentHour >= 12;
                    
                    // æ£€æµ‹æ˜¯å¦è·¨è¶Šäº†12ç‚¹
                    const oldHourIn12 = currentHour % 12;
                    if (oldHourIn12 > 9 && newHourIn12 < 3) {
                        // ä»11ç‚¹è½¬åˆ°0ç‚¹ï¼Œåˆ‡æ¢ä¸Šåˆ/ä¸‹åˆ
                        currentHour = isPM ? newHourIn12 : newHourIn12 + 12;
                    } else if (oldHourIn12 < 3 && newHourIn12 > 9) {
                        // ä»0ç‚¹è½¬åˆ°11ç‚¹ï¼Œåˆ‡æ¢ä¸Šåˆ/ä¸‹åˆ
                        currentHour = isPM ? newHourIn12 + 12 : newHourIn12;
                    } else {
                        // æ­£å¸¸æƒ…å†µï¼Œä¿æŒä¸Šåˆ/ä¸‹åˆä¸å˜
                        currentHour = isPM ? newHourIn12 + 12 : newHourIn12;
                    }
                    
                    // å¤„ç†24ç‚¹å˜ä¸º0ç‚¹
                    currentHour = currentHour % 24;
                    
                    document.getElementById('hour').value = currentHour;
                    document.getElementById('minute').value = newMinute;
                    // åŒæ­¥æ›´æ–°è¿½åŠé—®é¢˜çš„èµ·å§‹æ—¶é—´
                    document.getElementById('start-hour').value = currentHour;
                    document.getElementById('start-minute').value = newMinute;
                    updateClock(currentHour, newMinute);
                }
                
                // æ‹–åŠ¨æ—¶æ›´æ–°é¢˜ç›®æ˜¾ç¤º
                updateProblemDisplay();
            }
            
            // é¼ æ ‡/è§¦æ‘¸é‡Šæ”¾
            function endDrag() {
                if (draggingHand) {
                    draggingHand.classList.remove('dragging');
                }
                isDragging = false;
                draggingHand = null;
            }
            
            // ç»‘å®šæ—¶é’ˆäº‹ä»¶
            hourHand.addEventListener('mousedown', (e) => startDrag(e, hourHand));
            hourHand.addEventListener('touchstart', (e) => startDrag(e, hourHand), { passive: false });
            
            // ç»‘å®šåˆ†é’ˆäº‹ä»¶
            minuteHand.addEventListener('mousedown', (e) => startDrag(e, minuteHand));
            minuteHand.addEventListener('touchstart', (e) => startDrag(e, minuteHand), { passive: false });
            
            // å…¨å±€ç§»åŠ¨å’Œé‡Šæ”¾äº‹ä»¶
            document.addEventListener('mousemove', onDrag);
            document.addEventListener('touchmove', onDrag, { passive: false });
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
        }
        
        // æ›´æ–°æ—¶é’ŸæŒ‡é’ˆ
        function updateClock(hour, minute) {
            const hourHand = document.getElementById('hour-hand');
            const minuteHand = document.getElementById('minute-hand');
            
            // æ—¶é’ˆè§’åº¦ï¼šæ¯å°æ—¶30åº¦ï¼Œæ¯åˆ†é’Ÿ0.5åº¦
            const hourAngle = (hour % 12) * 30 + minute * 0.5;
            // åˆ†é’ˆè§’åº¦ï¼šæ¯åˆ†é’Ÿ6åº¦
            const minuteAngle = minute * 6;
            
            hourHand.style.transform = `rotate(${hourAngle}deg)`;
            minuteHand.style.transform = `rotate(${minuteAngle}deg)`;
            
            // è®¡ç®—å¤¹è§’
            let angle = Math.abs(hourAngle - minuteAngle);
            if (angle > 180) angle = 360 - angle;
            
            document.getElementById('angle-value').textContent = angle.toFixed(1) + 'Â°';
            
            // ç»˜åˆ¶è§’åº¦å¼§çº¿
            drawAngleArc(hourAngle, minuteAngle);
            
            return angle;
        }
        
        // ç»˜åˆ¶è§’åº¦å¼§çº¿
        function drawAngleArc(hourAngle, minuteAngle) {
            const svg = document.getElementById('angle-arc');
            svg.innerHTML = '';
            
            let startAngle = Math.min(hourAngle, minuteAngle);
            let endAngle = Math.max(hourAngle, minuteAngle);
            let diff = endAngle - startAngle;
            
            if (diff > 180) {
                [startAngle, endAngle] = [endAngle, startAngle + 360];
                diff = 360 - diff;
            }
            
            if (diff < 1) return;
            
            const cx = 150, cy = 150, r = 50;
            const startRad = (startAngle - 90) * Math.PI / 180;
            const endRad = (endAngle - 90) * Math.PI / 180;
            
            const x1 = cx + r * Math.cos(startRad);
            const y1 = cy + r * Math.sin(startRad);
            const x2 = cx + r * Math.cos(endRad);
            const y2 = cy + r * Math.sin(endRad);
            
            const largeArc = diff > 180 ? 1 : 0;
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${largeArc} 1 ${x2} ${y2} Z`);
            path.setAttribute('fill', 'rgba(231, 76, 60, 0.3)');
            path.setAttribute('stroke', '#e74c3c');
            path.setAttribute('stroke-width', '2');
            svg.appendChild(path);
        }
        
        // é€‰æ‹©é¢˜ç›®ç±»å‹
        function selectProblemType(type) {
            currentType = type;
            document.querySelectorAll('.problem-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('active');
            
            const angleInputs = document.getElementById('angle-inputs');
            const chaseInputs = document.getElementById('chase-inputs');
            const whichTimeGroup = document.getElementById('which-time-group');
            
            if (type === 'angle') {
                angleInputs.style.display = 'block';
                chaseInputs.style.display = 'none';
            } else {
                angleInputs.style.display = 'none';
                chaseInputs.style.display = 'block';
                whichTimeGroup.style.display = (type === 'right_angle' || type === 'opposite') ? 'block' : 'none';
            }
            
            // é€‰æ‹©é¢˜å‹ååªæ›´æ–°é¢˜ç›®ï¼Œä¸æ˜¾ç¤ºç­”æ¡ˆ
            updateProblemDisplay();
        }
        
        // åªæ›´æ–°é¢˜ç›®æ˜¾ç¤ºï¼ˆä¸æ˜¾ç¤ºè§£ç­”ï¼‰
        function updateProblemDisplay() {
            let problemText = '';
            
            if (currentType === 'angle') {
                const hour = parseInt(document.getElementById('hour').value) || 0;
                const minute = parseInt(document.getElementById('minute').value) || 0;
                updateClock(hour, minute);
                problemText = `ğŸ“ <b>é¢˜ç›®ï¼š</b>${hour}:${minute.toString().padStart(2, '0')} æ—¶ï¼Œæ—¶é’ˆå’Œåˆ†é’ˆçš„å¤¹è§’æ˜¯å¤šå°‘åº¦ï¼Ÿ`;
            } else if (currentType === 'overlap') {
                const startHour = parseInt(document.getElementById('start-hour').value) || 0;
                const startMinute = parseInt(document.getElementById('start-minute').value) || 0;
                updateClock(startHour, startMinute);
                problemText = `ğŸ“ <b>é¢˜ç›®ï¼š</b>${startHour}:${startMinute.toString().padStart(2, '0')} ä¹‹åï¼Œæ—¶é’ˆå’Œåˆ†é’ˆç¬¬ä¸€æ¬¡é‡åˆæ˜¯ä»€ä¹ˆæ—¶é—´ï¼Ÿ`;
            } else if (currentType === 'right_angle') {
                const startHour = parseInt(document.getElementById('start-hour').value) || 0;
                const startMinute = parseInt(document.getElementById('start-minute').value) || 0;
                const whichTime = parseInt(document.getElementById('which-time').value);
                updateClock(startHour, startMinute);
                problemText = `ğŸ“ <b>é¢˜ç›®ï¼š</b>${startHour}:${startMinute.toString().padStart(2, '0')} ä¹‹åï¼Œæ—¶é’ˆå’Œåˆ†é’ˆç¬¬${whichTime}æ¬¡æˆç›´è§’ï¼ˆ90Â°ï¼‰æ˜¯ä»€ä¹ˆæ—¶é—´ï¼Ÿ`;
            } else if (currentType === 'opposite') {
                const startHour = parseInt(document.getElementById('start-hour').value) || 0;
                const startMinute = parseInt(document.getElementById('start-minute').value) || 0;
                const whichTime = parseInt(document.getElementById('which-time').value);
                updateClock(startHour, startMinute);
                problemText = `ğŸ“ <b>é¢˜ç›®ï¼š</b>${startHour}:${startMinute.toString().padStart(2, '0')} ä¹‹åï¼Œæ—¶é’ˆå’Œåˆ†é’ˆç¬¬${whichTime}æ¬¡åœ¨ä¸€æ¡ç›´çº¿ä¸Šæ˜¯ä»€ä¹ˆæ—¶é—´ï¼Ÿ`;
            }
            
            document.getElementById('problem-text').innerHTML = problemText;
            
            // æ¸…ç©ºè§£ç­”åŒºåŸŸï¼Œæç¤ºç”¨æˆ·ç‚¹å‡»è®¡ç®—
            document.getElementById('solution-steps').innerHTML = `
                <p style="color: #999; text-align: center; padding: 30px;">
                    ğŸ‘† ç‚¹å‡»"å¼€å§‹è®¡ç®—"æŒ‰é’®æŸ¥çœ‹è¯¦ç»†è§£ç­”
                </p>
            `;
            document.getElementById('step-counter').textContent = '0';
            document.getElementById('step-total').textContent = '0';
        }
        
        // æ­¥éª¤æ§åˆ¶å‡½æ•°
        function updateStepVisibility() {
            stepsData.forEach((step, index) => {
                step.classList.toggle('visible', index <= maxReachedStep);
                step.classList.toggle('active', index === currentStep);
            });
            const resultBox = document.querySelector('.result-box');
            if (resultBox) {
                // åªæœ‰å½“æ­¥éª¤æ•°å¤§äº0ï¼Œä¸”å·²åˆ°è¾¾æœ€åä¸€æ­¥æ—¶æ‰æ˜¾ç¤ºç»“æœ
                // stepsData.length = 3 (æ­¥éª¤0,1,2)ï¼Œæ‰€ä»¥ maxReachedStep å¿…é¡» >= 2 æ‰æ˜¾ç¤º
                if (stepsData.length > 0 && maxReachedStep >= stepsData.length - 1) {
                    resultBox.style.display = 'block';
                    resultBox.classList.add('visible');
                } else {
                    resultBox.style.display = 'none';
                    resultBox.classList.remove('visible');
                }
            }
        }
        
        function showStep(stepIndex) {
            currentStep = stepIndex;
            if (stepIndex > maxReachedStep) {
                maxReachedStep = stepIndex;
            }
            
            document.getElementById('step-counter').textContent = stepIndex + 1;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            prevBtn.disabled = stepIndex <= 0;
            nextBtn.disabled = stepIndex >= stepsData.length - 1;
            
            // æ ¹æ®æ­¥éª¤æ›´æ–°æ—¶é’Ÿä½ç½®
            // æœ€åä¸€æ­¥æ˜¾ç¤ºç»“æœæ—¶é—´ï¼Œå…¶ä»–æ­¥éª¤æ˜¾ç¤ºèµ·å§‹æ—¶é—´
            if (stepIndex >= stepsData.length - 1) {
                updateClock(resultTime.hour, resultTime.minute);
            } else {
                updateClock(startTime.hour, startTime.minute);
            }
            
            updateStepVisibility();
        }
        
        function updateButtonStates() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            if (stepsData.length === 0) {
                prevBtn.disabled = true;
                nextBtn.disabled = true;
            } else {
                prevBtn.disabled = currentStep <= 0;
                nextBtn.disabled = currentStep >= stepsData.length - 1;
            }
        }
        
        function nextStep() {
            if (currentStep < stepsData.length - 1) showStep(currentStep + 1);
        }
        
        function prevStep() {
            if (currentStep > 0) showStep(currentStep - 1);
        }
        
        function showAllSteps() {
            if (stepsData.length === 0) {
                startCalculation();
            }
            if (stepsData.length > 0) {
                maxReachedStep = stepsData.length - 1;
                showStep(stepsData.length - 1);
            }
        }
        
        // å¼€å§‹è®¡ç®—
        function startCalculation() {
            if (currentType === 'angle') {
                calculateAngle();
            } else if (currentType === 'overlap') {
                calculateOverlap();
            } else if (currentType === 'right_angle') {
                calculateRightAngle();
            } else if (currentType === 'opposite') {
                calculateOpposite();
            }
        }
        
        // è®¡ç®—
        function calculate() {
            if (currentType === 'angle') {
                calculateAngle();
            } else if (currentType === 'overlap') {
                calculateOverlap();
            } else if (currentType === 'right_angle') {
                calculateRightAngle();
            } else if (currentType === 'opposite') {
                calculateOpposite();
            }
        }
        
        // è®¡ç®—è§’åº¦
        function calculateAngle() {
            const hour = parseInt(document.getElementById('hour').value) || 0;
            const minute = parseInt(document.getElementById('minute').value) || 0;
            
            const hourAngle = (hour % 12) * 30 + minute * 0.5;
            const minuteAngle = minute * 6;
            let angle = Math.abs(hourAngle - minuteAngle);
            if (angle > 180) angle = 360 - angle;
            
            // æ±‚è§’åº¦ç±»å‹ï¼Œèµ·å§‹å’Œç»“æœæ—¶é—´ç›¸åŒ
            startTime = { hour: hour, minute: minute };
            resultTime = { hour: hour, minute: minute };
            
            updateClock(hour, minute);
            
            // æ›´æ–°é¢˜ç›®æ˜¾ç¤º
            document.getElementById('problem-text').innerHTML = `
                ğŸ“ <b>é¢˜ç›®ï¼š</b>${hour}:${minute.toString().padStart(2, '0')} æ—¶ï¼Œæ—¶é’ˆå’Œåˆ†é’ˆçš„å¤¹è§’æ˜¯å¤šå°‘åº¦ï¼Ÿ
            `;
            
            const stepsHtml = `
                <div class="solution-step" data-step="0">
                    <span class="step-number">1</span>
                    <span class="step-title">æ—¶é’ˆä½ç½®ï¼š${hour % 12} Ã— 30Â° + ${minute} Ã— 0.5Â° = ${hourAngle}Â°</span>
                </div>
                <div class="solution-step" data-step="1">
                    <span class="step-number">2</span>
                    <span class="step-title">åˆ†é’ˆä½ç½®ï¼š${minute} Ã— 6Â° = ${minuteAngle}Â°</span>
                </div>
                <div class="solution-step" data-step="2">
                    <span class="step-number">3</span>
                    <span class="step-title">å¤¹è§’è®¡ç®—ï¼š|${hourAngle}Â° - ${minuteAngle}Â°| = ${Math.abs(hourAngle - minuteAngle)}Â°${Math.abs(hourAngle - minuteAngle) > 180 ? `ï¼Œå–è¡¥è§’ 360Â° - ${Math.abs(hourAngle - minuteAngle)}Â° = ${angle}Â°` : ''}</span>
                </div>
                <div class="result-box" style="display:none;">
                    ğŸ¯ ç­”æ¡ˆï¼š${hour}:${minute.toString().padStart(2, '0')} æ—¶ï¼Œå¤¹è§’æ˜¯ <b>${angle}Â°</b>
                </div>
            `;
            
            document.getElementById('solution-steps').innerHTML = stepsHtml;
            initSteps();
        }
        
        // è®¡ç®—é‡åˆæ—¶é—´
        function calculateOverlap() {
            const startHour = parseInt(document.getElementById('start-hour').value) || 0;
            const startMinute = parseInt(document.getElementById('start-minute').value) || 0;
            
            // è®¡ç®—èµ·å§‹æ—¶åˆ»çš„æ—¶é’ˆå’Œåˆ†é’ˆè§’åº¦
            const initialHourAngle = ((startHour % 12) * 30 + startMinute * 0.5) % 360;
            const initialMinuteAngle = (startMinute * 6) % 360;
            
            // è®¡ç®—å½“å‰å¤¹è§’ï¼ˆåˆ†é’ˆéœ€è¦è¿½çš„è§’åº¦ï¼‰
            let angleDiff = initialHourAngle - initialMinuteAngle;
            if (angleDiff < 0) angleDiff += 360;
            if (angleDiff === 0) angleDiff = 360; // å¦‚æœå·²ç»é‡åˆï¼Œæ±‚ä¸‹ä¸€æ¬¡é‡åˆ
            
            // åˆ†é’ˆè¿½ä¸Šæ—¶é’ˆéœ€è¦çš„æ—¶é—´
            const minutesToOverlap = angleDiff / 5.5;
            
            // è®¡ç®—ç»“æœæ—¶é—´
            const totalMinutes = startHour * 60 + startMinute + minutesToOverlap;
            const resultHourVal = Math.floor(totalMinutes / 60) % 12 || 12;
            const resultMinuteVal = totalMinutes % 60;
            const wholeMinutes = Math.floor(resultMinuteVal);
            
            // ä¿å­˜èµ·å§‹å’Œç»“æœæ—¶é—´
            startTime = { hour: startHour, minute: startMinute };
            resultTime = { hour: resultHourVal, minute: resultMinuteVal };
            
            // æ ¼å¼åŒ–èµ·å§‹æ—¶é—´æ˜¾ç¤º
            const startTimeStr = `${startHour}:${startMinute.toString().padStart(2, '0')}`;
            
            // åˆå§‹æ˜¾ç¤ºèµ·å§‹æ—¶é—´
            updateClock(startHour, startMinute);
            
            // æ›´æ–°é¢˜ç›®æ˜¾ç¤º
            document.getElementById('problem-text').innerHTML = `
                ğŸ“ <b>é¢˜ç›®ï¼š</b>${startTimeStr} ä¹‹åï¼Œæ—¶é’ˆå’Œåˆ†é’ˆç¬¬ä¸€æ¬¡é‡åˆæ˜¯ä»€ä¹ˆæ—¶é—´ï¼Ÿ
            `;
            
            const stepsHtml = `
                <div class="solution-step" data-step="0">
                    <span class="step-number">1</span>
                    <span class="step-title">åˆå§‹ä½ç½®ï¼šæ—¶é’ˆ ${initialHourAngle.toFixed(1)}Â°ï¼Œåˆ†é’ˆ ${initialMinuteAngle.toFixed(1)}Â°ï¼Œåˆ†é’ˆéœ€è¿½ ${angleDiff.toFixed(1)}Â°</span>
                </div>
                <div class="solution-step" data-step="1">
                    <span class="step-number">2</span>
                    <span class="step-title">é€Ÿåº¦å·®ï¼š6Â°/åˆ† - 0.5Â°/åˆ† = 5.5Â°/åˆ†</span>
                </div>
                <div class="solution-step" data-step="2">
                    <span class="step-number">3</span>
                    <span class="step-title">è¿½åŠæ—¶é—´ï¼š${angleDiff.toFixed(1)}Â° Ã· 5.5Â°/åˆ† = ${minutesToOverlap.toFixed(2)} åˆ† â‰ˆ ${Math.floor(minutesToOverlap)}åˆ†${Math.round((minutesToOverlap - Math.floor(minutesToOverlap)) * 60)}ç§’</span>
                </div>
                <div class="result-box" style="display:none;">
                    ğŸ¯ ç­”æ¡ˆï¼š<b>${resultHourVal}:${wholeMinutes.toString().padStart(2, '0')}</b>ï¼ˆçº¦ ${Math.floor(minutesToOverlap)}åˆ†${Math.round((minutesToOverlap - Math.floor(minutesToOverlap)) * 60)}ç§’åï¼‰é‡åˆ
                </div>
            `;
            
            document.getElementById('solution-steps').innerHTML = stepsHtml;
            initSteps();
        }
        
        // è®¡ç®—ç›´è§’æ—¶é—´
        function calculateRightAngle() {
            const startHour = parseInt(document.getElementById('start-hour').value) || 0;
            const startMinute = parseInt(document.getElementById('start-minute').value) || 0;
            const whichTime = parseInt(document.getElementById('which-time').value);
            
            // è®¡ç®—èµ·å§‹æ—¶åˆ»çš„æ—¶é’ˆå’Œåˆ†é’ˆè§’åº¦
            const initialHourAngle = ((startHour % 12) * 30 + startMinute * 0.5) % 360;
            const initialMinuteAngle = (startMinute * 6) % 360;
            
            // è®¡ç®—å½“å‰å¤¹è§’
            let currentDiff = initialMinuteAngle - initialHourAngle;
            if (currentDiff < 0) currentDiff += 360;
            
            // è®¡ç®—éœ€è¦è¿½çš„è§’åº¦ï¼ˆæˆ90åº¦æˆ–270åº¦æ—¶éƒ½æ˜¯ç›´è§’ï¼‰
            let targetDiff1, targetDiff2;
            
            // åˆ†é’ˆæ¯”æ—¶é’ˆå¤šèµ°çš„è§’åº¦è¾¾åˆ°90åº¦æˆ–270åº¦æ—¶æˆç›´è§’
            if (currentDiff <= 90) {
                targetDiff1 = 90 - currentDiff;      // ç¬¬ä¸€æ¬¡ï¼šè¿½åˆ°90åº¦
                targetDiff2 = 270 - currentDiff;     // ç¬¬äºŒæ¬¡ï¼šè¿½åˆ°270åº¦
            } else if (currentDiff <= 270) {
                targetDiff1 = 270 - currentDiff;     // ç¬¬ä¸€æ¬¡ï¼šè¿½åˆ°270åº¦
                targetDiff2 = 360 + 90 - currentDiff; // ç¬¬äºŒæ¬¡ï¼šè¿½åˆ°ä¸‹ä¸€åœˆçš„90åº¦
            } else {
                targetDiff1 = 360 + 90 - currentDiff;  // ç¬¬ä¸€æ¬¡ï¼šè¿½åˆ°ä¸‹ä¸€åœˆçš„90åº¦
                targetDiff2 = 360 + 270 - currentDiff; // ç¬¬äºŒæ¬¡ï¼šè¿½åˆ°ä¸‹ä¸€åœˆçš„270åº¦
            }
            
            const targetDiff = whichTime === 1 ? targetDiff1 : targetDiff2;
            const minutesToTarget = targetDiff / 5.5;
            
            // è®¡ç®—ç»“æœæ—¶é—´
            const totalMinutes = startHour * 60 + startMinute + minutesToTarget;
            const resultHourVal = Math.floor(totalMinutes / 60) % 12 || 12;
            const resultMinuteVal = totalMinutes % 60;
            const wholeMinutes = Math.floor(resultMinuteVal);
            const seconds = Math.round((resultMinuteVal - wholeMinutes) * 60);
            
            // ä¿å­˜èµ·å§‹å’Œç»“æœæ—¶é—´
            startTime = { hour: startHour, minute: startMinute };
            resultTime = { hour: resultHourVal, minute: resultMinuteVal };
            
            const startTimeStr = `${startHour}:${startMinute.toString().padStart(2, '0')}`;
            
            // åˆå§‹æ˜¾ç¤ºèµ·å§‹æ—¶é—´
            updateClock(startHour, startMinute);
            
            document.getElementById('problem-text').innerHTML = `
                ğŸ“ <b>é¢˜ç›®ï¼š</b>${startTimeStr} ä¹‹åï¼Œæ—¶é’ˆå’Œåˆ†é’ˆç¬¬${whichTime}æ¬¡æˆç›´è§’ï¼ˆ90Â°ï¼‰æ˜¯ä»€ä¹ˆæ—¶é—´ï¼Ÿ
            `;
            
            const stepsHtml = `
                <div class="solution-step" data-step="0">
                    <span class="step-number">1</span>
                    <span class="step-title">åˆå§‹ä½ç½®ï¼šæ—¶é’ˆ ${initialHourAngle.toFixed(1)}Â°ï¼Œåˆ†é’ˆ ${initialMinuteAngle.toFixed(1)}Â°ï¼Œå½“å‰å¤¹è§’ ${Math.min(currentDiff, 360 - currentDiff).toFixed(1)}Â°</span>
                </div>
                <div class="solution-step" data-step="1">
                    <span class="step-number">2</span>
                    <span class="step-title">é€Ÿåº¦å·®ï¼š6Â°/åˆ† - 0.5Â°/åˆ† = 5.5Â°/åˆ†ï¼Œåˆ†é’ˆéœ€å¤šèµ° ${targetDiff.toFixed(1)}Â° æˆç›´è§’</span>
                </div>
                <div class="solution-step" data-step="2">
                    <span class="step-number">3</span>
                    <span class="step-title">è¿½åŠæ—¶é—´ï¼š${targetDiff.toFixed(1)}Â° Ã· 5.5Â°/åˆ† = ${minutesToTarget.toFixed(2)} åˆ† â‰ˆ ${Math.floor(minutesToTarget)}åˆ†${Math.round((minutesToTarget - Math.floor(minutesToTarget)) * 60)}ç§’</span>
                </div>
                <div class="result-box" style="display:none;">
                    ğŸ¯ ç­”æ¡ˆï¼š<b>${resultHourVal}:${wholeMinutes.toString().padStart(2, '0')}</b>ï¼ˆçº¦ ${Math.floor(minutesToTarget)}åˆ†${Math.round((minutesToTarget - Math.floor(minutesToTarget)) * 60)}ç§’åï¼‰ç¬¬${whichTime}æ¬¡æˆç›´è§’
                </div>
            `;
            
            document.getElementById('solution-steps').innerHTML = stepsHtml;
            initSteps();
        }
        
        // è®¡ç®—æˆä¸€ç›´çº¿æ—¶é—´
        function calculateOpposite() {
            const startHour = parseInt(document.getElementById('start-hour').value) || 0;
            const startMinute = parseInt(document.getElementById('start-minute').value) || 0;
            const whichTime = parseInt(document.getElementById('which-time').value);
            
            // è®¡ç®—èµ·å§‹æ—¶åˆ»çš„æ—¶é’ˆå’Œåˆ†é’ˆè§’åº¦
            const initialHourAngle = ((startHour % 12) * 30 + startMinute * 0.5) % 360;
            const initialMinuteAngle = (startMinute * 6) % 360;
            
            // è®¡ç®—å½“å‰å¤¹è§’
            let currentDiff = initialMinuteAngle - initialHourAngle;
            if (currentDiff < 0) currentDiff += 360;
            
            // ä¸€ç›´çº¿ï¼šå¤¹è§’ä¸º0åº¦ï¼ˆé‡åˆï¼‰æˆ–180åº¦ï¼ˆç›¸å¯¹ï¼‰
            let targetDiff;
            if (whichTime === 1) {
                // ç¬¬ä¸€æ¬¡æˆä¸€ç›´çº¿ï¼šå…ˆæˆ180åº¦
                if (currentDiff < 180) {
                    targetDiff = 180 - currentDiff;
                } else if (currentDiff === 180) {
                    targetDiff = 360; // å·²ç»180åº¦ï¼Œæ±‚ä¸‹ä¸€æ¬¡ï¼ˆé‡åˆï¼‰
                } else {
                    targetDiff = 360 + 180 - currentDiff;
                }
            } else {
                // ç¬¬äºŒæ¬¡æˆä¸€ç›´çº¿ï¼šé‡åˆï¼ˆ360åº¦ï¼‰æˆ–ä¸‹ä¸€ä¸ª180åº¦
                if (currentDiff < 180) {
                    targetDiff = 360 - currentDiff; // é‡åˆ
                } else {
                    targetDiff = 360 + 180 - currentDiff; // ä¸‹ä¸€æ¬¡180åº¦
                }
            }
            
            const minutesToTarget = targetDiff / 5.5;
            
            // è®¡ç®—ç»“æœæ—¶é—´
            const totalMinutes = startHour * 60 + startMinute + minutesToTarget;
            const resultHourVal = Math.floor(totalMinutes / 60) % 12 || 12;
            const resultMinuteVal = totalMinutes % 60;
            const wholeMinutes = Math.floor(resultMinuteVal);
            const seconds = Math.round((resultMinuteVal - wholeMinutes) * 60);
            
            // ä¿å­˜èµ·å§‹å’Œç»“æœæ—¶é—´
            startTime = { hour: startHour, minute: startMinute };
            resultTime = { hour: resultHourVal, minute: resultMinuteVal };
            
            const startTimeStr = `${startHour}:${startMinute.toString().padStart(2, '0')}`;
            const isOverlap = (targetDiff % 360 === 0) || (currentDiff === 0 && whichTime === 2);
            
            // åˆå§‹æ˜¾ç¤ºèµ·å§‹æ—¶é—´
            updateClock(startHour, startMinute);
            
            document.getElementById('problem-text').innerHTML = `
                ğŸ“ <b>é¢˜ç›®ï¼š</b>${startTimeStr} ä¹‹åï¼Œæ—¶é’ˆå’Œåˆ†é’ˆç¬¬${whichTime}æ¬¡åœ¨ä¸€æ¡ç›´çº¿ä¸Šæ˜¯ä»€ä¹ˆæ—¶é—´ï¼Ÿ
            `;
            
            const stepsHtml = `
                <div class="solution-step" data-step="0">
                    <span class="step-number">1</span>
                    <span class="step-title">åˆå§‹ä½ç½®ï¼šæ—¶é’ˆ ${initialHourAngle.toFixed(1)}Â°ï¼Œåˆ†é’ˆ ${initialMinuteAngle.toFixed(1)}Â°ï¼Œå½“å‰å¤¹è§’ ${Math.min(currentDiff, 360 - currentDiff).toFixed(1)}Â°</span>
                </div>
                <div class="solution-step" data-step="1">
                    <span class="step-number">2</span>
                    <span class="step-title">é€Ÿåº¦å·®ï¼š6Â°/åˆ† - 0.5Â°/åˆ† = 5.5Â°/åˆ†ï¼Œåˆ†é’ˆéœ€å¤šèµ° ${targetDiff.toFixed(1)}Â° æˆä¸€ç›´çº¿</span>
                </div>
                <div class="solution-step" data-step="2">
                    <span class="step-number">3</span>
                    <span class="step-title">è¿½åŠæ—¶é—´ï¼š${targetDiff.toFixed(1)}Â° Ã· 5.5Â°/åˆ† = ${minutesToTarget.toFixed(2)} åˆ† â‰ˆ ${Math.floor(minutesToTarget)}åˆ†${Math.round((minutesToTarget - Math.floor(minutesToTarget)) * 60)}ç§’</span>
                </div>
                <div class="result-box" style="display:none;">
                    ğŸ¯ ç­”æ¡ˆï¼š<b>${resultHourVal}:${wholeMinutes.toString().padStart(2, '0')}</b>ï¼ˆçº¦ ${Math.floor(minutesToTarget)}åˆ†${Math.round((minutesToTarget - Math.floor(minutesToTarget)) * 60)}ç§’åï¼‰ç¬¬${whichTime}æ¬¡æˆä¸€ç›´çº¿${targetDiff % 360 === 0 || (360 - currentDiff) < 1 ? 'ï¼ˆé‡åˆï¼‰' : 'ï¼ˆç›¸å¯¹180Â°ï¼‰'}
                </div>
            `;
            
            document.getElementById('solution-steps').innerHTML = stepsHtml;
            initSteps();
        }
        
        // åˆå§‹åŒ–æ­¥éª¤
        function initSteps() {
            stepsData = Array.from(document.querySelectorAll('.solution-step'));
            currentStep = 0;
            maxReachedStep = 0;
            
            document.getElementById('step-total').textContent = stepsData.length;
            document.getElementById('step-counter').textContent = '1';
            
            if (stepsData.length > 0) {
                showStep(0);
            }
        }
        
        // åŠ¨ç”»æ¼”ç¤º
        function toggleAnimation() {
            const btn = document.getElementById('play-btn');
            if (isAnimating) {
                isAnimating = false;
                btn.innerHTML = '<i class="fas fa-play"></i> è‡ªåŠ¨è¿è¡Œ';
                btn.classList.remove('pause');
                btn.classList.add('play');
                if (animationId) cancelAnimationFrame(animationId);
            } else {
                isAnimating = true;
                btn.innerHTML = '<i class="fas fa-pause"></i> æš‚åœ';
                btn.classList.remove('play');
                btn.classList.add('pause');
                animateClock();
            }
        }
        
        let animTime = 0;
        function animateClock() {
            if (!isAnimating) return;
            
            animTime += 0.5;
            if (animTime >= 720) animTime = 0;
            
            const hour = Math.floor(animTime / 60);
            const minute = animTime % 60;
            updateClock(hour, minute);
            
            animationId = requestAnimationFrame(animateClock);
        }
        
        function resetClock() {
            isAnimating = false;
            animTime = 0;
            const btn = document.getElementById('play-btn');
            btn.innerHTML = '<i class="fas fa-play"></i> è‡ªåŠ¨è¿è¡Œ';
            btn.classList.remove('pause');
            btn.classList.add('play');
            if (animationId) cancelAnimationFrame(animationId);
            updateClock(12, 0);
        }
        
        function resetAll() {
            document.getElementById('hour').value = 12;
            document.getElementById('minute').value = 0;
            document.getElementById('start-hour').value = 12;
            document.getElementById('start-minute').value = 0;
            document.getElementById('which-time').value = 1;
            selectProblemType('overlap');
            resetClock();
            updateClock(12, 0);
            stepsData = [];
            currentStep = 0;
            maxReachedStep = 0;
            document.getElementById('step-counter').textContent = '0';
            document.getElementById('step-total').textContent = '0';
            document.getElementById('prevBtn').disabled = true;
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('solution-steps').innerHTML = `
                <p style="color: #999; text-align: center; padding: 30px;">
                    ğŸ‘† è®¾ç½®é¢˜ç›®å‚æ•°åç‚¹å‡»"å¼€å§‹è®¡ç®—"æŒ‰é’®æŸ¥çœ‹è¯¦ç»†è§£ç­”
                </p>
            `;
        }
        
        // ç›‘å¬è¾“å…¥å˜åŒ–
        document.getElementById('hour').addEventListener('input', function() {
            const hour = parseInt(this.value) || 0;
            const minute = parseInt(document.getElementById('minute').value) || 0;
            updateClock(hour, minute);
            // åªæ›´æ–°é¢˜ç›®æ˜¾ç¤º
            if (currentType === 'angle') {
                updateProblemDisplay();
            }
        });
        
        document.getElementById('minute').addEventListener('input', function() {
            const hour = parseInt(document.getElementById('hour').value) || 0;
            const minute = parseInt(this.value) || 0;
            updateClock(hour, minute);
            // åªæ›´æ–°é¢˜ç›®æ˜¾ç¤º
            if (currentType === 'angle') {
                updateProblemDisplay();
            }
        });
        
        // ç›‘å¬èµ·å§‹æ—¶é—´å˜åŒ–
        document.getElementById('start-hour').addEventListener('input', function() {
            updateProblemDisplay();
        });
        
        document.getElementById('start-minute').addEventListener('input', function() {
            updateProblemDisplay();
        });
        
        // ç›‘å¬ç¬¬å‡ æ¬¡å˜åŒ–
        document.getElementById('which-time').addEventListener('change', function() {
            updateProblemDisplay();
        });
        
        // åˆå§‹åŒ–
        initClock();
        // é¡µé¢åŠ è½½åæ˜¾ç¤ºé»˜è®¤é¢˜ç›®
        updateProblemDisplay();
    </script>
    <a href="../../index.html" style="display:block;text-align:center;margin:30px auto;color:#fff;text-decoration:none;font-size:14px;">â† è¿”å›çš®å¡ä¸˜å­¦ä¹ èµ„æº</a>
</body>
</html>

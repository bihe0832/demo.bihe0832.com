<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />    
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="Expires" content="0">
    <link rel="Shortcut Icon" href="https://cdn.bihe0832.com/images/zixie_32.ico" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="author" CONTENT="å­å‹°(bihe0832), code@bihe0832.com" />
    <meta name="keywords" content="å­å‹°,bihe0832,å·¥å…·å’©" />
    <meta name="description" content="çš®å¡ä¸˜å­¦æ•°å­¦ä¹‹è¡Œç¨‹é—®é¢˜åˆ†æ­¥è§£ç­”" />
    <meta property="og:title" content="çš®å¡ä¸˜å­¦æ•°å­¦ä¹‹è¡Œç¨‹é—®é¢˜åˆ†æ­¥è§£ç­”" />
    <meta property="og:locale" content="en_US" />
    <title>çš®å¡ä¸˜å­¦æ•°å­¦ä¹‹è¡Œç¨‹é—®é¢˜åˆ†æ­¥è§£ç­”</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #3498db, #2ecc71);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 1400px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            margin: 20px 0;
            padding: 20px;
        }
        header {
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        header h2 {
            font-size: 2rem;
            margin: 10px 0;
            text-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }
        
        .main-content {
            display: flex;
            gap: 20px;
            min-height: 500px;
        }
        
        .left-panel {
            width: 280px;
            flex-shrink: 0;
            background: #e8f4fc;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .panel-title {
            font-size: 1.1rem;
            color: #2980b9;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 3px solid #3498db;
            display: flex;
            align-items: center;
        }
        .panel-title i {
            margin-right: 10px;
            font-size: 1.2rem;
            color: #3498db;
        }
        
        .problem-type {
            margin-bottom: 20px;
        }
        .type-btn {
            display: block;
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
            font-size: 14px;
            border: none;
        }
        .type-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(52, 152, 219, 0.4);
        }
        .type-btn.active {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            box-shadow: 0 6px 12px rgba(39, 174, 96, 0.4);
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        .input-item {
            margin-bottom: 15px;
        }
        .input-label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2980b9;
            font-size: 0.95rem;
        }
        input {
            padding: 12px 15px;
            width: 100%;
            border: 2px solid #3498db;
            border-radius: 10px;
            font-size: 1.1rem;
            text-align: center;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        input:focus {
            border-color: #27ae60;
            outline: none;
            box-shadow: 0 0 8px rgba(39, 174, 96, 0.3);
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        
        button {
            padding: 12px 20px;
            font-size: 1rem;
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.3s, background 0.3s;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: linear-gradient(90deg, #bdc3c7, #95a5a6);
            cursor: not-allowed;
            transform: none;
        }
        
        .start-btn {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            box-shadow: 0 4px 10px rgba(39, 174, 96, 0.3);
        }
        
        .show-all-btn {
            background: linear-gradient(90deg, #f39c12, #e67e22);
            box-shadow: 0 4px 10px rgba(243, 156, 18, 0.3);
        }
        
        .nav-buttons {
            display: flex;
            gap: 8px;
        }
        .nav-buttons button {
            flex: 1;
            padding: 10px 8px;
            font-size: 0.9rem;
        }
        
        .center-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 400px;
        }
        
        .visual-header {
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            padding: 12px 20px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1rem;
        }
        
        .visual-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            border: 4px solid #3498db;
            border-top: none;
            border-radius: 0 0 15px 15px;
            background: linear-gradient(135deg, #e8f4fc, #d4edfc);
            min-height: 400px;
            padding: 20px;
            gap: 20px;
        }
        
        .problem-text {
            background: linear-gradient(135deg, #fff, #ffeaa7);
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #f39c12;
            font-size: 1.1rem;
            color: #2c3e50;
            line-height: 1.6;
            max-width: 95%;
            text-align: center;
        }
        
        .problem-text i {
            color: #f39c12;
            margin-right: 8px;
        }
        
        .problem-text .question {
            font-weight: bold;
            color: #e74c3c;
        }
        
        /* è¡Œç¨‹åŠ¨ç”»åŒºåŸŸ */
        .travel-animation {
            width: 100%;
            max-width: 600px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .road-container {
            position: relative;
            height: 120px;
            margin: 20px 0;
        }
        
        .road {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(90deg, #95a5a6, #7f8c8d);
            border-radius: 10px;
            transform: translateY(-50%);
        }
        
        .road-line {
            position: absolute;
            top: 50%;
            left: 5%;
            right: 5%;
            height: 3px;
            background: repeating-linear-gradient(90deg, #fff 0, #fff 20px, transparent 20px, transparent 40px);
            transform: translateY(-50%);
        }
        
        .location {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }
        
        .location-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .location-name {
            font-size: 0.8rem;
            color: #333;
            font-weight: bold;
            background: white;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .traveler {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: left 0.5s ease-out;
            z-index: 20;
        }
        
        .traveler-icon {
            font-size: 2rem;
            display: inline-block;
        }
        
        .traveler.face-right .traveler-icon {
            transform: scaleX(-1);
        }
        
        .traveler.face-left .traveler-icon {
            transform: scaleX(1);
        }
        
        .traveler-speed {
            font-size: 0.75rem;
            color: #fff;
            background: #3498db;
            padding: 2px 8px;
            border-radius: 10px;
            white-space: nowrap;
        }
        
        .traveler.person-b .traveler-speed {
            background: #e74c3c;
        }
        
        .distance-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            font-weight: bold;
            color: #2980b9;
            background: #e8f4fc;
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        /* ç¯å½¢è·‘é“ */
        .track-container {
            position: relative;
            width: 350px;
            height: 180px;
            margin: 20px auto;
        }
        
        .track-oval {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 15px solid #95a5a6;
            border-radius: 75px;
            background: #2ecc71;
        }
        
        .track-inner {
            position: absolute;
            top: 25px;
            left: 40px;
            width: calc(100% - 80px);
            height: calc(100% - 50px);
            background: #27ae60;
            border-radius: 50px;
        }
        
        .track-line {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background: white;
            transform: translateY(-50%);
        }
        
        .track-start {
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
        }
        
        .runner {
            position: absolute;
            font-size: 1.8rem;
            transition: all 0.3s ease-out;
        }
        
        .runner-a {
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .runner-b {
            top: -25px;
            left: calc(50% + 30px);
            transform: translateX(-50%);
        }
        
        .track-label {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
            color: #2980b9;
        }
        
        /* ç­”æ¡ˆå¡ç‰‡ */
        .answer-cards {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .answer-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 25px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .answer-card:hover {
            transform: scale(1.05);
        }
        
        .answer-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .answer-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 3px;
        }
        
        .answer-value {
            font-size: 1.6rem;
            font-weight: bold;
            color: #3498db;
        }
        
        .answer-unit {
            font-size: 0.8rem;
            color: #999;
        }
        
        .right-panel {
            width: 350px;
            flex-shrink: 0;
            background: #e8f4fc;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .steps-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: linear-gradient(to right, #e8f4fc, #d4edfc);
            border-radius: 12px;
        }
        
        .step {
            padding: 10px 0;
            display: none;
            border-bottom: 1px dashed rgba(52, 152, 219, 0.3);
        }
        
        .step:last-child {
            border-bottom: none;
        }
        
        .step.visible {
            display: block;
            animation: fadeInStep 0.4s ease;
        }
        
        @keyframes fadeInStep {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .step.active {
            animation: breatheBlue 1.5s ease-in-out infinite;
        }
        
        @keyframes breatheBlue {
            0%, 100% { background-color: rgba(52, 152, 219, 0.1); }
            50% { background-color: rgba(52, 152, 219, 0.25); }
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 12px;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .step-title {
            font-weight: bold;
            color: #2980b9;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        
        .highlight {
            color: #27ae60;
            font-weight: bold;
            background-color: #e8f8f5;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .empty-steps {
            text-align: center;
            color: #7f8c8d;
            padding: 40px 20px;
            font-size: 1rem;
        }
        .empty-steps i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #bdc3c7;
            display: block;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            .left-panel, .right-panel {
                width: 100%;
            }
            .left-panel { order: 1; }
            .center-panel { order: 2; min-height: 350px; }
            .right-panel { order: 3; }
            .controls {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .controls button {
                flex: 1;
                min-width: 120px;
            }
            .problem-type {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
            }
            .type-btn {
                flex: 1;
                margin-bottom: 0;
                min-width: 100px;
            }
        }
        
        @media (max-width: 600px) {
            header h2 { font-size: 1.5rem; }
            .controls { flex-direction: column; }
            .answer-cards { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h2><i class="fas fa-route"></i> çš®å¡ä¸˜å­¦æ•°å­¦ä¹‹è¡Œç¨‹é—®é¢˜åˆ†æ­¥è§£ç­”</h2>
            <p>è·¯ç¨‹ = é€Ÿåº¦ Ã— æ—¶é—´ï¼Œç›¸é‡ç”¨å’Œã€è¿½åŠç”¨å·®</p>
        </header>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="panel-title">
                    <i class="fas fa-question-circle"></i>
                    <span>é¢˜ç›®ç±»å‹</span>
                </div>
                
                <div class="problem-type">
                    <button class="type-btn active" onclick="selectType('meet')">
                        <i class="fas fa-people-arrows"></i> ç›¸é‡é—®é¢˜
                    </button>
                    <button class="type-btn" onclick="selectType('chase')">
                        <i class="fas fa-running"></i> ç›´çº¿è¿½åŠ
                    </button>
                    <button class="type-btn" onclick="selectType('lap')">
                        <i class="fas fa-circle-notch"></i> ç¯å½¢å¥—åœˆ
                    </button>
                    <button class="type-btn" onclick="selectType('river_down')">
                        <i class="fas fa-ship"></i> é¡ºæ°´è¡Œèˆ¹
                    </button>
                    <button class="type-btn" onclick="selectType('river_up')">
                        <i class="fas fa-anchor"></i> é€†æ°´è¡Œèˆ¹
                    </button>
                </div>
                
                <div class="panel-title">
                    <i class="fas fa-cog"></i>
                    <span>é—®é¢˜è®¾ç½®</span>
                </div>
                
                <div class="input-group" id="inputGroup"></div>
                
                <div class="controls">
                    <button class="start-btn" onclick="startCalculation()">
                        <i class="fas fa-play-circle"></i> å¼€å§‹è®¡ç®—
                    </button>
                    <button class="show-all-btn" onclick="showAllSteps()">
                        <i class="fas fa-eye"></i> ä¸€é”®æŸ¥çœ‹
                    </button>
                    <div class="nav-buttons">
                        <button id="prevBtn" onclick="prevStep()" disabled>
                            <i class="fas fa-arrow-left"></i> ä¸Šä¸€æ­¥
                        </button>
                        <button id="nextBtn" onclick="nextStep()" disabled>
                            ä¸‹ä¸€æ­¥ <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="center-panel">
                <div class="visual-header">
                    <span><i class="fas fa-road"></i> è¡Œç¨‹å¯è§†åŒ–</span>
                    <span id="problemDesc">è¯·è®¾ç½®é¢˜ç›®</span>
                </div>
                <div class="visual-area" id="visualArea">
                    <div class="problem-text" id="problemText">
                        <i class="fas fa-question-circle"></i>
                        <span>è¯·è®¾ç½®é¢˜ç›®æ¡ä»¶ï¼Œç„¶åç‚¹å‡»"å¼€å§‹è®¡ç®—"</span>
                    </div>
                    <div class="travel-animation" id="travelAnimation">
                        <div class="road-container">
                            <div class="road">
                                <div class="road-line"></div>
                            </div>
                            <div class="location" id="locationA" style="left: 5%;">
                                <div class="location-icon">ğŸ </div>
                                <div class="location-name">Aåœ°</div>
                            </div>
                            <div class="location" id="locationB" style="left: 95%;">
                                <div class="location-icon">ğŸ¢</div>
                                <div class="location-name">Båœ°</div>
                            </div>
                            <div class="traveler person-a face-right" id="travelerA" style="left: 5%;">
                                <div class="traveler-icon">ğŸš¶</div>
                                <div class="traveler-speed" id="speedLabelA">?km/h</div>
                            </div>
                            <div class="traveler person-b face-left" id="travelerB" style="left: 95%;">
                                <div class="traveler-icon">ğŸš´</div>
                                <div class="traveler-speed" id="speedLabelB">?km/h</div>
                            </div>
                            <div class="distance-label" id="distanceLabel">? åƒç±³</div>
                        </div>
                    </div>
                    <div class="answer-cards" id="answerCards">
                        <div class="answer-card">
                            <div class="answer-icon">â±ï¸</div>
                            <div class="answer-label">ç›¸é‡æ—¶é—´</div>
                            <div class="answer-value" id="timeAnswer">?</div>
                            <div class="answer-unit">å°æ—¶</div>
                        </div>
                        <div class="answer-card">
                            <div class="answer-icon">ğŸ“</div>
                            <div class="answer-label">ç›¸é‡åœ°ç‚¹</div>
                            <div class="answer-value" id="placeAnswer">?</div>
                            <div class="answer-unit">è·Aåœ°åƒç±³</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="panel-title">
                    <i class="fas fa-list-ol"></i>
                    <span>è§£é¢˜æ­¥éª¤</span>
                    <span style="margin-left: auto; font-size: 0.9rem; color: #7f8c8d;">
                        æ­¥éª¤: <span id="step-counter">0</span>/<span id="total-steps">0</span>
                    </span>
                </div>
                <div class="steps-container" id="steps">
                    <div class="empty-steps">
                        <i class="fas fa-info-circle"></i>
                        <p>è¯·è®¾ç½®é¢˜ç›®æ¡ä»¶<br>ç„¶åç‚¹å‡»"å¼€å§‹è®¡ç®—"</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let stepsData = [];
        let currentStep = 0;
        let maxReachedStep = 0;
        let currentType = 'meet';
        let result = {};
        
        const problemConfigs = {
            meet: {
                title: 'ç›¸é‡é—®é¢˜',
                desc: 'ä¸¤äººç›¸å‘è€Œè¡Œï¼Œæ±‚ç›¸é‡æ—¶é—´',
                inputs: [
                    { id: 'distance', label: 'ğŸ›¤ï¸ ä¸¤åœ°è·ç¦»ï¼ˆåƒç±³ï¼‰', placeholder: 'å¦‚ï¼š120', value: 120 },
                    { id: 'speedA', label: 'ğŸš¶ ç”²çš„é€Ÿåº¦ï¼ˆåƒç±³/æ—¶ï¼‰', placeholder: 'å¦‚ï¼š20', value: 20 },
                    { id: 'speedB', label: 'ğŸš´ ä¹™çš„é€Ÿåº¦ï¼ˆåƒç±³/æ—¶ï¼‰', placeholder: 'å¦‚ï¼š40', value: 40 }
                ],
                answerLabels: ['ç›¸é‡æ—¶é—´', 'ç”²èµ°çš„è·¯ç¨‹']
            },
            chase: {
                title: 'ç›´çº¿è¿½åŠ',
                desc: 'ä¸¤äººåŒå‘è€Œè¡Œï¼Œå¿«çš„è¿½æ…¢çš„',
                inputs: [
                    { id: 'distance', label: 'ğŸ›¤ï¸ ç›¸è·è·ç¦»ï¼ˆåƒç±³ï¼‰', placeholder: 'å¦‚ï¼š30', value: 30 },
                    { id: 'speedA', label: 'ğŸš´ å¿«è€…é€Ÿåº¦ï¼ˆåƒç±³/æ—¶ï¼‰', placeholder: 'å¦‚ï¼š25', value: 25 },
                    { id: 'speedB', label: 'ğŸš¶ æ…¢è€…é€Ÿåº¦ï¼ˆåƒç±³/æ—¶ï¼‰', placeholder: 'å¦‚ï¼š15', value: 15 }
                ],
                answerLabels: ['è¿½ä¸Šæ—¶é—´', 'å¿«è€…èµ°çš„è·¯ç¨‹']
            },
            lap: {
                title: 'ç¯å½¢å¥—åœˆ',
                desc: 'ç¯å½¢è·‘é“ï¼Œå¿«çš„å¥—æ…¢çš„åœˆ',
                inputs: [
                    { id: 'perimeter', label: 'ğŸ”„ è·‘é“å‘¨é•¿ï¼ˆç±³ï¼‰', placeholder: 'å¦‚ï¼š400', value: 400 },
                    { id: 'speedA', label: 'ğŸƒ å¿«è€…é€Ÿåº¦ï¼ˆç±³/åˆ†ï¼‰', placeholder: 'å¦‚ï¼š300', value: 300 },
                    { id: 'speedB', label: 'ğŸš¶ æ…¢è€…é€Ÿåº¦ï¼ˆç±³/åˆ†ï¼‰', placeholder: 'å¦‚ï¼š200', value: 200 },
                    { id: 'totalTime', label: 'â±ï¸ æ€»æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰', placeholder: 'å¦‚ï¼š20', value: 20 }
                ],
                answerLabels: ['å¥—åœˆæ—¶é—´', 'å¥—åœˆæ¬¡æ•°']
            },
            river_down: {
                title: 'é¡ºæ°´è¡Œèˆ¹',
                desc: 'èˆ¹é¡ºæµè€Œä¸‹ï¼Œæ°´æµåŠ©åŠ›',
                inputs: [
                    { id: 'distance', label: 'ğŸ›¤ï¸ èˆªè¡Œè·ç¦»ï¼ˆåƒç±³ï¼‰', placeholder: 'å¦‚ï¼š60', value: 60 },
                    { id: 'boatSpeed', label: 'ğŸš¤ èˆ¹é€Ÿï¼ˆåƒç±³/æ—¶ï¼‰', placeholder: 'å¦‚ï¼š15', value: 15 },
                    { id: 'waterSpeed', label: 'ğŸŒŠ æ°´é€Ÿï¼ˆåƒç±³/æ—¶ï¼‰', placeholder: 'å¦‚ï¼š5', value: 5 }
                ],
                answerLabels: ['èˆªè¡Œæ—¶é—´', 'å®é™…é€Ÿåº¦']
            },
            river_up: {
                title: 'é€†æ°´è¡Œèˆ¹',
                desc: 'èˆ¹é€†æµè€Œä¸Šï¼Œæ°´æµé˜»åŠ›',
                inputs: [
                    { id: 'distance', label: 'ğŸ›¤ï¸ èˆªè¡Œè·ç¦»ï¼ˆåƒç±³ï¼‰', placeholder: 'å¦‚ï¼š60', value: 60 },
                    { id: 'boatSpeed', label: 'ğŸš¤ èˆ¹é€Ÿï¼ˆåƒç±³/æ—¶ï¼‰', placeholder: 'å¦‚ï¼š15', value: 15 },
                    { id: 'waterSpeed', label: 'ğŸŒŠ æ°´é€Ÿï¼ˆåƒç±³/æ—¶ï¼‰', placeholder: 'å¦‚ï¼š5', value: 5 }
                ],
                answerLabels: ['èˆªè¡Œæ—¶é—´', 'å®é™…é€Ÿåº¦']
            }
        };
        
        function selectType(type) {
            currentType = type;
            document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.type-btn').classList.add('active');
            renderInputs();
            resetVisualization();
        }
        
        function renderInputs() {
            const config = problemConfigs[currentType];
            document.getElementById('inputGroup').innerHTML = config.inputs.map(input => `
                <div class="input-item">
                    <label class="input-label">${input.label}</label>
                    <input type="number" id="${input.id}" placeholder="${input.placeholder}" value="${input.value}" min="1">
                </div>
            `).join('');
        }
        
        function resetVisualization() {
            const config = problemConfigs[currentType];
            document.getElementById('problemDesc').textContent = config.desc;
            document.getElementById('problemText').innerHTML = `
                <i class="fas fa-question-circle"></i>
                <span>è¯·è®¾ç½®é¢˜ç›®æ¡ä»¶ï¼Œç„¶åç‚¹å‡»"å¼€å§‹è®¡ç®—"</span>
            `;
            document.getElementById('timeAnswer').textContent = '?';
            document.getElementById('placeAnswer').textContent = '?';
            document.getElementById('distanceLabel').textContent = '? åƒç±³';
            document.getElementById('speedLabelA').textContent = '?km/h';
            document.getElementById('speedLabelB').textContent = '?km/h';
            
            // æ›´æ–°ç­”æ¡ˆå¡ç‰‡æ ‡ç­¾
            const answerCards = document.querySelectorAll('.answer-card');
            answerCards[0].querySelector('.answer-label').textContent = config.answerLabels[0];
            answerCards[1].querySelector('.answer-label').textContent = config.answerLabels[1];
            
            // æ›´æ–°å¯è§†åŒ–
            updateTravelVisual();
            
            document.getElementById('steps').innerHTML = `
                <div class="empty-steps">
                    <i class="fas fa-info-circle"></i>
                    <p>è¯·è®¾ç½®é¢˜ç›®æ¡ä»¶<br>ç„¶åç‚¹å‡»"å¼€å§‹è®¡ç®—"</p>
                </div>
            `;
            stepsData = [];
            currentStep = 0;
            maxReachedStep = 0;
            document.getElementById('step-counter').textContent = '0';
            document.getElementById('total-steps').textContent = '0';
            document.getElementById('prevBtn').disabled = true;
            document.getElementById('nextBtn').disabled = true;
        }
        
        function updateTravelVisual() {
            const travelerA = document.getElementById('travelerA');
            const travelerB = document.getElementById('travelerB');
            const locationA = document.getElementById('locationA');
            const locationB = document.getElementById('locationB');
            const roadContainer = document.querySelector('.road-container');
            
            // ç§»é™¤ç¯å½¢è·‘é“ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            const existingTrack = document.querySelector('.track-container');
            if (existingTrack) existingTrack.remove();
            
            // é‡ç½®ä½ç½®å›¾æ ‡
            locationA.querySelector('.location-icon').textContent = 'ğŸ ';
            locationB.querySelector('.location-icon').textContent = 'ğŸ¢';
            
            if (currentType === 'lap') {
                // ç¯å½¢å¥—åœˆï¼šæ˜¾ç¤ºç¯å½¢è·‘é“
                roadContainer.style.display = 'none';
                
                const trackHTML = `
                    <div class="track-container">
                        <div class="track-oval">
                            <div class="track-inner"></div>
                            <div class="track-line"></div>
                            <div class="track-start">ğŸš©</div>
                            <div class="runner runner-a" id="runnerA">ğŸƒ</div>
                            <div class="runner runner-b" id="runnerB">ğŸš¶</div>
                        </div>
                        <div class="track-label" id="trackLabel">å‘¨é•¿ ? ç±³</div>
                    </div>
                `;
                roadContainer.insertAdjacentHTML('afterend', trackHTML);
                return;
            }
            
            // å…¶ä»–ç±»å‹ï¼šæ˜¾ç¤ºç›´çº¿é“è·¯
            roadContainer.style.display = 'block';
            
            if (currentType === 'meet') {
                // ç›¸é‡ï¼šç”²ä»å·¦å¾€å³èµ°ï¼Œä¹™ä»å³å¾€å·¦èµ°
                travelerA.style.left = '5%';
                travelerB.style.left = '95%';
                travelerA.querySelector('.traveler-icon').textContent = 'ğŸš¶';
                travelerB.querySelector('.traveler-icon').textContent = 'ğŸš´';
                travelerA.classList.add('face-right');
                travelerA.classList.remove('face-left');
                travelerB.classList.add('face-left');
                travelerB.classList.remove('face-right');
                travelerB.style.display = 'flex';
                locationA.querySelector('.location-name').textContent = 'Aåœ°';
                locationB.querySelector('.location-name').textContent = 'Båœ°';
            } else if (currentType === 'chase') {
                // è¿½åŠï¼šæ…¢è€…åœ¨å‰ï¼ˆå³ï¼‰ï¼Œå¿«è€…åœ¨åï¼ˆå·¦ï¼‰ï¼Œéƒ½å¾€å³èµ°
                travelerA.style.left = '30%';  // æ…¢è€…åœ¨å‰
                travelerB.style.left = '5%';   // å¿«è€…åœ¨å
                travelerA.querySelector('.traveler-icon').textContent = 'ğŸš¶';
                travelerB.querySelector('.traveler-icon').textContent = 'ğŸš´';
                travelerA.classList.add('face-right');
                travelerA.classList.remove('face-left');
                travelerB.classList.add('face-right');
                travelerB.classList.remove('face-left');
                travelerB.style.display = 'flex';
                locationA.querySelector('.location-name').textContent = 'èµ·ç‚¹';
                locationB.querySelector('.location-name').textContent = 'ç»ˆç‚¹';
            } else {
                // è¡Œèˆ¹ï¼šèˆ¹ä»å·¦å¾€å³èµ°
                travelerA.style.left = '5%';
                travelerA.querySelector('.traveler-icon').textContent = 'ğŸš¤';
                travelerA.classList.add('face-right');
                travelerA.classList.remove('face-left');
                travelerB.style.display = 'none';
                locationA.querySelector('.location-name').textContent = 'èµ·ç‚¹';
                locationB.querySelector('.location-name').textContent = 'ç»ˆç‚¹';
                locationA.querySelector('.location-icon').textContent = 'âš“';
                locationB.querySelector('.location-icon').textContent = 'ğŸ';
            }
        }
        
        function generateProblemText() {
            let text = '';
            if (currentType === 'meet') {
                const distance = document.getElementById('distance').value;
                const speedA = document.getElementById('speedA').value;
                const speedB = document.getElementById('speedB').value;
                text = `ç”²ä¹™ä¸¤äººåˆ†åˆ«ä»ç›¸è· <span class="question">${distance}</span> åƒç±³çš„Aã€Bä¸¤åœ°åŒæ—¶å‡ºå‘ï¼Œç›¸å‘è€Œè¡Œã€‚ç”²çš„é€Ÿåº¦æ˜¯ <span class="question">${speedA}</span> åƒç±³/æ—¶ï¼Œä¹™çš„é€Ÿåº¦æ˜¯ <span class="question">${speedB}</span> åƒç±³/æ—¶ã€‚<br>é—®ï¼šå‡ å°æ—¶åä¸¤äººç›¸é‡ï¼Ÿç›¸é‡æ—¶ç”²èµ°äº†å¤šå°‘åƒç±³ï¼Ÿ`;
            } else if (currentType === 'chase') {
                const distance = document.getElementById('distance').value;
                const speedA = document.getElementById('speedA').value;
                const speedB = document.getElementById('speedB').value;
                text = `ç”²ä¹™ä¸¤äººåŒå‘è€Œè¡Œï¼Œç”²åœ¨å‰ä¹™åœ¨åï¼Œç›¸è· <span class="question">${distance}</span> åƒç±³ã€‚ä¹™çš„é€Ÿåº¦æ˜¯ <span class="question">${speedA}</span> åƒç±³/æ—¶ï¼Œç”²çš„é€Ÿåº¦æ˜¯ <span class="question">${speedB}</span> åƒç±³/æ—¶ã€‚<br>é—®ï¼šä¹™å‡ å°æ—¶åèƒ½è¿½ä¸Šç”²ï¼Ÿè¿½ä¸Šæ—¶ä¹™èµ°äº†å¤šå°‘åƒç±³ï¼Ÿ`;
            } else if (currentType === 'lap') {
                const perimeter = document.getElementById('perimeter').value;
                const speedA = document.getElementById('speedA').value;
                const speedB = document.getElementById('speedB').value;
                const totalTime = document.getElementById('totalTime').value;
                text = `ç”²ä¹™ä¸¤äººåœ¨å‘¨é•¿ <span class="question">${perimeter}</span> ç±³çš„ç¯å½¢è·‘é“ä¸ŠåŒæ—¶åŒåœ°åŒå‘è·‘æ­¥ã€‚ç”²çš„é€Ÿåº¦æ˜¯ <span class="question">${speedA}</span> ç±³/åˆ†ï¼Œä¹™çš„é€Ÿåº¦æ˜¯ <span class="question">${speedB}</span> ç±³/åˆ†ã€‚<br>é—®ï¼šç”²ç¬¬ä¸€æ¬¡å¥—ä¹™åœˆéœ€è¦å¤šå°‘åˆ†é’Ÿï¼Ÿ${totalTime} åˆ†é’Ÿå†…ç”²èƒ½å¥—ä¹™å‡ åœˆï¼Ÿ`;
            } else if (currentType === 'river_down') {
                const distance = document.getElementById('distance').value;
                const boatSpeed = document.getElementById('boatSpeed').value;
                const waterSpeed = document.getElementById('waterSpeed').value;
                text = `ä¸€è‰˜èˆ¹åœ¨é™æ°´ä¸­çš„é€Ÿåº¦æ˜¯ <span class="question">${boatSpeed}</span> åƒç±³/æ—¶ï¼Œæ°´æµé€Ÿåº¦æ˜¯ <span class="question">${waterSpeed}</span> åƒç±³/æ—¶ã€‚èˆ¹é¡ºæµèˆªè¡Œ <span class="question">${distance}</span> åƒç±³ã€‚<br>é—®ï¼šéœ€è¦å‡ å°æ—¶ï¼Ÿå®é™…é€Ÿåº¦æ˜¯å¤šå°‘ï¼Ÿ`;
            } else {
                const distance = document.getElementById('distance').value;
                const boatSpeed = document.getElementById('boatSpeed').value;
                const waterSpeed = document.getElementById('waterSpeed').value;
                text = `ä¸€è‰˜èˆ¹åœ¨é™æ°´ä¸­çš„é€Ÿåº¦æ˜¯ <span class="question">${boatSpeed}</span> åƒç±³/æ—¶ï¼Œæ°´æµé€Ÿåº¦æ˜¯ <span class="question">${waterSpeed}</span> åƒç±³/æ—¶ã€‚èˆ¹é€†æµèˆªè¡Œ <span class="question">${distance}</span> åƒç±³ã€‚<br>é—®ï¼šéœ€è¦å‡ å°æ—¶ï¼Ÿå®é™…é€Ÿåº¦æ˜¯å¤šå°‘ï¼Ÿ`;
            }
            return text;
        }
        
        function updateVisualization(time, place, animateProgress = 0) {
            document.getElementById('timeAnswer').textContent = time !== null ? fmt(time) : '?';
            document.getElementById('placeAnswer').textContent = place !== null ? fmt(place) : '?';
            
            if (animateProgress > 0) {
                if (currentType === 'lap') {
                    // ç¯å½¢è·‘é“åŠ¨ç”» - è®©è·‘æ­¥è€…ç»•åœˆç§»åŠ¨
                    const runnerA = document.getElementById('runnerA');
                    const runnerB = document.getElementById('runnerB');
                    if (runnerA && runnerB) {
                        // ç®€å•çš„ä½ç½®å˜åŒ–è¡¨ç¤ºå¥—åœˆ
                        const angle = animateProgress * 360;
                        const radius = 140;
                        const centerX = 175;
                        const centerY = 65;
                        
                        // å¿«è€…è·‘å¾—æ›´è¿œ
                        const angleA = angle * 1.5;
                        const angleB = angle;
                        
                        const radA = (angleA - 90) * Math.PI / 180;
                        const radB = (angleB - 90) * Math.PI / 180;
                        
                        runnerA.style.left = (centerX + radius * Math.cos(radA)) + 'px';
                        runnerA.style.top = (centerY + 50 * Math.sin(radA)) + 'px';
                        
                        runnerB.style.left = (centerX + radius * Math.cos(radB)) + 'px';
                        runnerB.style.top = (centerY + 50 * Math.sin(radB)) + 'px';
                    }
                } else if (result.distance) {
                    const travelerA = document.getElementById('travelerA');
                    const travelerB = document.getElementById('travelerB');
                    
                    if (currentType === 'meet') {
                        const meetPoint = 5 + (result.placeA / result.distance) * 90 * animateProgress;
                        travelerA.style.left = (5 + (meetPoint - 5) * animateProgress) + '%';
                        travelerB.style.left = (95 - (95 - meetPoint) * animateProgress) + '%';
                    } else if (currentType === 'chase') {
                        travelerA.style.left = (30 + 30 * animateProgress) + '%';
                        travelerB.style.left = (5 + 55 * animateProgress) + '%';
                    } else {
                        travelerA.style.left = (5 + 90 * animateProgress) + '%';
                    }
                }
            }
        }
        
        function createStep(text, stepNum, time, place, progress) {
            const step = document.createElement('div');
            step.className = 'step';
            step.innerHTML = `
                <div class="step-header">
                    <div class="step-number">${stepNum + 1}</div>
                    <div class="step-title">${text.replace(/(\d+\.?\d*)/g, '<span class="highlight">$1</span>')}</div>
                </div>
            `;
            step.dataset.time = time;
            step.dataset.place = place;
            step.dataset.progress = progress;
            return step;
        }
        
        // æ ¼å¼åŒ–æ•°å­—ï¼šå¦‚æœæ˜¯å°æ•°åˆ™ä¿ç•™1ä½ï¼Œæ•´æ•°åˆ™ä¸å˜
        function fmt(num) {
            if (num === null || num === undefined) return '?';
            if (Number.isInteger(num)) return num;
            return parseFloat(num.toFixed(1));
        }
        
        function generateSteps() {
            const steps = [];
            
            if (currentType === 'meet') {
                const distance = parseInt(document.getElementById('distance').value);
                const speedA = parseInt(document.getElementById('speedA').value);
                const speedB = parseInt(document.getElementById('speedB').value);
                
                if (!distance || !speedA || !speedB) {
                    alert('è¯·è¾“å…¥æ­£ç¡®çš„æ•°å€¼');
                    return null;
                }
                
                const sumSpeed = speedA + speedB;
                const time = distance / sumSpeed;
                const placeA = speedA * time;
                
                result = { distance, speedA, speedB, time, placeA };
                
                document.getElementById('distanceLabel').textContent = distance + ' åƒç±³';
                document.getElementById('speedLabelA').textContent = speedA + 'km/h';
                document.getElementById('speedLabelB').textContent = speedB + 'km/h';
                document.querySelectorAll('.answer-card')[1].querySelector('.answer-unit').textContent = 'åƒç±³';
                
                steps.push(
                    [`é¢˜ç›®åˆ†æï¼šç”²ä¹™ç›¸å‘è€Œè¡Œï¼Œæ€»è·ç¦» ${distance} åƒç±³`, null, null, 0],
                    [`æ ¸å¿ƒæ€æƒ³ï¼šç›¸é‡é—®é¢˜ç”¨é€Ÿåº¦å’Œï¼Œä¸¤äººå…±åŒ"æ¶ˆç­"è¿™æ®µè·ç¦»`, null, null, 0],
                    [`é€Ÿåº¦å’Œï¼šç”² ${speedA} + ä¹™ ${speedB} = ${sumSpeed} åƒç±³/æ—¶`, null, null, 0],
                    [`ç›¸é‡æ—¶é—´ï¼šæ€»è·ç¦» Ã· é€Ÿåº¦å’Œ = ${distance} Ã· ${sumSpeed} = ${fmt(time)} å°æ—¶`, fmt(time), null, 0.5],
                    [`ç”²èµ°çš„è·¯ç¨‹ï¼šç”²é€Ÿåº¦ Ã— æ—¶é—´ = ${speedA} Ã— ${fmt(time)} = ${fmt(placeA)} åƒç±³`, fmt(time), fmt(placeA), 1],
                    [`éªŒè¯ï¼šç”²èµ° ${fmt(placeA)} åƒç±³ + ä¹™èµ° ${fmt(speedB * time)} åƒç±³ = ${fmt(placeA + speedB * time)} åƒç±³ = æ€»è·ç¦» ${distance} åƒç±³ âœ“`, fmt(time), fmt(placeA), 1]
                );
                
            } else if (currentType === 'chase') {
                const distance = parseInt(document.getElementById('distance').value);
                const speedA = parseInt(document.getElementById('speedA').value);
                const speedB = parseInt(document.getElementById('speedB').value);
                
                if (!distance || !speedA || !speedB || speedA <= speedB) {
                    alert('è¯·è¾“å…¥æ­£ç¡®çš„æ•°å€¼ï¼šå¿«è€…é€Ÿåº¦å¿…é¡»å¤§äºæ…¢è€…');
                    return null;
                }
                
                const diffSpeed = speedA - speedB;
                const time = distance / diffSpeed;
                const placeA = speedA * time;
                
                result = { distance, speedA, speedB, time, placeA };
                
                document.getElementById('distanceLabel').textContent = distance + ' åƒç±³';
                document.getElementById('speedLabelA').textContent = speedB + 'km/h';
                document.getElementById('speedLabelB').textContent = speedA + 'km/h';
                document.querySelectorAll('.answer-card')[1].querySelector('.answer-unit').textContent = 'åƒç±³';
                
                steps.push(
                    [`é¢˜ç›®åˆ†æï¼šä¹™è¿½ç”²ï¼Œç›¸è· ${distance} åƒç±³ï¼Œä¹™æ¯”ç”²å¿«`, null, null, 0],
                    [`æ ¸å¿ƒæ€æƒ³ï¼šè¿½åŠé—®é¢˜ç”¨é€Ÿåº¦å·®ï¼Œæ¯å°æ—¶ä¹™æ¯”ç”²å¤šèµ°ä¸€ç‚¹`, null, null, 0],
                    [`é€Ÿåº¦å·®ï¼šä¹™ ${speedA} - ç”² ${speedB} = ${diffSpeed} åƒç±³/æ—¶`, null, null, 0],
                    [`è¿½ä¸Šæ—¶é—´ï¼šç›¸è·è·ç¦» Ã· é€Ÿåº¦å·® = ${distance} Ã· ${diffSpeed} = ${fmt(time)} å°æ—¶`, fmt(time), null, 0.5],
                    [`ä¹™èµ°çš„è·¯ç¨‹ï¼šä¹™é€Ÿåº¦ Ã— æ—¶é—´ = ${speedA} Ã— ${fmt(time)} = ${fmt(placeA)} åƒç±³`, fmt(time), fmt(placeA), 1],
                    [`éªŒè¯ï¼šä¹™èµ° ${fmt(placeA)} åƒç±³ - ç”²èµ° ${fmt(speedB * time)} åƒç±³ = ${fmt(placeA - speedB * time)} åƒç±³ = åŸç›¸è· ${distance} åƒç±³ âœ“`, fmt(time), fmt(placeA), 1]
                );
                
            } else if (currentType === 'lap') {
                const perimeter = parseInt(document.getElementById('perimeter').value);
                const speedA = parseInt(document.getElementById('speedA').value);
                const speedB = parseInt(document.getElementById('speedB').value);
                const totalTime = parseInt(document.getElementById('totalTime').value);
                
                if (!perimeter || !speedA || !speedB || !totalTime || speedA <= speedB) {
                    alert('è¯·è¾“å…¥æ­£ç¡®çš„æ•°å€¼ï¼šå¿«è€…é€Ÿåº¦å¿…é¡»å¤§äºæ…¢è€…');
                    return null;
                }
                
                const diffSpeed = speedA - speedB;
                const lapTime = perimeter / diffSpeed;
                const lapCount = Math.floor(totalTime / lapTime);
                
                result = { perimeter, speedA, speedB, totalTime, diffSpeed, lapTime, lapCount };
                
                // æ›´æ–°è·‘é“æ ‡ç­¾
                const trackLabel = document.getElementById('trackLabel');
                if (trackLabel) trackLabel.textContent = 'å‘¨é•¿ ' + perimeter + ' ç±³';
                
                document.querySelectorAll('.answer-card')[0].querySelector('.answer-unit').textContent = 'åˆ†é’Ÿ';
                document.querySelectorAll('.answer-card')[1].querySelector('.answer-unit').textContent = 'åœˆ';
                
                steps.push(
                    [`é¢˜ç›®åˆ†æï¼šç”²ä¹™åŒå‘è·‘æ­¥ï¼Œè·‘é“å‘¨é•¿ ${perimeter} ç±³`, null, null, 0],
                    [`æ ¸å¿ƒæ€æƒ³ï¼šå¥—åœˆ = è¿½ä¸Šä¸€æ•´åœˆï¼Œæœ¬è´¨è¿˜æ˜¯è¿½åŠé—®é¢˜`, null, null, 0],
                    [`é€Ÿåº¦å·®ï¼šç”² ${speedA} - ä¹™ ${speedB} = ${diffSpeed} ç±³/åˆ†`, null, null, 0],
                    [`å¥—ä¸€åœˆæ—¶é—´ï¼šå‘¨é•¿ Ã· é€Ÿåº¦å·® = ${perimeter} Ã· ${diffSpeed} = ${fmt(lapTime)} åˆ†é’Ÿ`, fmt(lapTime), null, 0.5],
                    [`${totalTime} åˆ†é’Ÿå¥—åœˆæ¬¡æ•°ï¼š${totalTime} Ã· ${fmt(lapTime)} = ${fmt(totalTime / lapTime)}ï¼Œå–æ•´æ•° = ${lapCount} åœˆ`, fmt(lapTime), lapCount, 1],
                    [`éªŒè¯ï¼š${lapCount} åœˆ Ã— ${fmt(lapTime)} åˆ†é’Ÿ = ${fmt(lapCount * lapTime)} åˆ†é’Ÿ â‰¤ ${totalTime} åˆ†é’Ÿ âœ“`, fmt(lapTime), lapCount, 1]
                );
                
            } else if (currentType === 'river_down') {
                const distance = parseInt(document.getElementById('distance').value);
                const boatSpeed = parseInt(document.getElementById('boatSpeed').value);
                const waterSpeed = parseInt(document.getElementById('waterSpeed').value);
                
                if (!distance || !boatSpeed || !waterSpeed) {
                    alert('è¯·è¾“å…¥æ­£ç¡®çš„æ•°å€¼');
                    return null;
                }
                
                const actualSpeed = boatSpeed + waterSpeed;
                const time = distance / actualSpeed;
                
                result = { distance, boatSpeed, waterSpeed, time, actualSpeed };
                
                document.getElementById('distanceLabel').textContent = distance + ' åƒç±³';
                document.getElementById('speedLabelA').textContent = boatSpeed + '+' + waterSpeed;
                document.querySelectorAll('.answer-card')[1].querySelector('.answer-unit').textContent = 'åƒç±³/æ—¶';
                
                steps.push(
                    [`é¢˜ç›®åˆ†æï¼šèˆ¹é¡ºæµè€Œä¸‹ï¼Œæ°´æµå¸®åŠ©èˆ¹å‰è¿›`, null, null, 0],
                    [`æ ¸å¿ƒæ€æƒ³ï¼šé¡ºæ°´é€Ÿåº¦ = èˆ¹é€Ÿ + æ°´é€Ÿï¼ˆæ°´æµåŠ©åŠ›ï¼‰`, null, null, 0],
                    [`å®é™…é€Ÿåº¦ï¼šèˆ¹é€Ÿ ${boatSpeed} + æ°´é€Ÿ ${waterSpeed} = ${actualSpeed} åƒç±³/æ—¶`, null, actualSpeed, 0],
                    [`èˆªè¡Œæ—¶é—´ï¼šè·ç¦» Ã· å®é™…é€Ÿåº¦ = ${distance} Ã· ${actualSpeed} = ${fmt(time)} å°æ—¶`, fmt(time), actualSpeed, 1],
                    [`éªŒè¯ï¼š${actualSpeed} åƒç±³/æ—¶ Ã— ${fmt(time)} å°æ—¶ = ${fmt(actualSpeed * time)} åƒç±³ = èˆªè¡Œè·ç¦» ${distance} åƒç±³ âœ“`, fmt(time), actualSpeed, 1]
                );
                
            } else {
                const distance = parseInt(document.getElementById('distance').value);
                const boatSpeed = parseInt(document.getElementById('boatSpeed').value);
                const waterSpeed = parseInt(document.getElementById('waterSpeed').value);
                
                if (!distance || !boatSpeed || !waterSpeed || boatSpeed <= waterSpeed) {
                    alert('è¯·è¾“å…¥æ­£ç¡®çš„æ•°å€¼ï¼šèˆ¹é€Ÿå¿…é¡»å¤§äºæ°´é€Ÿï¼Œå¦åˆ™æ— æ³•å‰è¿›');
                    return null;
                }
                
                const actualSpeed = boatSpeed - waterSpeed;
                const time = distance / actualSpeed;
                
                result = { distance, boatSpeed, waterSpeed, time, actualSpeed };
                
                document.getElementById('distanceLabel').textContent = distance + ' åƒç±³';
                document.getElementById('speedLabelA').textContent = boatSpeed + '-' + waterSpeed;
                document.querySelectorAll('.answer-card')[1].querySelector('.answer-unit').textContent = 'åƒç±³/æ—¶';
                
                steps.push(
                    [`é¢˜ç›®åˆ†æï¼šèˆ¹é€†æµè€Œä¸Šï¼Œæ°´æµé˜»ç¢èˆ¹å‰è¿›`, null, null, 0],
                    [`æ ¸å¿ƒæ€æƒ³ï¼šé€†æ°´é€Ÿåº¦ = èˆ¹é€Ÿ - æ°´é€Ÿï¼ˆæ°´æµé˜»åŠ›ï¼‰`, null, null, 0],
                    [`å®é™…é€Ÿåº¦ï¼šèˆ¹é€Ÿ ${boatSpeed} - æ°´é€Ÿ ${waterSpeed} = ${actualSpeed} åƒç±³/æ—¶`, null, actualSpeed, 0],
                    [`èˆªè¡Œæ—¶é—´ï¼šè·ç¦» Ã· å®é™…é€Ÿåº¦ = ${distance} Ã· ${actualSpeed} = ${fmt(time)} å°æ—¶`, fmt(time), actualSpeed, 1],
                    [`éªŒè¯ï¼š${actualSpeed} åƒç±³/æ—¶ Ã— ${fmt(time)} å°æ—¶ = ${fmt(actualSpeed * time)} åƒç±³ = èˆªè¡Œè·ç¦» ${distance} åƒç±³ âœ“`, fmt(time), actualSpeed, 1]
                );
            }
            
            return steps;
        }
        
        function updateStepVisibility() {
            stepsData.forEach((step, index) => {
                step.classList.toggle('visible', index <= maxReachedStep);
                step.classList.toggle('active', index === currentStep);
            });
        }
        
        function showStep(stepIndex) {
            currentStep = stepIndex;
            if (stepIndex > maxReachedStep) {
                maxReachedStep = stepIndex;
            }
            
            document.getElementById('step-counter').textContent = stepIndex + 1;
            document.getElementById('prevBtn').disabled = stepIndex <= 0;
            document.getElementById('nextBtn').disabled = stepIndex >= stepsData.length - 1;
            
            updateStepVisibility();
            
            const currentData = stepsData[stepIndex].dataset;
            updateVisualization(
                currentData.time !== 'null' ? parseFloat(currentData.time) : null,
                currentData.place !== 'null' ? parseFloat(currentData.place) : null,
                parseFloat(currentData.progress)
            );
        }
        
        function nextStep() { 
            if(currentStep < stepsData.length - 1) showStep(currentStep + 1); 
        }
        
        function prevStep() { 
            if(currentStep > 0) showStep(currentStep - 1); 
        }
        
        function showAllSteps() {
            if (stepsData.length === 0) {
                startCalculation();
            }
            if (stepsData.length > 0) {
                maxReachedStep = stepsData.length - 1;
                showStep(stepsData.length - 1);
            }
        }
        
        function startCalculation() {
            const steps = generateSteps();
            if (!steps) return;
            
            updateTravelVisual();
            document.getElementById('problemText').innerHTML = `<i class="fas fa-book"></i> ${generateProblemText()}`;
            
            const stepContainer = document.getElementById('steps');
            stepContainer.innerHTML = '';
            stepsData = [];
            maxReachedStep = 0;
            
            steps.forEach(([text, time, place, progress], index) => {
                const step = createStep(text, index, time, place, progress);
                stepsData.push(step);
                stepContainer.appendChild(step);
            });
            
            document.getElementById('total-steps').textContent = stepsData.length;
            currentStep = 0;
            showStep(currentStep);
        }
        
        window.onload = function() {
            renderInputs();
            resetVisualization();
        };
    </script>
    <a href="../../index.html" style="display:block;text-align:center;margin:30px auto;color:#667eea;text-decoration:none;font-size:14px;">â† è¿”å›çš®å¡ä¸˜å­¦ä¹ èµ„æº</a>
</body>
</html>

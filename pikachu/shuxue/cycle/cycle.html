<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />    
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="Expires" content="0">
    <link rel="Shortcut Icon" href="https://cdn.bihe0832.com/images/zixie_32.ico" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="author" CONTENT="å­å‹°(bihe0832), code@bihe0832.com" />
    <meta name="keywords" content="å­å‹°,bihe0832,å·¥å…·å’©" />
    <meta name="description" content="çš®å¡ä¸˜å­¦æ•°å­¦ä¹‹å‘¨æœŸé—®é¢˜åˆ†æ­¥è§£ç­”" />
    <meta property="og:title" content="çš®å¡ä¸˜å­¦æ•°å­¦ä¹‹å‘¨æœŸé—®é¢˜åˆ†æ­¥è§£ç­”" />
    <meta property="og:locale" content="en_US" />
    <title>çš®å¡ä¸˜å­¦æ•°å­¦ - å‘¨æœŸé—®é¢˜</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #9b59b6, #3498db);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 1400px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            margin: 20px 0;
            padding: 20px;
        }
        header {
            background: linear-gradient(90deg, #9b59b6, #8e44ad);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        header h2 {
            font-size: 2rem;
            margin: 10px 0;
            text-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }
        header p {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.6;
        }
        
        .main-content {
            display: flex;
            gap: 20px;
            height: 660px;
            overflow: hidden;
        }
        
        .left-panel {
            width: 320px;
            flex-shrink: 0;
            background: #f5f0ff;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .panel-title {
            font-size: 1.1rem;
            color: #8e44ad;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 3px solid #9b59b6;
            display: flex;
            align-items: center;
        }
        .panel-title i {
            margin-right: 10px;
            font-size: 1.2rem;
            color: #9b59b6;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        .input-item {
            margin-bottom: 12px;
        }
        .input-label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #8e44ad;
            font-size: 0.95rem;
        }
        input, select, textarea {
            padding: 12px 15px;
            width: 100%;
            border: 2px solid #9b59b6;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #8e44ad;
            box-shadow: 0 0 10px rgba(155, 89, 182, 0.3);
        }
        textarea {
            resize: none;
            height: 60px;
        }
        
        .start-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
            margin-top: auto;
        }
        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }
        
        /* ä¸­é—´å¯è§†åŒ–åŒºåŸŸ */
        .center-panel {
            flex: 1;
            min-width: 400px;
            background: #faf8ff;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }
        
        .problem-display {
            text-align: left;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            font-size: 1rem;
            line-height: 1.6;
            flex-shrink: 0;
        }
        
        .problem-display .highlight {
            background: #f1c40f;
            color: #333;
            padding: 2px 8px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        /* å‘¨æœŸå¯è§†åŒ– */
        .cycle-visualization {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 15px;
            overflow-y: auto;
            min-height: 0;
        }
        
        .cycle-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            justify-content: flex-start;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(155, 89, 182, 0.1);
            border-radius: 12px;
            max-width: 100%;
            flex: 1;
            overflow-y: auto;
        }
        
        .cycle-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 10px;
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .cycle-row.highlight-row {
            background: rgba(155, 89, 182, 0.2);
            box-shadow: 0 0 10px rgba(155, 89, 182, 0.4);
        }
        
        .group-label {
            min-width: 45px;
            font-size: 11px;
            color: #8e44ad;
            font-weight: bold;
        }
        
        .cycle-row-items {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .cycle-item {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: white;
            position: relative;
            transition: all 0.3s;
        }
        
        .cycle-item .item-text {
            line-height: 32px;
        }
        
        .cycle-item .item-index {
            position: absolute;
            bottom: -14px;
            font-size: 9px;
            color: #666;
            background: rgba(255,255,255,0.8);
            padding: 0 3px;
            border-radius: 3px;
        }
        
        .cycle-item.highlight-item {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(0,0,0,0.4);
            z-index: 10;
        }
        
        .cycle-group {
            display: flex;
            gap: 5px;
            padding: 8px;
            border: 2px dashed #9b59b6;
            border-radius: 10px;
            margin: 5px;
            background: rgba(255,255,255,0.5);
        }
        
        .cycle-group-label {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: #9b59b6;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
        }
        
        .answer-cards {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
            flex-shrink: 0;
        }
        
        .answer-card {
            background: white;
            border-radius: 10px;
            padding: 8px 12px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 2px solid #9b59b6;
            min-width: 70px;
        }
        
        .answer-card .answer-icon {
            font-size: 1.1rem;
            margin-bottom: 2px;
        }
        
        .answer-card .answer-label {
            color: #666;
            font-size: 0.7rem;
            margin-bottom: 2px;
        }
        
        .answer-card .answer-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #9b59b6;
        }
        
        /* å³ä¾§æ­¥éª¤é¢æ¿ */
        .right-panel {
            width: 380px;
            flex-shrink: 0;
            background: #f5f0ff;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .steps-container {
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            padding: 15px;
            background: linear-gradient(to right, #f5f0ff, #ebe0ff);
            border-radius: 12px;
        }
        
        .steps-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .steps-container::-webkit-scrollbar-track {
            background: #e8e0f0;
            border-radius: 3px;
        }
        
        .steps-container::-webkit-scrollbar-thumb {
            background: #9b59b6;
            border-radius: 3px;
        }
        
        .step-item {
            padding: 10px 0;
            margin-bottom: 0;
            border-left: none;
            border-bottom: 1px dashed rgba(155, 89, 182, 0.3);
            display: none;
            transition: all 0.3s;
            background: transparent;
            border-radius: 0;
        }
        
        .step-item:last-child {
            border-bottom: none;
        }
        
        .step-item.visible {
            display: block;
            animation: fadeInStep 0.4s ease;
        }
        
        @keyframes fadeInStep {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .step-item.active {
            animation: breathePurple 1.5s ease-in-out infinite;
        }
        
        @keyframes breathePurple {
            0%, 100% { background-color: rgba(155, 89, 182, 0.1); }
            50% { background-color: rgba(155, 89, 182, 0.25); }
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: #9b59b6;
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 12px;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .step-title {
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        
        .step-content {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #2c3e50;
        }
        
        .highlight {
            color: #e74c3c;
            font-weight: bold;
            background-color: #ffecb3;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            width: 100%;
        }
        
        .nav-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .nav-btn.prev {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            color: white;
        }
        
        .nav-btn.next {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* å…¬å¼å¡ç‰‡ */
        .formula-card {
            padding: 0 12px 12px 12px;
            margin-bottom: 15px;
            flex-shrink: 0;
        }
        
        .formula-card .formula {
            font-size: 0.9rem;
            color: #8e44ad;
            margin: 8px 0;
        }
        
        /* é¢„è®¾é¢˜ç›® */
        .preset-group {
            margin-bottom: 15px;
        }
        
        .preset-btn {
            width: 100%;
            padding: 10px;
            margin-bottom: 8px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .preset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        /* ä¸€é”®æŸ¥çœ‹æŒ‰é’® */
        .show-all-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(155, 89, 182, 0.3);
            margin-top: 10px;
        }
        .show-all-btn:hover {
            transform: translateY(-2px);
            background: linear-gradient(45deg, #8e44ad, #9b59b6);
        }
        
        /* å“åº”å¼ */
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
                height: auto;
            }
            .left-panel, .right-panel {
                width: 100%;
            }
            .center-panel {
                min-width: auto;
                min-height: 350px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h2>âš¡ çš®å¡ä¸˜å­¦æ•°å­¦ - å‘¨æœŸé—®é¢˜ ğŸ”„</h2>
            <p>æ‰¾è§„å¾‹ï¼Œç®—å‘¨æœŸï¼Œæ±‚ä½™æ•°å®šä½ç½®<br>
            æŒæ¡"é™¤æ³•å–ä½™"çš„æ ¸å¿ƒæ€æƒ³</p>
        </header>
        
        <div class="main-content">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="left-panel">
                <div class="panel-title">
                    <i class="fas fa-cog"></i> é¢˜ç›®è®¾ç½®
                </div>
                
                <div class="preset-group">
                    <button class="preset-btn" onclick="loadPreset(1)">
                        ğŸ¨ å½©æ——é—®é¢˜ï¼šçº¢é»„è“ç»¿å¾ªç¯
                    </button>
                    <button class="preset-btn" onclick="loadPreset(2)">
                        ğŸ’¡ å½©ç¯é—®é¢˜ï¼šçº¢çº¢é»„é»„ç»¿å¾ªç¯
                    </button>
                    <button class="preset-btn" onclick="loadPreset(3)">
                        ğŸ“… æ˜ŸæœŸé—®é¢˜ï¼šä»Šå¤©å‘¨ä¸€ï¼Œ100å¤©å
                    </button>
                </div>
                
                <div class="input-group">
                    <div class="input-item">
                        <label class="input-label">ğŸ” å¾ªç¯åºåˆ—ï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼‰</label>
                        <textarea id="cyclePattern" placeholder="ä¾‹å¦‚ï¼šçº¢ é»„ è“ ç»¿">çº¢ é»„ è“ ç»¿</textarea>
                    </div>
                    <div class="input-item">
                        <label class="input-label">ğŸ¯ æ±‚ç¬¬å‡ ä¸ªä½ç½®</label>
                        <input type="number" id="targetPosition" value="23" min="1" max="1000" placeholder="ä½ç½®">
                    </div>
                </div>
                
                <div class="nav-buttons">
                    <button class="nav-btn prev" onclick="prevStep()" id="prevBtn" disabled>
                        <i class="fas fa-arrow-left"></i> ä¸Šä¸€æ­¥
                    </button>
                    <button class="nav-btn next" onclick="nextStep()" id="nextBtn">
                        ä¸‹ä¸€æ­¥ <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                    <button class="show-all-btn" onclick="showAllSteps()">
                    <i class="fas fa-eye"></i> ä¸€é”®æŸ¥çœ‹
                </button>
            </div>
            
            <!-- ä¸­é—´å¯è§†åŒ–åŒºåŸŸ -->
            <div class="center-panel">
                <div class="panel-title">
                    <i class="fas fa-question-circle"></i> é¢˜ç›®
                </div>
                <div class="problem-display" id="problemDisplay">
                    æŒ‰ <span class="highlight">çº¢ã€é»„ã€è“ã€ç»¿</span> çš„é¡ºåºå¾ªç¯æ’åˆ—ï¼Œ<br>
                    ç¬¬ <span class="highlight">23</span> ä¸ªæ˜¯ä»€ä¹ˆé¢œè‰²ï¼Ÿ
                </div>
                
                <div class="panel-title">
                    <i class="fas fa-eye"></i> å¯è§†åŒ–æ¼”ç¤º
                </div>
                
                <div class="cycle-visualization">
                    <div class="cycle-container" id="cycleContainer">
                        <!-- å‘¨æœŸå¯è§†åŒ– -->
                    </div>
                </div>
                
                <div class="answer-cards">
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ”</div>
                        <div class="answer-label">å‘¨æœŸé•¿åº¦</div>
                        <div class="answer-value" id="answerCycleLen">4</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ¯</div>
                        <div class="answer-label">ç›®æ ‡ä½ç½®</div>
                        <div class="answer-value" id="answerTarget">23</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">ğŸ“Š</div>
                        <div class="answer-label">åˆ†æˆå‡ ç»„</div>
                        <div class="answer-value" id="answerQuotient">?</div>
                    </div>
                    <div class="answer-card">
                        <div class="answer-icon">âœ¨</div>
                        <div class="answer-label">ç­”æ¡ˆ</div>
                        <div class="answer-value" id="answerResult">?</div>
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§æ­¥éª¤é¢æ¿ -->
            <div class="right-panel">
                <div class="panel-title">
                    <i class="fas fa-calculator"></i> æ ¸å¿ƒå…¬å¼
                </div>
                <div class="formula-card">
                    <div class="formula">â€¢ æ‰¾å‡ºå‘¨æœŸï¼ˆä¸€ç»„æœ‰å‡ ä¸ªï¼‰</div>
                    <div class="formula">â€¢ åˆ†ç»„æ’åˆ—ï¼ˆæ¯ç»„ä¸€è¡Œï¼‰</div>
                    <div class="formula">â€¢ æ•°åˆ°ç›®æ ‡ä½ç½®</div>
                </div>
                
                <div class="panel-title">
                    <i class="fas fa-shoe-prints"></i> è§£é¢˜æ­¥éª¤
                </div>
                
                <div class="steps-container" id="stepsContainer">
                    <div class="step-item">
                        <span class="step-number">1</span>
                        <span class="step-content">ğŸ‘† ç‚¹å‡»ä¸‹ä¸€æ­¥å¼€å§‹è§£ç­”</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let stepsData = [];
        let currentStep = 0;
        let maxReachedStep = 0;
        let animationTimer = null;
        
        // é¢œè‰²æ˜ å°„
        const colorMap = {
            'çº¢': '#e74c3c',
            'é»„': '#f1c40f',
            'è“': '#3498db',
            'ç»¿': '#27ae60',
            'ç´«': '#9b59b6',
            'æ©™': '#e67e22',
            'ç²‰': '#ff69b4',
            'ç™½': '#ecf0f1',
            'é»‘': '#2c3e50',
            'ä¸€': '#e74c3c',
            'äºŒ': '#f39c12',
            'ä¸‰': '#f1c40f',
            'å››': '#27ae60',
            'äº”': '#3498db',
            'å…­': '#9b59b6',
            'æ—¥': '#e67e22'
        };
        
        // é¢„è®¾é¢˜ç›®
        function loadPreset(type) {
            if (type === 1) {
                document.getElementById('cyclePattern').value = 'çº¢ é»„ è“ ç»¿';
                document.getElementById('targetPosition').value = '23';
            } else if (type === 2) {
                document.getElementById('cyclePattern').value = 'çº¢ çº¢ é»„ é»„ ç»¿';
                document.getElementById('targetPosition').value = '37';
            } else if (type === 3) {
                document.getElementById('cyclePattern').value = 'ä¸€ äºŒ ä¸‰ å›› äº” å…­ æ—¥';
                document.getElementById('targetPosition').value = '100';
            }
            updateProblemText();
            resetDemo();
        }
        
        // è§£æå‘¨æœŸåºåˆ—
        function parseCyclePattern() {
            const input = document.getElementById('cyclePattern').value.trim();
            if (!input) return [];
            return input.split(/[,ï¼Œã€\s]+/).filter(item => item.length > 0);
        }
        
        // è·å–é¢œè‰²
        function getColor(item, index) {
            if (colorMap[item]) return colorMap[item];
            // é»˜è®¤é¢œè‰²å¾ªç¯
            const defaultColors = ['#e74c3c', '#f39c12', '#f1c40f', '#27ae60', '#3498db', '#9b59b6', '#e67e22', '#1abc9c'];
            return defaultColors[index % defaultColors.length];
        }
        
        // æ›´æ–°é¢˜ç›®æ–‡æœ¬
        function updateProblemText() {
            const pattern = parseCyclePattern();
            const target = parseInt(document.getElementById('targetPosition').value) || 1;
            
            if (pattern.length === 0) {
                document.getElementById('problemDisplay').innerHTML = 'è¯·è¾“å…¥å¾ªç¯åºåˆ—';
                return;
            }
            
            const patternStr = pattern.join('ã€');
            document.getElementById('problemDisplay').innerHTML = 
                `æŒ‰ <span class="highlight">${patternStr}</span> çš„é¡ºåºå¾ªç¯æ’åˆ—ï¼Œ<br>
                ç¬¬ <span class="highlight">${target}</span> ä¸ªæ˜¯ä»€ä¹ˆï¼Ÿ`;
            document.getElementById('answerCycleLen').textContent = pattern.length;
            document.getElementById('answerTarget').textContent = target;
        }
        
        // åˆå§‹åŒ–å¯è§†åŒ–ï¼ˆä¸åˆ†ç»„ï¼Œåˆå§‹çŠ¶æ€ï¼‰
        function initVisualization(pattern, target, showIndex = false) {
            const container = document.getElementById('cycleContainer');
            container.innerHTML = '';
            
            // åªæ˜¾ç¤ºä¸€ä¸ªå‘¨æœŸä½œä¸ºç¤ºä¾‹
            const cycleLen = pattern.length;
            
            for (let i = 0; i < cycleLen; i++) {
                const item = document.createElement('div');
                item.className = 'cycle-item';
                item.style.background = getColor(pattern[i], i);
                item.textContent = pattern[i];
                container.appendChild(item);
            }
        }
        
        // åˆå§‹åŒ–åˆ†ç»„å¯è§†åŒ–ï¼ˆæ¯ä¸ªå‘¨æœŸä¸€è¡Œï¼‰
        function initGroupedVisualization(pattern, target, showIndex = false) {
            const container = document.getElementById('cycleContainer');
            container.innerHTML = '';
            
            const cycleLen = pattern.length;
            const totalGroups = Math.ceil(target / cycleLen);
            
            for (let group = 0; group < totalGroups; group++) {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'cycle-row';
                groupDiv.id = `group-${group}`;
                
                // æ·»åŠ ç»„æ ‡ç­¾
                const groupLabel = document.createElement('span');
                groupLabel.className = 'group-label';
                groupLabel.textContent = `ç¬¬${group + 1}ç»„`;
                groupDiv.appendChild(groupLabel);
                
                const itemsDiv = document.createElement('div');
                itemsDiv.className = 'cycle-row-items';
                
                for (let i = 0; i < cycleLen; i++) {
                    const globalIndex = group * cycleLen + i;
                    if (globalIndex >= target) break; // ä¸è¶…è¿‡ç›®æ ‡ä½ç½®
                    
                    const item = document.createElement('div');
                    item.className = 'cycle-item';
                    item.id = `item-${globalIndex}`;
                    item.style.background = getColor(pattern[i], i);
                    
                    // æ·»åŠ æ–‡å­—
                    const textSpan = document.createElement('span');
                    textSpan.className = 'item-text';
                    textSpan.textContent = pattern[i];
                    item.appendChild(textSpan);
                    
                    // æ·»åŠ åºå·ï¼ˆæ ¹æ®å‚æ•°å†³å®šæ˜¯å¦æ˜¾ç¤ºï¼‰
                    const indexLabel = document.createElement('span');
                    indexLabel.className = 'item-index';
                    indexLabel.textContent = globalIndex + 1;
                    indexLabel.style.display = showIndex ? 'block' : 'none';
                    item.appendChild(indexLabel);
                    
                    itemsDiv.appendChild(item);
                }
                
                groupDiv.appendChild(itemsDiv);
                container.appendChild(groupDiv);
            }
        }
        
        // å¼€å§‹è®¡ç®—
        function startCalculation() {
            const pattern = parseCyclePattern();
            const target = parseInt(document.getElementById('targetPosition').value);
            
            if (pattern.length === 0) {
                alert('è¯·è¾“å…¥å¾ªç¯åºåˆ—');
                return;
            }
            
            if (target < 1 || target > 1000) {
                alert('ä½ç½®è¯·è¾“å…¥1-1000ä¹‹é—´çš„æ•°');
                return;
            }
            
            calculate(pattern, target);
        }
        
        // è®¡ç®—
        function calculate(pattern, target) {
            const cycleLen = pattern.length;
            const quotient = Math.floor(target / cycleLen);
            const remainder = target % cycleLen;
            
            // ç»“æœä½ç½®ï¼ˆä½™æ•°ä¸º0æ—¶å–æœ€åä¸€ä¸ªï¼‰
            const resultIndex = remainder === 0 ? cycleLen - 1 : remainder - 1;
            const result = pattern[resultIndex];
            
            // è®¡ç®—åœ¨ç¬¬å‡ ç»„ç¬¬å‡ ä¸ª
            const groupNum = remainder === 0 ? quotient : quotient + 1;
            const posInGroup = remainder === 0 ? cycleLen : remainder;
            
            // å¼€å§‹æ¼”ç¤ºæ—¶åªæ˜¾ç¤ºä¸€ä¸ªå‘¨æœŸ
            initVisualization(pattern, target);
            
            const steps = [];
            
            steps.push({
                text: `æ‰¾å‡ºå‘¨æœŸï¼šå¾ªç¯åºåˆ— ${pattern.join('ã€')}ï¼Œå‘¨æœŸé•¿åº¦ = <span class="highlight">${cycleLen}</span>`,
                action: 'show_one_cycle'
            });
            
            steps.push({
                text: `åˆ†ç»„æ’åˆ—ï¼šæ¯ <span class="highlight">${cycleLen}</span> ä¸ªåˆ†æˆä¸€ç»„ï¼Œä¸€å…±åˆ†æˆ <span class="highlight">${groupNum}</span> ç»„`,
                action: 'show_all_groups'
            });
            
            steps.push({
                text: `æ‰¾ä½ç½®ï¼šç¬¬ <span class="highlight">${target}</span> ä¸ªåœ¨ç¬¬ <span class="highlight">${groupNum}</span> ç»„çš„ç¬¬ <span class="highlight">${posInGroup}</span> ä¸ªï¼Œæ˜¯ <span class="highlight">${result}</span>`,
                action: 'highlight_result'
            });
            
            steps.push({
                text: `ç»“æœéªŒè¯ï¼šç¬¬ <span class="highlight">${target}</span> ä¸ªæ˜¯ <span class="highlight">${result}</span> âœ“`,
                action: 'show_answer'
            });
            
            displaySteps(steps, { 
                cycleLen: cycleLen, 
                target: target, 
                quotient: quotient, 
                remainder: remainder, 
                result: result,
                pattern: pattern,
                groupNum: groupNum,
                posInGroup: posInGroup
            });
        }
        
        // æ˜¾ç¤ºæ­¥éª¤
        function displaySteps(steps, results) {
            const container = document.getElementById('stepsContainer');
            container.innerHTML = '';
            stepsData = [];
            
            steps.forEach((step, index) => {
                const stepEl = document.createElement('div');
                stepEl.className = 'step-item';
                stepEl.innerHTML = `
                    <div class="step-header">
                        <div class="step-number">${index + 1}</div>
                        <div class="step-title">${step.text}</div>
                    </div>
                `;
                stepEl.dataset.action = step.action || '';
                stepEl.dataset.cycleLen = results.cycleLen;
                stepEl.dataset.target = results.target;
                stepEl.dataset.quotient = results.quotient;
                stepEl.dataset.remainder = results.remainder;
                stepEl.dataset.result = results.result;
                stepEl.dataset.pattern = JSON.stringify(results.pattern);
                stepEl.dataset.groupNum = results.groupNum;
                stepEl.dataset.posInGroup = results.posInGroup;
                container.appendChild(stepEl);
                stepsData.push(stepEl);
            });
            
            currentStep = 0;
            maxReachedStep = 0;
            document.getElementById('answerQuotient').textContent = '?';
            document.getElementById('answerResult').textContent = '?';
            updateStepVisibility();
            updateButtons();
        }
        
        // æ‰§è¡ŒåŠ¨ç”»
        function executeAction(action, data) {
            if (animationTimer) {
                clearTimeout(animationTimer);
            }
            
            const target = parseInt(data.target);
            const cycleLen = parseInt(data.cycleLen);
            const pattern = JSON.parse(data.pattern);
            const groupNum = parseInt(data.groupNum);
            const posInGroup = parseInt(data.posInGroup);
            
            // æ¸…é™¤æ‰€æœ‰é«˜äº®
            document.querySelectorAll('.cycle-item').forEach(item => {
                item.classList.remove('highlight-item');
            });
            document.querySelectorAll('.cycle-row').forEach(row => {
                row.classList.remove('highlight-row');
            });
            
            if (action === 'show_one_cycle') {
                // ç¬¬ä¸€æ­¥ï¼šåªæ˜¾ç¤ºä¸€ä¸ªå‘¨æœŸ
                initVisualization(pattern, target);
            }
            
            if (action === 'show_all_groups') {
                // ç¬¬äºŒæ­¥ï¼šæ˜¾ç¤ºæ‰€æœ‰åˆ†ç»„ï¼Œå¸¦ç¼–å·
                initGroupedVisualization(pattern, target, true);
                document.getElementById('answerQuotient').textContent = groupNum;
            }
            
            if (action === 'highlight_result') {
                // ç¬¬ä¸‰æ­¥ï¼šé«˜äº®ç›®æ ‡ä½ç½®ï¼ˆç¡®ä¿åˆ†ç»„å¯è§†åŒ–å·²åˆå§‹åŒ–ï¼‰
                initGroupedVisualization(pattern, target, true);
                document.getElementById('answerQuotient').textContent = groupNum;
                const targetItem = document.getElementById(`item-${target - 1}`);
                if (targetItem) {
                    targetItem.classList.add('highlight-item');
                    targetItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
            
            if (action === 'show_answer') {
                // ç¬¬å››æ­¥ï¼šæ˜¾ç¤ºç­”æ¡ˆï¼ˆç¡®ä¿åˆ†ç»„å¯è§†åŒ–å·²åˆå§‹åŒ–ï¼‰
                initGroupedVisualization(pattern, target, true);
                document.getElementById('answerQuotient').textContent = groupNum;
                document.getElementById('answerResult').textContent = data.result;
                const targetItem = document.getElementById(`item-${target - 1}`);
                if (targetItem) {
                    targetItem.classList.add('highlight-item');
                }
            }
        }
        
        // æ›´æ–°æ­¥éª¤å¯è§æ€§
        function updateStepVisibility() {
            stepsData.forEach((step, index) => {
                step.classList.toggle('visible', index <= maxReachedStep);
                step.classList.toggle('active', index === currentStep);
            });
            
            if (stepsData[currentStep]) {
                stepsData[currentStep].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            const currentStepEl = stepsData[currentStep];
            if (currentStepEl) {
                const action = currentStepEl.dataset.action;
                if (action) {
                    executeAction(action, {
                        cycleLen: currentStepEl.dataset.cycleLen,
                        target: currentStepEl.dataset.target,
                        quotient: currentStepEl.dataset.quotient,
                        remainder: currentStepEl.dataset.remainder,
                        result: currentStepEl.dataset.result,
                        pattern: currentStepEl.dataset.pattern,
                        groupNum: currentStepEl.dataset.groupNum,
                        posInGroup: currentStepEl.dataset.posInGroup
                    });
                }
            }
        }
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtons() {
            document.getElementById('prevBtn').disabled = currentStep === 0;
            document.getElementById('nextBtn').disabled = currentStep >= stepsData.length - 1;
        }
        
        // ä¸Šä¸€æ­¥
        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateStepVisibility();
                updateButtons();
            }
        }
        
        // ä¸‹ä¸€æ­¥
        function nextStep() {
            // å¦‚æœè¿˜æ²¡æœ‰ç”Ÿæˆæ­¥éª¤ï¼Œå…ˆç”Ÿæˆ
            if (stepsData.length === 0) {
                startCalculation();
                return;
            }
            if (currentStep < stepsData.length - 1) {
                currentStep++;
                if (currentStep > maxReachedStep) {
                    maxReachedStep = currentStep;
                }
                updateStepVisibility();
                updateButtons();
            }
        }
        
        // ä¸€é”®æŸ¥çœ‹
        function showAllSteps() {
            if (stepsData.length === 0) {
                startCalculation();
            }
            if (stepsData.length > 0) {
                maxReachedStep = stepsData.length - 1;
                currentStep = stepsData.length - 1;
                updateStepVisibility();
                updateButtons();
            }
        }
        
        // é‡ç½®æ¼”ç¤ºçŠ¶æ€
        function resetDemo() {
            if (animationTimer) {
                clearTimeout(animationTimer);
                animationTimer = null;
            }
            
            stepsData = [];
            currentStep = 0;
            maxReachedStep = 0;
            
            const container = document.getElementById('stepsContainer');
            container.innerHTML = `
                <div class="step-item">
                    <span class="step-number">1</span>
                    <span class="step-content">ğŸ‘† ç‚¹å‡»ä¸‹ä¸€æ­¥å¼€å§‹è§£ç­”</span>
                </div>
            `;
            
            document.getElementById('answerQuotient').textContent = '?';
            document.getElementById('answerResult').textContent = '?';
            
            document.getElementById('prevBtn').disabled = true;
            document.getElementById('nextBtn').disabled = false;
            
            const pattern = parseCyclePattern();
            const target = parseInt(document.getElementById('targetPosition').value) || 1;
            if (pattern.length > 0) {
                initVisualization(pattern, target);
            }
        }
        
        // ç›‘å¬è¾“å…¥å˜åŒ–
        document.getElementById('cyclePattern').addEventListener('input', function() {
            updateProblemText();
            resetDemo();
        });
        document.getElementById('targetPosition').addEventListener('input', function() {
            updateProblemText();
            resetDemo();
        });
        
        // åˆå§‹åŒ–
        updateProblemText();
        const initPattern = parseCyclePattern();
        const initTarget = parseInt(document.getElementById('targetPosition').value) || 1;
        initVisualization(initPattern, initTarget);
    </script>
    <a href="../../index.html" style="display:block;text-align:center;margin:30px auto;color:#fff;text-decoration:none;font-size:14px;">â† è¿”å›çš®å¡ä¸˜å­¦ä¹ èµ„æº</a>
</body>
</html>
